import{o as a,a as i,b as s,i as I,r as v,p as x,t as S,l as m,d as M,n as N,q as r,_ as V}from"./index-SnOBJRe6.js";import"./useUsersStore-DeqpMyJa.js";import{u as b}from"./useBotsStore-CXWqdG9t.js";const L={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none"};function O(h,u){return a(),i("svg",L,u[0]||(u[0]=[s("path",{fill:"currentColor",d:"M12 15.75 8.25 12l1.41-1.41 1.59 1.59V3h1.5v9.18l1.59-1.59L15.75 12zM4.5 19.5h15V18h-15z"},null,-1)]))}const G={render:O},j={key:0,class:"loading-content"},E={key:1,class:"dropzone-content"},J={key:0,class:"file-info"},T=I({__name:"BotImportDropzone",props:{onImportSuccess:{type:Function,default:()=>{}},onImportError:{type:Function,default:()=>{}}},emits:["import-success","import-error","file-selected"],setup(h,{expose:u,emit:_}){const c=_,B=b(),p=v(),f=v(!1),d=v(!1),l=v(null),k=e=>{e.preventDefault(),f.value=!0},w=e=>{e.preventDefault(),f.value=!1},z=e=>{var n;e.preventDefault(),f.value=!1;const t=(n=e.dataTransfer)==null?void 0:n.files;if(t&&t.length>0){const o=t[0];D(o)&&(l.value=o,c("file-selected",o))}},C=()=>{var e;(e=p.value)==null||e.click()},F=e=>{const n=e.target.files;if(n&&n.length>0){const o=n[0];D(o)&&(l.value=o,c("file-selected",o))}},D=e=>e.name.toLowerCase().endsWith(".json")?e.size>10*1024*1024?(r.error("Размер файла не должен превышать 10MB"),!1):!0:(r.error("Пожалуйста, выберите JSON файл"),!1),g=()=>{l.value=null,p.value&&(p.value.value="")};return u({importBot:async e=>{var t,n;if(!l.value){r.error("Пожалуйста, выберите файл для импорта");return}d.value=!0;try{const o=await B.importBot(l.value,e);o&&(r.success(e?"Структура бота обновлена!":"Бот успешно импортирован!"),c("import-success",o.data),g())}catch(o){const y=((n=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:n.detail)||(o==null?void 0:o.message)||"Ошибка при импорте бота";r.error(y),c("import-error",y)}finally{d.value=!1}},clearFile:g,selectedFile:l.value}),(e,t)=>(a(),i("div",{class:N(["import-dropzone",{"drag-over":f.value,loading:d.value}]),onDragover:m(k,["prevent"]),onDragleave:m(w,["prevent"]),onDrop:m(z,["prevent"]),onClick:C},[s("input",{ref_key:"fileInput",ref:p,type:"file",accept:".json",onChange:F,style:{display:"none"}},null,544),d.value?(a(),i("div",j,t[0]||(t[0]=[s("div",{class:"spinner"},null,-1),s("p",null,"Импорт бота...",-1)]))):(a(),i("div",E,[t[2]||(t[2]=s("div",{class:"icon"},[s("i",{class:"fa-solid fa-cloud-upload-alt"})],-1)),t[3]||(t[3]=s("h3",null,"Импорт бота",-1)),t[4]||(t[4]=s("p",null,"Перетащите JSON файл сюда или нажмите для выбора файла",-1)),l.value?(a(),i("div",J,[s("p",null,[t[1]||(t[1]=s("strong",null,"Выбранный файл:",-1)),x(" "+S(l.value.name),1)]),s("button",{onClick:m(g,["stop"]),class:"clear-btn"},"Очистить")])):M("",!0)]))],34))}}),H=V(T,[["__scopeId","data-v-80841850"]]);export{H as B,G as D};
