import{_ as A,c as q,r,D as he,k as O,o as n,a as l,b as e,t as p,l as C,f as v,d as f,F as L,e as N,i as ke,x as Y,j as Ce,u as k,m as b,q as w}from"./index-SnOBJRe6.js";import{E as j,T as D}from"./useBotsStore-CXWqdG9t.js";import{s as ye,F as Z}from"./pages.css_vue_type_style_index_0_src_true_lang-OrqQe0zQ.js";import"./useUsersStore-DeqpMyJa.js";import{u as Te,b as Ge,t as ee,a as we}from"./templateViewModal-CWNCWJbW.js";import"./useGeneratedEntityName-CxA6RL77.js";const ge={class:"modal"},$e={class:"modal-head"},be={class:"modal-title"},Me={class:"modal-footer"},Ve={type:"submit",class:"btn primary"},Se={key:0,class:"error"},Ee={__name:"groupModal",props:{initial:{type:Object,default:null}},emits:["close","save"],setup(I,{emit:_}){const d=I,y=_,g=q(()=>!!d.initial),c=r({name:"",description:""}),i=r("");he(()=>d.initial,T=>{T&&(c.value.name=T.name||"",c.value.description=T.description||"")},{immediate:!0});function u(){y("close")}function M(){if(i.value="",!c.value.name.trim()){i.value="Название обязательно";return}y("save",{name:c.value.name,description:c.value.description})}return(T,G)=>{const V=O("BaseInput");return n(),l("div",{class:"modal-overlay",onClick:C(u,["self"])},[e("div",ge,[e("div",$e,[e("div",be,p(g.value?"Редактировать группу":"Создать группу"),1),e("button",{class:"modal-close",onClick:u},"×")]),e("form",{onSubmit:C(M,["prevent"])},[v(V,{modelValue:c.value.name,"onUpdate:modelValue":G[0]||(G[0]=$=>c.value.name=$),required:"",label:"Название *",class:"dark"},null,8,["modelValue"]),v(V,{modelValue:c.value.description,"onUpdate:modelValue":G[1]||(G[1]=$=>c.value.description=$),label:"Описание",class:"dark"},null,8,["modelValue"]),e("div",Me,[e("button",{type:"button",class:"btn secondary",onClick:u},"Отмена"),e("button",Ve,p(g.value?"Сохранить":"Создать"),1)]),i.value?(n(),l("div",Se,p(i.value),1)):f("",!0)],32)])])}}},se=A(Ee,[["__scopeId","data-v-cb061a27"]]),Ie={class:"modal"},Be={class:"modal-content"},Le={key:0,class:"empty-groups"},xe={key:1,class:"groups-list"},Fe=["onClick"],qe={class:"group-info"},Ne={key:0,class:"group-desc"},Pe={__name:"selectGroupModal",props:{groups:{type:Array,default:()=>[]}},emits:["close","select-group"],setup(I,{emit:_}){const d=_;function y(){d("close")}function g(c){d("select-group",c)}return(c,i)=>(n(),l("div",{class:"modal-overlay",onClick:C(y,["self"])},[e("div",Ie,[e("div",{class:"modal-head"},[i[0]||(i[0]=e("div",{class:"modal-title"},"Выберите группу",-1)),e("button",{class:"modal-close",onClick:y},"×")]),e("div",Be,[I.groups.length===0?(n(),l("div",Le,"Нет доступных групп")):(n(),l("div",xe,[(n(!0),l(L,null,N(I.groups,u=>(n(),l("div",{key:u.id,class:"group-item",onClick:M=>g(u.id)},[e("div",qe,[e("h4",null,p(u.name),1),u.description?(n(),l("p",Ne,p(u.description),1)):f("",!0)])],8,Fe))),128))]))]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn secondary",onClick:y},"Отмена")])])]))}},Ue=A(Pe,[["__scopeId","data-v-a941ce10"]]),je={class:"pages-component"},De={class:"container"},Oe={class:"content-block"},Ae={class:"header-section"},Qe={class:"buttons-row"},Re={key:1,class:"groups-container"},ze={class:"group-header"},He={class:"group-info"},Je={class:"group-title"},Ke={key:0,class:"group-description"},We={class:"group-actions"},Xe={key:0,class:"group-content"},Ye={class:"card-container"},Ze=["onClick"],es={class:"template-actions"},ss={class:"template-action"},os=["onClick"],ts={class:"template-action"},ns={class:"template-action"},as={class:"card-content"},ls={class:"template-description"},cs={class:"group-section"},is={key:0,class:"group-content"},rs={class:"card-container"},ds=["onClick"],us={class:"template-actions"},ps={class:"template-action"},vs=["onClick"],_s={class:"template-action"},ms={class:"template-action"},fs={class:"card-content"},hs={class:"template-description"},ks=ke({__name:"templatesPage",setup(I){const _=Te(),d=Ge(),{templates:y}=Y(_),{templatesGroups:g}=Y(d),c=r(!0),i=r(""),u=r(!1),M=r(!1),T=r(!1),G=r(!1),V=r(!1),$=r(!1),S=r(null),x=r(null),E=r(null),F=r(""),oe=q(()=>[...g.value].reverse()),P=q(()=>y.value.filter(s=>s.group===null||s.group===void 0)),te=q(()=>{if(!i.value)return P.value;const s=i.value.toLowerCase();return P.value.filter(o=>{var t,a;const m=((t=o==null?void 0:o.name)==null?void 0:t.toLowerCase())||"",B=((a=o==null?void 0:o.description)==null?void 0:a.toLowerCase())||"";return m.includes(s)||B.includes(s)})}),ne=s=>{if(!i.value)return s.templates;const o=i.value.toLowerCase();return s.templates.filter(m=>{var a,h;const B=((a=m==null?void 0:m.name)==null?void 0:a.toLowerCase())||"",t=((h=m==null?void 0:m.description)==null?void 0:h.toLowerCase())||"";return B.includes(o)||t.includes(o)})};Ce(async()=>{await Promise.all([_.readTemplates(),d.readTemplateGroups()]),c.value=!1});const ae=()=>{u.value=!0},Q=()=>{u.value=!1},le=async s=>{await _.createTemplate(s)&&(w.success("Шаблон создан!"),Q())},R=s=>{S.value=s,M.value=!0},z=()=>{M.value=!1,S.value=null},ce=async s=>{S.value&&await _.updateTemplate(S.value.id,s)&&(w.success("Шаблон обновлен!"),z())},H=s=>{x.value=s,T.value=!0},ie=()=>{T.value=!1,x.value=null},J=async s=>{confirm("Вы уверены, что хотите удалить этот шаблон?")&&await _.deleteTemplate(s)&&w.success("Шаблон удален!")},re=()=>{G.value=!0},K=()=>{G.value=!1},de=async s=>{await d.createTemplateGroup(s)&&(w.success("Группа создана!"),K())},ue=s=>{E.value=s,V.value=!0},W=()=>{V.value=!1,E.value=null},pe=async s=>{E.value&&await d.updateTemplateGroup(E.value.id,s)&&(w.success("Группа обновлена!"),W())},ve=async s=>{confirm("Вы уверены, что хотите удалить эту группу?")&&await d.deleteTemplateGroup(s)&&(w.success("Группа удалена!"),_.readTemplates())},_e=s=>{F.value=s,$.value=!0},me=async(s,o)=>{confirm("Убрать шаблон из группы?")&&await d.removeTemplateFromGroup(o,s)&&w.success("Шаблон убран из группы!")},X=()=>{$.value=!1,F.value=""},fe=async s=>{F.value&&await d.addTemplateToGroup(s,F.value)&&(w.success("Шаблон добавлен в группу!"),_.readTemplates()),X()};return(s,o)=>{const m=O("BaseInput"),B=O("BaseLoader");return n(),l(L,null,[e("div",je,[e("div",De,[v(ye),e("div",Oe,[e("div",Ae,[e("div",Qe,[e("div",{class:"card create-card",onClick:ae},[v(k(Z),{class:"icon"}),o[1]||(o[1]=e("div",{class:"text"},[e("span",null,"Новый шаблон"),e("span",{class:"subtitle"},"Создание нового шаблона")],-1))]),e("div",{class:"card create-card",onClick:re},[v(k(Z),{class:"icon"}),o[2]||(o[2]=e("div",{class:"text"},[e("span",null,"Новая группа"),e("span",{class:"subtitle"},"Создание новой группы")],-1))])]),v(m,{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=t=>i.value=t),class:"dark search-input",placeholder:"Поиск шаблонов"},null,8,["modelValue"])]),c.value?(n(),b(B,{key:0})):(n(),l("div",Re,[(n(!0),l(L,null,N(oe.value,t=>(n(),l("div",{key:t.id,class:"group-section"},[e("div",ze,[e("div",He,[e("h3",Je,p(t.name),1),t.description?(n(),l("p",Ke,p(t.description),1)):f("",!0)]),e("div",We,[v(k(j),{class:"icon edit-icon",onClick:a=>ue(t)},null,8,["onClick"]),v(k(D),{class:"icon",onClick:a=>ve(t.id)},null,8,["onClick"])])]),t.templates.length>0?(n(),l("div",Xe,[e("div",Ye,[(n(!0),l(L,null,N(ne(t),a=>{var h;return n(),l("div",{key:a.id,class:"card",onClick:U=>H(a)},[e("div",es,[e("div",ss,[e("i",{class:"fa-solid fa-folder-minus",onClick:C(U=>me(a.id,t.id),["stop"])},null,8,os)]),e("div",ts,[v(k(j),{class:"icon edit-icon",onClick:C(U=>R(a),["stop"])},null,8,["onClick"])]),e("div",ns,[v(k(D),{class:"icon",onClick:C(U=>J(a.id),["stop"])},null,8,["onClick"])])]),e("h3",null,p(a.name),1),e("div",as,[e("span",ls,p(a==null?void 0:a.description),1),e("span",null,"Шагов: "+p(((h=a.steps)==null?void 0:h.length)||0),1)])],8,Ze)}),128))])])):f("",!0)]))),128)),e("div",cs,[o[3]||(o[3]=e("div",{class:"group-header"},[e("h3",{class:"group-title"},"Другие")],-1)),P.value.length>0?(n(),l("div",is,[e("div",rs,[(n(!0),l(L,null,N(te.value,t=>{var a;return n(),l("div",{key:t.id,class:"card",onClick:h=>H(t)},[e("div",us,[e("div",ps,[e("i",{class:"fa-solid fa-folder-plus",onClick:C(h=>_e(t.id),["stop"])},null,8,vs)]),e("div",_s,[v(k(j),{class:"icon edit-icon",onClick:C(h=>R(t),["stop"])},null,8,["onClick"])]),e("div",ms,[v(k(D),{class:"icon",onClick:C(h=>J(t.id),["stop"])},null,8,["onClick"])])]),e("h3",null,p(t.name),1),e("div",fs,[e("span",hs,p(t==null?void 0:t.description),1),e("span",null,"Шагов: "+p(((a=t.steps)==null?void 0:a.length)||0),1)])],8,ds)}),128))])])):f("",!0)])]))])])]),u.value?(n(),b(ee,{key:0,onClose:Q,onSave:le})):f("",!0),M.value&&S.value?(n(),b(ee,{key:1,initial:S.value,onClose:z,onSave:ce},null,8,["initial"])):f("",!0),T.value&&x.value?(n(),b(we,{key:2,template:x.value,onClose:ie},null,8,["template"])):f("",!0),G.value?(n(),b(se,{key:3,onClose:K,onSave:de})):f("",!0),V.value&&E.value?(n(),b(se,{key:4,initial:E.value,onClose:W,onSave:pe},null,8,["initial"])):f("",!0),$.value?(n(),b(Ue,{key:5,groups:k(g),onClose:X,onSelectGroup:fe},null,8,["groups"])):f("",!0)],64)}}}),$s=A(ks,[["__scopeId","data-v-bf26ef26"]]);export{$s as default};
