import{C as Q,i as X,r as C,j as Y,k as v,o as m,a as Z,b as d,n as _,u as r,l as y,t as x,m as c,f as u,d as b,w as T,p as j,F as h,q as w,_ as ee}from"./index-SnOBJRe6.js";import{u as te,F as se,S as ae}from"./useFullScreen-BNunA2HP.js";import{b as oe,u as le,C as ne,c as ie}from"./useKeyboardShortcuts-DkxLRe_B.js";import{s as F,b as W,c as de}from"./useUsersStore-DeqpMyJa.js";import{u as re}from"./useGeneratedEntityName-CxA6RL77.js";import{u as ue,w as me}from"./vuelidate-BXQAJ37Y.js";const V={readWidgets(t={}){return F(W.get("/widgets/",{params:t}))},createWidget(t){return F(W.post("/widgets/",t))},updateWidget(t,o){return F(W.patch(`/widgets/${t}`,o))},deleteWidget(t){return F(W.delete(`/widgets/${t}`))}},pe=Q("widgets",{state:()=>({widgets:[]}),actions:{async readWidgets(t={}){const o=await V.readWidgets(t);return o&&(this.widgets=o.data),o},async createWidget(t){const o=await V.createWidget(t);return o&&this.widgets.push(o.data),o.data},async updateWidget(t,o){const n=await V.updateWidget(t,o);return n&&de(this.widgets,t,n.data),n},async deleteWidget(t){const o=await V.deleteWidget(t);return o&&(this.widgets=this.widgets.filter(n=>n.id!==t)),o}}}),ce={class:"modal-head"},ge={class:"modal-name"},ve={class:"modal-options"},fe={class:"form-top"},Ce={class:"modal-actions"},ye=X({__name:"widgetModal",props:{isEditMode:{type:Boolean},formData:{},currentWidgetId:{}},emits:["close"],setup(t,{emit:o}){const n=t,A=o,S=pe(),i=C(!1),B=C(!1),a=C({...oe,...n.formData}),k=ue(me,a),{isFullScreen:z,toggleFullScreen:N,resetFullScreen:q}=te(),g=C("html"),M=l=>{g.value=g.value===l?"":l},p=()=>{i.value=!1,q(),A("close")},f=()=>{i.value?B.value=!0:p()},L=()=>{B.value=!1},U=async(l=!1)=>{if(l||i.value){if(!await k.value.$validate()){w.error("Ошибка!");return}await D()}p()},D=async()=>{n.isEditMode&&n.currentWidgetId?await G():await O()},O=async()=>{await S.createWidget(a.value)&&(w.success("Виджет создан!"),p())},G=async()=>{await S.updateWidget(n.currentWidgetId,a.value)&&(w.success("Сохранено!"),p())},J=async()=>{confirm("Вы уверены, что хотите удалить этот виджет?")&&await S.deleteWidget(n.currentWidgetId)&&(w.success("Виджет удален!"),p())},I=l=>l.trim()?"#FFFFFF":"#B3B3B3",{generateName:K}=re();return Y(()=>{n.isEditMode||(a.value.name=K("виджет"),i.value=!0)}),le({onEscape:f,onSave:D}),(l,e)=>{const H=v("BaseCopyableId"),R=v("BaseInput"),E=v("BaseCodeEditor"),$=v("BaseButton"),P=v("BaseCommand");return m(),Z(h,null,[d("div",{class:"modal-overlay",onClick:f},[d("div",{class:_(["modal",{"full-screen":r(z)}]),onClick:e[14]||(e[14]=y(()=>{},["stop"]))},[d("div",ce,[d("div",ge,x(l.isEditMode?"Редактирование виджета":"Новый виджет"),1),d("div",ve,[d("button",{class:"modal-full-screen",onClick:e[0]||(e[0]=y((...s)=>r(N)&&r(N)(...s),["prevent"]))},[r(z)?(m(),c(r(ae),{key:1})):(m(),c(r(se),{key:0}))]),d("button",{class:"modal-close",onClick:y(f,["prevent"])},[u(r(ne))])])]),l.isEditMode?(m(),c(H,{key:0,class:"ignore-gap",id:l.currentWidgetId},null,8,["id"])):b("",!0),d("form",{onInput:e[12]||(e[12]=s=>i.value=!0),onSubmit:e[13]||(e[13]=y(s=>U(),["prevent"]))},[d("div",fe,[u(R,{modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.name=s),class:"dark",inputClass:"input",label:"Название *",labelColor:"#FFFFFF",required:"",type:"text",error:r(k).name.$error?r(k).name.$errors[0].$message:""},null,8,["modelValue","error"]),u(R,{modelValue:a.value.description,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.description=s),class:"dark",inputClass:"input",label:"Описание",labelColor:"#FFFFFF",type:"text"},null,8,["modelValue"])]),u(E,{modelValue:a.value.body,"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.body=s),defaultHeight:600,isCollapsed:g.value!=="html",isResizable:!0,label:"HTML",labelColor:I(a.value.body),language:"html",onInput:e[4]||(e[4]=s=>i.value=!0),onToggle:e[5]||(e[5]=s=>M("html"))},null,8,["modelValue","isCollapsed","labelColor"]),u(E,{modelValue:a.value.js,"onUpdate:modelValue":e[6]||(e[6]=s=>a.value.js=s),defaultHeight:600,isCollapsed:g.value!=="js",isResizable:!0,label:"JS",labelColor:I(a.value.js),language:"javascript",onInput:e[7]||(e[7]=s=>i.value=!0),onToggle:e[8]||(e[8]=s=>M("js"))},null,8,["modelValue","isCollapsed","labelColor"]),u(E,{modelValue:a.value.css,"onUpdate:modelValue":e[9]||(e[9]=s=>a.value.css=s),defaultHeight:600,isCollapsed:g.value!=="css",isResizable:!0,label:"CSS",labelColor:I(a.value.css),language:"css",onInput:e[10]||(e[10]=s=>i.value=!0),onToggle:e[11]||(e[11]=s=>M("css"))},null,8,["modelValue","isCollapsed","labelColor"]),d("div",Ce,[l.isEditMode?(m(),c($,{key:0,size:"medium",styleType:"danger",type:"button",onClick:J,style:{"margin-right":"auto"}},{default:T(()=>e[15]||(e[15]=[j(" Удалить ")])),_:1})):b("",!0),u(P,{command:"S"}),i.value?(m(),c($,{key:1,size:"medium",styleType:"secondary",type:"button",onClick:f},{default:T(()=>e[16]||(e[16]=[j(" Закрыть ")])),_:1})):b("",!0),u($,{size:"medium",styleType:"primary",type:"submit"},{default:T(()=>[j(x(l.isEditMode?i.value?"Сохранить и закрыть":"Закрыть":"Создать"),1)]),_:1})])],32)],2)]),B.value?(m(),c(ie,{key:0,onClose:L,onConfirm:U,onCloseMain:p})):b("",!0)],64)}}}),Be=ee(ye,[["__scopeId","data-v-286a2ad0"]]);export{pe as u,Be as w};
