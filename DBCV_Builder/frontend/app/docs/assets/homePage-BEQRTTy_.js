import{o as _,a as T,b as m,C as wt,A as at,D as Me,i as Ie,r as q,E as bi,G as Ft,u as P,d as K,m as me,F as Ee,H as mn,c as J,I as na,J as wi,K as ct,L as oa,f as O,w as $e,M as nt,z as qo,N as Si,O as xi,h as Fe,P as Ci,Q as Ue,j as Ze,n as He,R as ot,S as sa,p as Ce,t as te,U as Xe,e as ze,V as Xo,W as $i,X as aa,Y as Tn,Z as Te,$ as Ei,a0 as Ae,k as ge,a1 as on,a2 as ki,a3 as Ni,_ as Oe,q as Be,l as ft,y as qe,a4 as Ii,g as An,v as Io,a5 as mo,s as ia,B as Ti,a6 as Mi,a7 as Vi,a8 as Di,a9 as Bi}from"./index-SnOBJRe6.js";import{E as Wo,T as pt,u as Wn}from"./useBotsStore-CXWqdG9t.js";import{s as Ve,b as Ne,c as kt,u as Qt}from"./useUsersStore-DeqpMyJa.js";import{u as Ai,w as Oi}from"./widgetModal-DCZbw6La.js";import{a as Pi,B as On,c as zi}from"./chatView-CJiEovSS.js";import{u as la,r as Ri}from"./requestModal-bdU8RDVP.js";import{D as Ui,B as Li}from"./BotImportDropzone-CzOBMZNw.js";import{u as Gi,a as Hi}from"./vuelidate-BXQAJ37Y.js";import{S as Fi,F as ra}from"./useFullScreen-BNunA2HP.js";import{u as Yi,t as qi,a as Xi,n as Wi,b as Zi}from"./templateViewModal-CWNCWJbW.js";import{C as ji}from"./useKeyboardShortcuts-DkxLRe_B.js";import"./useGeneratedEntityName-CxA6RL77.js";const Ki={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16"};function Ji(e,t){return _(),T("svg",Ki,t[0]||(t[0]=[m("path",{d:"M3.33 12.66h.95l6.52-6.51-.95-.95-6.52 6.51zM2 14v-2.84l8.8-8.78c.13-.12.28-.22.44-.29q.24-.09.51-.09c.17 0 .35.03.51.09.17.07.31.17.44.31l.91.93c.14.12.23.26.29.43s.1.33.1.5c0 .18-.04.35-.1.51s-.15.31-.29.44L4.83 14zm8.31-8.32-.46-.48.95.95z"},null,-1)]))}const Zo={render:Ji},Qi={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none"};function el(e,t){return _(),T("svg",Qi,t[0]||(t[0]=[m("path",{fill:"#000","fill-rule":"evenodd",d:"M10.94 7.94a1.5 1.5 0 0 1 2.12 0l5.658 5.656a1.5 1.5 0 1 1-2.122 2.121L12 11.122l-4.596 4.596a1.5 1.5 0 1 1-2.122-2.12l5.658-5.66z","clip-rule":"evenodd"},null,-1)]))}const Pn={render:el},tl={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16"};function nl(e,t){return _(),T("svg",tl,t[0]||(t[0]=[m("path",{fill:"#fff",d:"M7.833 8.667h-4V7.333h4v-4h1.334v4h4v1.334h-4v4H7.833z"},null,-1)]))}const ol={render:nl},sl={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16"};function al(e,t){return _(),T("svg",sl,t[0]||(t[0]=[m("path",{stroke:"#fff","stroke-linecap":"round","stroke-linejoin":"round",d:"M8.5 4v4l2.667 1.333m4-1.333A6.667 6.667 0 1 1 1.833 8a6.667 6.667 0 0 1 13.334 0"},null,-1)]))}const il={render:al},ll={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16"};function rl(e,t){return _(),T("svg",ll,t[0]||(t[0]=[m("path",{stroke:"#fff","stroke-linecap":"round","stroke-linejoin":"round",d:"M14.5 7.667a5.6 5.6 0 0 1-.6 2.533 5.67 5.67 0 0 1-5.067 3.133 5.6 5.6 0 0 1-2.533-.6L2.5 14l1.267-3.8a5.6 5.6 0 0 1-.6-2.533A5.67 5.67 0 0 1 6.3 2.6 5.6 5.6 0 0 1 8.833 2h.334A5.654 5.654 0 0 1 14.5 7.333z"},null,-1)]))}const ul={render:rl},cl={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 11 12"};function dl(e,t){return _(),T("svg",cl,t[0]||(t[0]=[m("path",{fill:"#fff",d:"M7.977 2.806a1.69 1.69 0 0 0-2.304.082L2.28 6.28a.75.75 0 1 1-1.06-1.06l3.392-3.392A3.192 3.192 0 1 1 9.07 6.397l-4.724 4.496A1.923 1.923 0 1 1 1.66 8.14l4.243-4.244a.75.75 0 1 1 1.06 1.061l-4.24 4.244a.423.423 0 0 0 .59.605L8.035 5.31a1.69 1.69 0 0 0-.058-2.504"},null,-1)]))}const fl={render:dl},pl={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 11 6"};function ml(e,t){return _(),T("svg",pl,t[0]||(t[0]=[m("path",{fill:"#fff","fill-rule":"evenodd",d:"M2.845 1.293a1.707 1.707 0 0 0 0 3.414h1.343a.569.569 0 0 1 0 1.138H2.845a2.845 2.845 0 1 1 0-5.69h1.313a.569.569 0 0 1 0 1.138zM6.273.724c0-.314.254-.569.569-.569h1.313a2.845 2.845 0 0 1 0 5.69H6.812a.569.569 0 1 1 0-1.138h1.343a1.707 1.707 0 1 0 0-3.414H6.842a.57.57 0 0 1-.57-.569M2.87 3c0-.314.255-.569.57-.569h4.168a.569.569 0 0 1 0 1.138H3.44A.57.57 0 0 1 2.87 3","clip-rule":"evenodd"},null,-1)]))}const vl={render:ml},hl={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 10 12"};function gl(e,t){return _(),T("svg",hl,t[0]||(t[0]=[m("path",{fill:"#fff",d:"M10 2.78v3.1q0 .34-.127.64a1.7 1.7 0 0 1-.86.887 1.5 1.5 0 0 1-.64.133H5.12q-.407 0-.773.16a2.2 2.2 0 0 0-.654.44q-.286.28-.446.64t-.167.78v1.487H1.967q-.38 0-.667-.134a1.5 1.5 0 0 1-.493-.36 2.2 2.2 0 0 1-.354-.526 2.8 2.8 0 0 1-.22-.634 10 10 0 0 1-.166-.82 5.3 5.3 0 0 1 0-1.673q.067-.414.166-.813a2.5 2.5 0 0 1 .274-.674q.18-.3.446-.52.267-.22.587-.34t.727-.12h4.48V4.02H3.493V2.78q0-.44.094-.733.093-.294.3-.48a1.5 1.5 0 0 1 .506-.294q.3-.106.727-.186a6 6 0 0 1 .773-.1q.394-.028.78-.034.428 0 .854.027.426.026.846.107.32.06.614.2.293.139.513.353t.36.507.14.633m-5.087.413a.6.6 0 0 0 .24-.046.54.54 0 0 0 .194-.134.8.8 0 0 0 .133-.2.5.5 0 0 0 .047-.24.6.6 0 0 0-.047-.233.7.7 0 0 0-.133-.2.5.5 0 0 0-.194-.133 1 1 0 0 0-.24-.054.6.6 0 0 0-.24.047.54.54 0 0 0-.193.133.8.8 0 0 0-.133.2.5.5 0 0 0-.047.24.62.62 0 0 0 .173.434.66.66 0 0 0 .44.186"},null,-1)]))}const yl={render:gl},_l={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 12 10"};function bl(e,t){return _(),T("svg",_l,t[0]||(t[0]=[m("path",{stroke:"#fff","stroke-linecap":"round","stroke-linejoin":"round","stroke-opacity":".68",d:"M3.318 8.182A4.5 4.5 0 1 0 2 5.002V6m0 0L1 5m1 1 1-1m3-2v2.5h2.5"},null,-1)]))}const wl={render:bl},Sl={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 13 13"};function xl(e,t){return _(),T("svg",Sl,t[0]||(t[0]=[m("path",{fill:"#fff",d:"M.317 6.5 3 3.819l.766.766L1.849 6.5l1.916 1.915-.766.766zm4.443 4.728L7.19 1.51l1.05.263-2.429 9.717zm4.475-2.813L11.151 6.5 9.235 4.585l.767-.766L12.683 6.5l-2.681 2.681z"},null,-1)]))}const Cl={render:xl},$l={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 11 12"};function El(e,t){return _(),T("svg",$l,t[0]||(t[0]=[m("path",{fill:"#fff","fill-rule":"evenodd",d:"M5.014 4.14a.687.687 0 0 1 .972 0l2.593 2.592a.688.688 0 1 1-.973.972L5.5 5.598 3.394 7.704a.687.687 0 1 1-.973-.972l2.593-2.594z","clip-rule":"evenodd"},null,-1)]))}const kl={render:El},Nl={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"};function Il(e,t){return _(),T("svg",Nl,t[0]||(t[0]=[m("path",{d:"M48 96v320c0 8.8 7.2 16 16 16h320c8.8 0 16-7.2 16-16V170.5c0-4.2-1.7-8.3-4.7-11.3l33.9-33.9c12 12 18.7 28.3 18.7 45.3L448 416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96c0-35.3 28.7-64 64-64h245.5c17 0 33.3 6.7 45.3 18.7l74.5 74.5-33.9 33.9-74.6-74.4-.8-.8V184c0 13.3-10.7 24-24 24H104c-13.3 0-24-10.7-24-24V80H64c-8.8 0-16 7.2-16 16m80-16v80h144V80zm32 240a64 64 0 1 1 128 0 64 64 0 1 1-128 0"},null,-1)]))}const Tl={render:Il},Ml={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 15"};function Vl(e,t){return _(),T("svg",Ml,t[0]||(t[0]=[m("path",{stroke:"#989898","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.2",d:"M8.197 5.51a2 2 0 1 0-.394 3.98 2 2 0 0 0 .394-3.98m4.815 1.99a5 5 0 0 1-.048.65l1.413 1.108a.34.34 0 0 1 .077.43L13.117 12a.34.34 0 0 1-.41.143l-1.404-.565a.5.5 0 0 0-.474.055q-.322.222-.673.392a.5.5 0 0 0-.275.38L9.67 13.9a.346.346 0 0 1-.334.287H6.663a.35.35 0 0 1-.334-.278l-.21-1.494a.5.5 0 0 0-.28-.382 5 5 0 0 1-.671-.393.5.5 0 0 0-.473-.053l-1.403.565a.34.34 0 0 1-.41-.144L1.545 9.697a.34.34 0 0 1 .077-.43l1.194-.937a.5.5 0 0 0 .187-.44 4.263 4.263 0 0 1 0-.777.5.5 0 0 0-.19-.435L1.62 5.74a.34.34 0 0 1-.074-.428L2.883 3a.34.34 0 0 1 .41-.143l1.404.565a.5.5 0 0 0 .474-.055q.322-.222.673-.392a.5.5 0 0 0 .275-.38L6.33 1.1a.346.346 0 0 1 .334-.286h2.674a.35.35 0 0 1 .334.277l.21 1.494a.5.5 0 0 0 .28.382q.352.17.672.393a.5.5 0 0 0 .472.053l1.402-.564a.34.34 0 0 1 .411.143l1.337 2.312a.34.34 0 0 1-.077.43l-1.194.937a.5.5 0 0 0-.189.44q.016.195.017.39"},null,-1)]))}const Dl={render:Vl},Bl={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14.633 14.633"};function Al(e,t){return _(),T("svg",Bl,t[0]||(t[0]=[m("path",{d:"M12.65 5.31c.73 0 1.33.6 1.33 1.34v6c0 .73-.6 1.33-1.33 1.33H6.64c-.73 0-1.33-.6-1.33-1.33v-6c0-.74.6-1.34 1.33-1.34zm-10.01 4h-.66c-.36 0-.69-.14-.94-.39s-.4-.59-.4-.94v-6c0-.36.15-.69.4-.94s.58-.39.94-.39h6a1.333 1.333 0 0 1 1.33 1.33v.67"},null,-1)]))}const zn={render:Al},Ol={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 12 14"};function Pl(e,t){return _(),T("svg",Ol,t[0]||(t[0]=[m("path",{fill:"#fff",d:"M10.943 5.346a1.874 1.874 0 0 1 0 3.308L2.936 13.01c-1.29.702-2.873-.21-2.873-1.654v-8.71C.063 1.203 1.646.29 2.936.992z"},null,-1)]))}const ua={render:Pl},zl={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16"};function Rl(e,t){return _(),T("svg",zl,t[0]||(t[0]=[m("path",{fill:"#fff",d:"M.063 8c0-3.535 0-5.303 1.098-6.402C2.26.5 4.027.5 7.563.5s5.303 0 6.401 1.098c1.099 1.1 1.099 2.867 1.099 6.402s0 5.303-1.099 6.401C12.867 15.5 11.098 15.5 7.563 15.5c-3.536 0-5.304 0-6.402-1.099C.063 13.304.063 11.536.063 8"},null,-1)]))}const Ul={render:Rl},Ll={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 15 15"};function Gl(e,t){return _(),T("svg",Ll,t[0]||(t[0]=[m("path",{fill:"#000",d:"M0 7.5c0-3.54 0-5.31 1.09-6.41C2.19 0 3.96 0 7.5 0c3.53 0 5.3 0 6.4 1.09C15 2.19 15 3.96 15 7.5c0 3.53 0 5.3-1.1 6.4S11.03 15 7.5 15c-3.54 0-5.31 0-6.41-1.1C0 12.8 0 11.03 0 7.5"},null,-1)]))}const Hl={render:Gl},yn={readSteps(e={}){return Ve(Ne.get("/steps/",{params:e}))},createStep(e){return Ve(Ne.post("/steps/",e))},updateStep(e,t){return Ve(Ne.patch(`/steps/${e}`,t))},deleteStep(e){return Ve(Ne.delete(`/steps/${e}`))}},Fl=wt("steps",{state:()=>({steps:[]}),actions:{async readSteps(e={}){const t=await yn.readSteps(e);return t&&(this.steps=t.data),t},async createStep(e){const t=await yn.createStep(e);return t&&this.steps.push(t.data),t.data},async updateStep(e,t){const n=await yn.updateStep(e,t);return n&&kt(this.steps,e,n.data),n},async deleteStep(e){const t=await yn.deleteStep(e);return t&&(this.steps=this.steps.filter(n=>n.id!==e)),t}}}),_n={readConnectionGroups(e={}){return Ve(Ne.get("/connection_groups/",{params:e}))},createConnectionGroup(e){return Ve(Ne.post("/connection_groups/",e))},updateConnectionGroup(e,t){return Ve(Ne.patch(`/connection_groups/${e}`,t))},deleteConnectionGroup(e){return Ve(Ne.delete(`/connection_groups/${e}`))}},jo=wt("connectionGroups",{state:()=>({connectionGroups:[]}),actions:{async readConnectionGroups(e={}){const t=await _n.readConnectionGroups(e);return t&&(this.connectionGroups=t.data),t},async createConnectionGroup(e){const t=await _n.createConnectionGroup(e);return t&&this.connectionGroups.push(t.data),t.data},async updateConnectionGroup(e,t){const n=await _n.updateConnectionGroup(e,t);return n&&kt(this.connectionGroups,e,n.data),n},async deleteConnectionGroup(e){const t=await _n.deleteConnectionGroup(e);return t&&(this.connectionGroups=this.connectionGroups.filter(n=>n.id!==e)),t}}}),bn={readNotes(e={}){return Ve(Ne.get("/notes/",{params:e}))},createNote(e){return Ve(Ne.post("/notes/",e))},updateNote(e,t){return Ve(Ne.patch(`/notes/${e}`,t))},deleteNote(e){return Ve(Ne.delete(`/notes/${e}`))}},Yl=wt("notes",{state:()=>({notes:[]}),actions:{async readNotes(e={}){const t=await bn.readNotes(e);return t&&(this.notes=t.data),t},async createNote(e){const t=await bn.createNote(e);return t&&this.notes.push(t.data),t.data},async updateNote(e,t){const n=await bn.updateNote(e,t);return n&&kt(this.notes,e,n.data),n},async deleteNote(e){const t=await bn.deleteNote(e);return t&&(this.notes=this.notes.filter(n=>n.id!==e)),t}}}),Zt={readEmitters(e={}){return Ve(Ne.get("/emitters/",{params:e}))},createEmitter(e){return Ve(Ne.post("/emitters/",e))},readEmitter(e){return Ve(Ne.get(`/emitters/${e}`))},updateEmitter(e,t){return Ve(Ne.patch(`/emitters/${e}`,t))},deleteEmitter(e){return Ve(Ne.delete(`/emitters/${e}`))}},ql=wt("emitters",{state:()=>({emitters:[]}),actions:{async readEmitters(e={}){const t=await Zt.readEmitters(e);return t&&(this.emitters=t.data),t},async createEmitter(e){const t=await Zt.createEmitter(e);return t&&this.emitters.push(t.data),t.data},async readEmitter(e){return await Zt.readEmitter(e)},async updateEmitter(e,t){const n=await Zt.updateEmitter(e,t);return n&&kt(this.emitters,e,n.data),n},async deleteEmitter(e){const t=await Zt.deleteEmitter(e);return t&&(this.emitters=this.emitters.filter(n=>n.id!==e)),t}}}),wn={readCrons(e={}){return Ve(Ne.get("/crons/",{params:e}))},createCron(e){return Ve(Ne.post("/crons/",e))},updateCron(e,t){return Ve(Ne.patch(`/crons/${e}`,t))},deleteCron(e){return Ve(Ne.delete(`/crons/${e}`))}},Xl=wt("crons",{state:()=>({crons:[]}),actions:{async readCrons(e={}){const t=await wn.readCrons(e);return t&&(this.crons=t.data),t.data},async createCron(e){const t=await wn.createCron(e);return t&&this.crons.push(t.data),t},async updateCron(e,t){const n=await wn.updateCron(e,t);return n&&kt(this.crons,e,n.data),n},async deleteCron(e){const t=await wn.deleteCron(e);return t&&(this.crons=this.crons.filter(n=>n.id!==e)),t}}}),jt={readTemplatesInstances(e={}){return Ve(Ne.get("/template_instance/",{params:e}))},createTemplateInstance(e,t){return Ve(Ne.post(`/template_instance/?bot_id=${t}`,e))},readTemplateInstance(e){return Ve(Ne.get(`/template_instance/${e}`))},updateTemplateInstance(e,t){return Ve(Ne.patch(`/template_instance/${e}`,t))},deleteTemplateInstance(e){return Ve(Ne.delete(`/template_instance/${e}`))}},Wl=wt("templatesInstance",{state:()=>({templatesInstances:[]}),actions:{async readTemplatesInstances(e={}){const t=await jt.readTemplatesInstances(e);return t&&(this.templatesInstances=t.data),t},async createTemplateInstance(e){const{bot_id:t,...n}=e,o=await jt.createTemplateInstance(n,t);return o&&this.templatesInstances.push(o.data),o},async readTemplateInstance(e){return await jt.readTemplateInstance(e)},async updateTemplateInstance(e,t){const n=await jt.updateTemplateInstance(e,t);return n&&kt(this.templatesInstances,e,n.data),n},async deleteTemplateInstance(e){const t=await jt.deleteTemplateInstance(e);return t&&(this.templatesInstances=this.templatesInstances.filter(n=>n.id!==e)),t}}}),zt={readCredentials(e,t={}){return Ve(Ne.get(`/bots/${e}/credentials/`,{params:t}))},createCredential(e,t){return Ve(Ne.post(`/bots/${e}/credentials/`,t))},readCredential(e,t){return Ve(Ne.get(`/bots/${e}/credentials/${t}`))},updateCredential(e,t,n){return Ve(Ne.patch(`/bots/${e}/credentials/${t}`,n))},deleteCredential(e,t){return Ve(Ne.delete(`/bots/${e}/credentials/${t}`))},makeDefaultCredential(e,t){return Ve(Ne.post(`/bots/${e}/credentials/${t}/make-default`))}},Zl=wt("credentials",{state:()=>({credentials:[],credentialId:null}),actions:{async readCredentials(e,t={}){const n=await zt.readCredentials(e,t);return n&&(this.credentials=n.data),n},async createCredential(e,t){const n=await zt.createCredential(e,t);return n&&this.credentials.push(n.data),n.data},async readCredential(e,t){return await zt.readCredential(e,t)},async updateCredential(e,t,n){const o=await zt.updateCredential(e,t,n);return o&&kt(this.credentials,t,o.data),o},async deleteCredential(e,t){const n=await zt.deleteCredential(e,t);return n&&(this.credentials=this.credentials.filter(o=>o.id!==t)),n},async makeDefaultCredential(e,t){const n=await zt.makeDefaultCredential(e,t);if(n){const o=this.credentials.find(s=>s.id===t);o&&(this.credentials=this.credentials.map(s=>s.provider===o.provider&&s.strategy===o.strategy?{...s,is_default:!1}:s),kt(this.credentials,t,n.data))}return n}}}),jl=wt("autonomousAssistant",{state:()=>({sessions:at({}),plan:null,planLoading:!1,planError:null}),actions:{async generatePlan(e,t,n={}){var i,l;const s=Qt().accessToken;if(!s)throw new Error("User not authenticated");this.planLoading=!0,this.planError=null;const a={prompt:e};t&&(a.bot_id=t),n&&Object.keys(n).length>0&&(a.context=n);try{const u=(await Ne.post("/autonomous-assistant/plan",a,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).data??{},c={steps:Array.isArray(u==null?void 0:u.steps)?u.steps:[],missing_data:Array.isArray(u==null?void 0:u.missing_data)?u.missing_data:[],prompt_suggestion:(u==null?void 0:u.prompt_suggestion)??null};return this.plan=c,this.planLoading=!1,c}catch(r){const u=((l=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:l.detail)||(r==null?void 0:r.message)||"РќРµ СѓРґР°Р»РѕСЃСЊ РїРѕСЃС‚СЂРѕРёС‚СЊ РїР»Р°РЅ";throw this.planLoading=!1,this.planError=u,this.plan=null,new Error(u)}},clearPlan(){this.plan=null,this.planError=null,this.planLoading=!1},createSession(e,t,n={}){const o=`autonomous-${Date.now()}-${Math.random().toString(36).substr(2,8)}`;return this.sessions[o]={id:o,botId:e,status:"idle",prompt:t,context:n,result:null,error:null,toolCalls:[],outputText:"",sessionId:null,createdAt:new Date().toISOString(),completedAt:null},o},async generateBot(e,t,n,o={}){const s=this.sessions[e];if(!s)throw new Error(`Session ${e} not found`);const i=Qt().accessToken;if(!i)throw new Error("User not authenticated");try{s.status="generating",s.prompt=t,s.context=o,s.error=null;const l={prompt:t,context:o};n&&(l.bot_id=n);const u=(await Ne.post("/autonomous-assistant/generate",l,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}})).data;if(s.status=u.success?"completed":"error",s.outputText=u.output_text,s.toolCalls=u.tool_calls||[],s.sessionId=u.session_id||null,s.completedAt=new Date().toISOString(),!u.success)throw s.error=u.error||"Generation failed",new Error(s.error)}catch(l){throw s.status="error",s.error=(l==null?void 0:l.message)||"Generation failed",s.completedAt=new Date().toISOString(),l}},async checkStatus(){const t=Qt().accessToken;if(!t)throw new Error("User not authenticated");return(await Ne.get("/autonomous-assistant/status",{headers:{Authorization:`Bearer ${t}`}})).data},async testAssistant(){const t=Qt().accessToken;if(!t)throw new Error("User not authenticated");return(await Ne.post("/autonomous-assistant/test",{},{headers:{Authorization:`Bearer ${t}`}})).data},getSession(e){return this.sessions[e]},getAllSessions(){return Object.values(this.sessions)},getSessionsForBot(e){return Object.values(this.sessions).filter(t=>t.botId===e)},removeSession(e){delete this.sessions[e]},clearAllSessions(){Object.keys(this.sessions).forEach(e=>delete this.sessions[e])},getStats(){const e=Object.values(this.sessions);return{total:e.length,completed:e.filter(t=>t.status==="completed").length,error:e.filter(t=>t.status==="error").length,generating:e.filter(t=>t.status==="generating").length}},getToolHistory(e){const t=this.sessions[e];return(t==null?void 0:t.toolCalls)||[]},getSessionResult(e){const t=this.sessions[e];return(t==null?void 0:t.result)||null},isSessionActive(e){const t=this.sessions[e];return(t==null?void 0:t.status)==="generating"},getLastSessionForBot(e){const t=this.getSessionsForBot(e);return t.length===0?null:t.sort((n,o)=>new Date(o.createdAt).getTime()-new Date(n.createdAt).getTime())[0]}}}),Zn=wt("websocket",{state:()=>({bots:at({})}),actions:{connect(e,t,n={}){var a;if((a=this.bots[e])!=null&&a.socket)return;this.bots[e]={socket:null,variables:at({...n}),logs:at([]),stepLogs:at({}),connected:!1};const o=`ws://localhost:8003/ws/bot?bot_id=${e}&token=${t}`,s=new WebSocket(o);this.bots[e].socket=s,s.onopen=()=>{this.bots[e].connected=!0,console.log(`Bot ${e} connected`)},s.onmessage=i=>{try{const l=JSON.parse(i.data);if(l.type==="variables"){const r=this.bots[e].variables;for(const u in r)delete r[u];Object.assign(r,l.message)}else if(l.type==="logs"&&(this.bots[e].logs.push(l.message),l.step_id)){const r=l.step_id;this.bots[e].stepLogs[r]||(this.bots[e].stepLogs[r]=at([])),this.bots[e].stepLogs[r].push({level:l.level||"INFO",message:l.message,timestamp:new Date().toISOString()})}}catch(l){console.error(`Ошибка парсинга сообщения WS для агента ${e}:`,l)}},s.onerror=i=>{console.error(`WebSocket ошибка у бота ${e}:`,i)},s.onclose=()=>{this.bots[e].connected=!1,this.bots[e].socket=null,console.log(`WebSocket закрыт для бота ${e}`)}},disconnect(e){const t=this.bots[e];t!=null&&t.socket&&(t.socket.close(),t.socket=null,t.connected=!1),this.removeBot(e)},removeBot(e){delete this.bots[e]},getBot(e){return this.bots[e]},getStepLogs(e,t){const n=this.bots[e];return n!=null&&n.stepLogs&&n.stepLogs[t]?n.stepLogs[t]:[]}}});function jn(e){return aa()?(Tn(e),!0):!1}function ht(e){return typeof e=="function"?e():P(e)}const Kl=typeof window<"u"&&typeof document<"u",Jl=e=>typeof e<"u",Ql=Object.prototype.toString,er=e=>Ql.call(e)==="[object Object]",tr=()=>{};function nr(e,t){function n(...o){return new Promise((s,a)=>{Promise.resolve(e(()=>t.apply(this,o),{fn:t,thisArg:this,args:o})).then(s).catch(a)})}return n}const ca=e=>e();function or(e=ca){const t=q(!0);function n(){t.value=!1}function o(){t.value=!0}const s=(...a)=>{t.value&&e(...a)};return{isActive:ki(t),pause:n,resume:o,eventFilter:s}}function ds(e,t=!1,n="Timeout"){return new Promise((o,s)=>{setTimeout(t?()=>s(n):o,e)})}function sr(e,t,n={}){const{eventFilter:o=ca,...s}=n;return Me(e,nr(o,t),s)}function Rt(e,t,n={}){const{eventFilter:o,...s}=n,{eventFilter:a,pause:i,resume:l,isActive:r}=or(o);return{stop:sr(e,t,{...s,eventFilter:a}),pause:i,resume:l,isActive:r}}function ar(e,t={}){if(!qo(e))return Si(e);const n=Array.isArray(e.value)?Array.from({length:e.value.length}):{};for(const o in e.value)n[o]=xi(()=>({get(){return e.value[o]},set(s){var a;if((a=ht(t.replaceRef))!=null?a:!0)if(Array.isArray(e.value)){const l=[...e.value];l[o]=s,e.value=l}else{const l={...e.value,[o]:s};Object.setPrototypeOf(l,Object.getPrototypeOf(e.value)),e.value=l}else e.value[o]=s}}));return n}function To(e,t=!1){function n(d,{flush:p="sync",deep:f=!1,timeout:v,throwOnTimeout:g}={}){let y=null;const E=[new Promise(h=>{y=Me(e,I=>{d(I)!==t&&(y==null||y(),h(I))},{flush:p,deep:f,immediate:!0})})];return v!=null&&E.push(ds(v,g).then(()=>ht(e)).finally(()=>y==null?void 0:y())),Promise.race(E)}function o(d,p){if(!qo(d))return n(I=>I===d,p);const{flush:f="sync",deep:v=!1,timeout:g,throwOnTimeout:y}=p??{};let k=null;const h=[new Promise(I=>{k=Me([e,d],([B,H])=>{t!==(B===H)&&(k==null||k(),I(B))},{flush:f,deep:v,immediate:!0})})];return g!=null&&h.push(ds(g,y).then(()=>ht(e)).finally(()=>(k==null||k(),ht(e)))),Promise.race(h)}function s(d){return n(p=>!!p,d)}function a(d){return o(null,d)}function i(d){return o(void 0,d)}function l(d){return n(Number.isNaN,d)}function r(d,p){return n(f=>{const v=Array.from(f);return v.includes(d)||v.includes(ht(d))},p)}function u(d){return c(1,d)}function c(d=1,p){let f=-1;return n(()=>(f+=1,f>=d),p)}return Array.isArray(ht(e))?{toMatch:n,toContains:r,changed:u,changedTimes:c,get not(){return To(e,!t)}}:{toMatch:n,toBe:o,toBeTruthy:s,toBeNull:a,toBeNaN:l,toBeUndefined:i,changed:u,changedTimes:c,get not(){return To(e,!t)}}}function Mo(e){return To(e)}function ir(e){var t;const n=ht(e);return(t=n==null?void 0:n.$el)!=null?t:n}const da=Kl?window:void 0;function fa(...e){let t,n,o,s;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,o,s]=e,t=da):[t,n,o,s]=e,!t)return tr;Array.isArray(n)||(n=[n]),Array.isArray(o)||(o=[o]);const a=[],i=()=>{a.forEach(c=>c()),a.length=0},l=(c,d,p,f)=>(c.addEventListener(d,p,f),()=>c.removeEventListener(d,p,f)),r=Me(()=>[ir(t),ht(s)],([c,d])=>{if(i(),!c)return;const p=er(d)?{...d}:d;a.push(...n.flatMap(f=>o.map(v=>l(c,f,v,p))))},{immediate:!0,flush:"post"}),u=()=>{r(),i()};return jn(u),u}function lr(e){return typeof e=="function"?e:typeof e=="string"?t=>t.key===e:Array.isArray(e)?t=>e.includes(t.key):()=>!0}function fs(...e){let t,n,o={};e.length===3?(t=e[0],n=e[1],o=e[2]):e.length===2?typeof e[1]=="object"?(t=!0,n=e[0],o=e[1]):(t=e[0],n=e[1]):(t=!0,n=e[0]);const{target:s=da,eventName:a="keydown",passive:i=!1,dedupe:l=!1}=o,r=lr(t);return fa(s,a,c=>{c.repeat&&ht(l)||r(c)&&n(c)},i)}function rr(e){return JSON.parse(JSON.stringify(e))}function vo(e,t,n,o={}){var s,a,i;const{clone:l=!1,passive:r=!1,eventName:u,deep:c=!1,defaultValue:d,shouldEmit:p}=o,f=mn(),v=n||(f==null?void 0:f.emit)||((s=f==null?void 0:f.$emit)==null?void 0:s.bind(f))||((i=(a=f==null?void 0:f.proxy)==null?void 0:a.$emit)==null?void 0:i.bind(f==null?void 0:f.proxy));let g=u;t||(t="modelValue"),g=g||`update:${t.toString()}`;const y=h=>l?typeof l=="function"?l(h):rr(h):h,k=()=>Jl(e[t])?y(e[t]):d,E=h=>{p?p(h)&&v(g,h):v(g,h)};if(r){const h=k(),I=q(h);let B=!1;return Me(()=>e[t],H=>{B||(B=!0,I.value=y(H),Fe(()=>B=!1))}),Me(I,H=>{!B&&(H!==e[t]||c)&&E(H)},{deep:c}),I}else return J({get(){return k()},set(h){E(h)}})}var ur={value:()=>{}};function Kn(){for(var e=0,t=arguments.length,n={},o;e<t;++e){if(!(o=arguments[e]+"")||o in n||/[\s.]/.test(o))throw new Error("illegal type: "+o);n[o]=[]}return new Mn(n)}function Mn(e){this._=e}function cr(e,t){return e.trim().split(/^|\s+/).map(function(n){var o="",s=n.indexOf(".");if(s>=0&&(o=n.slice(s+1),n=n.slice(0,s)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:o}})}Mn.prototype=Kn.prototype={constructor:Mn,on:function(e,t){var n=this._,o=cr(e+"",n),s,a=-1,i=o.length;if(arguments.length<2){for(;++a<i;)if((s=(e=o[a]).type)&&(s=dr(n[s],e.name)))return s;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<i;)if(s=(e=o[a]).type)n[s]=ps(n[s],e.name,t);else if(t==null)for(s in n)n[s]=ps(n[s],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Mn(e)},call:function(e,t){if((s=arguments.length-2)>0)for(var n=new Array(s),o=0,s,a;o<s;++o)n[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],o=0,s=a.length;o<s;++o)a[o].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var o=this._[e],s=0,a=o.length;s<a;++s)o[s].value.apply(t,n)}};function dr(e,t){for(var n=0,o=e.length,s;n<o;++n)if((s=e[n]).name===t)return s.value}function ps(e,t,n){for(var o=0,s=e.length;o<s;++o)if(e[o].name===t){e[o]=ur,e=e.slice(0,o).concat(e.slice(o+1));break}return n!=null&&e.push({name:t,value:n}),e}var Vo="http://www.w3.org/1999/xhtml";const ms={svg:"http://www.w3.org/2000/svg",xhtml:Vo,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Jn(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),ms.hasOwnProperty(t)?{space:ms[t],local:e}:e}function fr(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Vo&&t.documentElement.namespaceURI===Vo?t.createElement(e):t.createElementNS(n,e)}}function pr(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function pa(e){var t=Jn(e);return(t.local?pr:fr)(t)}function mr(){}function Ko(e){return e==null?mr:function(){return this.querySelector(e)}}function vr(e){typeof e!="function"&&(e=Ko(e));for(var t=this._groups,n=t.length,o=new Array(n),s=0;s<n;++s)for(var a=t[s],i=a.length,l=o[s]=new Array(i),r,u,c=0;c<i;++c)(r=a[c])&&(u=e.call(r,r.__data__,c,a))&&("__data__"in r&&(u.__data__=r.__data__),l[c]=u);return new et(o,this._parents)}function hr(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function gr(){return[]}function ma(e){return e==null?gr:function(){return this.querySelectorAll(e)}}function yr(e){return function(){return hr(e.apply(this,arguments))}}function _r(e){typeof e=="function"?e=yr(e):e=ma(e);for(var t=this._groups,n=t.length,o=[],s=[],a=0;a<n;++a)for(var i=t[a],l=i.length,r,u=0;u<l;++u)(r=i[u])&&(o.push(e.call(r,r.__data__,u,i)),s.push(r));return new et(o,s)}function va(e){return function(){return this.matches(e)}}function ha(e){return function(t){return t.matches(e)}}var br=Array.prototype.find;function wr(e){return function(){return br.call(this.children,e)}}function Sr(){return this.firstElementChild}function xr(e){return this.select(e==null?Sr:wr(typeof e=="function"?e:ha(e)))}var Cr=Array.prototype.filter;function $r(){return Array.from(this.children)}function Er(e){return function(){return Cr.call(this.children,e)}}function kr(e){return this.selectAll(e==null?$r:Er(typeof e=="function"?e:ha(e)))}function Nr(e){typeof e!="function"&&(e=va(e));for(var t=this._groups,n=t.length,o=new Array(n),s=0;s<n;++s)for(var a=t[s],i=a.length,l=o[s]=[],r,u=0;u<i;++u)(r=a[u])&&e.call(r,r.__data__,u,a)&&l.push(r);return new et(o,this._parents)}function ga(e){return new Array(e.length)}function Ir(){return new et(this._enter||this._groups.map(ga),this._parents)}function Rn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Rn.prototype={constructor:Rn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Tr(e){return function(){return e}}function Mr(e,t,n,o,s,a){for(var i=0,l,r=t.length,u=a.length;i<u;++i)(l=t[i])?(l.__data__=a[i],o[i]=l):n[i]=new Rn(e,a[i]);for(;i<r;++i)(l=t[i])&&(s[i]=l)}function Vr(e,t,n,o,s,a,i){var l,r,u=new Map,c=t.length,d=a.length,p=new Array(c),f;for(l=0;l<c;++l)(r=t[l])&&(p[l]=f=i.call(r,r.__data__,l,t)+"",u.has(f)?s[l]=r:u.set(f,r));for(l=0;l<d;++l)f=i.call(e,a[l],l,a)+"",(r=u.get(f))?(o[l]=r,r.__data__=a[l],u.delete(f)):n[l]=new Rn(e,a[l]);for(l=0;l<c;++l)(r=t[l])&&u.get(p[l])===r&&(s[l]=r)}function Dr(e){return e.__data__}function Br(e,t){if(!arguments.length)return Array.from(this,Dr);var n=t?Vr:Mr,o=this._parents,s=this._groups;typeof e!="function"&&(e=Tr(e));for(var a=s.length,i=new Array(a),l=new Array(a),r=new Array(a),u=0;u<a;++u){var c=o[u],d=s[u],p=d.length,f=Ar(e.call(c,c&&c.__data__,u,o)),v=f.length,g=l[u]=new Array(v),y=i[u]=new Array(v),k=r[u]=new Array(p);n(c,d,g,y,k,f,t);for(var E=0,h=0,I,B;E<v;++E)if(I=g[E]){for(E>=h&&(h=E+1);!(B=y[h])&&++h<v;);I._next=B||null}}return i=new et(i,o),i._enter=l,i._exit=r,i}function Ar(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Or(){return new et(this._exit||this._groups.map(ga),this._parents)}function Pr(e,t,n){var o=this.enter(),s=this,a=this.exit();return typeof e=="function"?(o=e(o),o&&(o=o.selection())):o=o.append(e+""),t!=null&&(s=t(s),s&&(s=s.selection())),n==null?a.remove():n(a),o&&s?o.merge(s).order():s}function zr(e){for(var t=e.selection?e.selection():e,n=this._groups,o=t._groups,s=n.length,a=o.length,i=Math.min(s,a),l=new Array(s),r=0;r<i;++r)for(var u=n[r],c=o[r],d=u.length,p=l[r]=new Array(d),f,v=0;v<d;++v)(f=u[v]||c[v])&&(p[v]=f);for(;r<s;++r)l[r]=n[r];return new et(l,this._parents)}function Rr(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var o=e[t],s=o.length-1,a=o[s],i;--s>=0;)(i=o[s])&&(a&&i.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(i,a),a=i);return this}function Ur(e){e||(e=Lr);function t(d,p){return d&&p?e(d.__data__,p.__data__):!d-!p}for(var n=this._groups,o=n.length,s=new Array(o),a=0;a<o;++a){for(var i=n[a],l=i.length,r=s[a]=new Array(l),u,c=0;c<l;++c)(u=i[c])&&(r[c]=u);r.sort(t)}return new et(s,this._parents).order()}function Lr(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Gr(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Hr(){return Array.from(this)}function Fr(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var o=e[t],s=0,a=o.length;s<a;++s){var i=o[s];if(i)return i}return null}function Yr(){let e=0;for(const t of this)++e;return e}function qr(){return!this.node()}function Xr(e){for(var t=this._groups,n=0,o=t.length;n<o;++n)for(var s=t[n],a=0,i=s.length,l;a<i;++a)(l=s[a])&&e.call(l,l.__data__,a,s);return this}function Wr(e){return function(){this.removeAttribute(e)}}function Zr(e){return function(){this.removeAttributeNS(e.space,e.local)}}function jr(e,t){return function(){this.setAttribute(e,t)}}function Kr(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Jr(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Qr(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function eu(e,t){var n=Jn(e);if(arguments.length<2){var o=this.node();return n.local?o.getAttributeNS(n.space,n.local):o.getAttribute(n)}return this.each((t==null?n.local?Zr:Wr:typeof t=="function"?n.local?Qr:Jr:n.local?Kr:jr)(n,t))}function ya(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function tu(e){return function(){this.style.removeProperty(e)}}function nu(e,t,n){return function(){this.style.setProperty(e,t,n)}}function ou(e,t,n){return function(){var o=t.apply(this,arguments);o==null?this.style.removeProperty(e):this.style.setProperty(e,o,n)}}function su(e,t,n){return arguments.length>1?this.each((t==null?tu:typeof t=="function"?ou:nu)(e,t,n??"")):Yt(this.node(),e)}function Yt(e,t){return e.style.getPropertyValue(t)||ya(e).getComputedStyle(e,null).getPropertyValue(t)}function au(e){return function(){delete this[e]}}function iu(e,t){return function(){this[e]=t}}function lu(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function ru(e,t){return arguments.length>1?this.each((t==null?au:typeof t=="function"?lu:iu)(e,t)):this.node()[e]}function _a(e){return e.trim().split(/^|\s+/)}function Jo(e){return e.classList||new ba(e)}function ba(e){this._node=e,this._names=_a(e.getAttribute("class")||"")}ba.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function wa(e,t){for(var n=Jo(e),o=-1,s=t.length;++o<s;)n.add(t[o])}function Sa(e,t){for(var n=Jo(e),o=-1,s=t.length;++o<s;)n.remove(t[o])}function uu(e){return function(){wa(this,e)}}function cu(e){return function(){Sa(this,e)}}function du(e,t){return function(){(t.apply(this,arguments)?wa:Sa)(this,e)}}function fu(e,t){var n=_a(e+"");if(arguments.length<2){for(var o=Jo(this.node()),s=-1,a=n.length;++s<a;)if(!o.contains(n[s]))return!1;return!0}return this.each((typeof t=="function"?du:t?uu:cu)(n,t))}function pu(){this.textContent=""}function mu(e){return function(){this.textContent=e}}function vu(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function hu(e){return arguments.length?this.each(e==null?pu:(typeof e=="function"?vu:mu)(e)):this.node().textContent}function gu(){this.innerHTML=""}function yu(e){return function(){this.innerHTML=e}}function _u(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function bu(e){return arguments.length?this.each(e==null?gu:(typeof e=="function"?_u:yu)(e)):this.node().innerHTML}function wu(){this.nextSibling&&this.parentNode.appendChild(this)}function Su(){return this.each(wu)}function xu(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Cu(){return this.each(xu)}function $u(e){var t=typeof e=="function"?e:pa(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Eu(){return null}function ku(e,t){var n=typeof e=="function"?e:pa(e),o=t==null?Eu:typeof t=="function"?t:Ko(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),o.apply(this,arguments)||null)})}function Nu(){var e=this.parentNode;e&&e.removeChild(this)}function Iu(){return this.each(Nu)}function Tu(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Mu(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Vu(e){return this.select(e?Mu:Tu)}function Du(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Bu(e){return function(t){e.call(this,t,this.__data__)}}function Au(e){return e.trim().split(/^|\s+/).map(function(t){var n="",o=t.indexOf(".");return o>=0&&(n=t.slice(o+1),t=t.slice(0,o)),{type:t,name:n}})}function Ou(e){return function(){var t=this.__on;if(t){for(var n=0,o=-1,s=t.length,a;n<s;++n)a=t[n],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.options):t[++o]=a;++o?t.length=o:delete this.__on}}}function Pu(e,t,n){return function(){var o=this.__on,s,a=Bu(t);if(o){for(var i=0,l=o.length;i<l;++i)if((s=o[i]).type===e.type&&s.name===e.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=a,s.options=n),s.value=t;return}}this.addEventListener(e.type,a,n),s={type:e.type,name:e.name,value:t,listener:a,options:n},o?o.push(s):this.__on=[s]}}function zu(e,t,n){var o=Au(e+""),s,a=o.length,i;if(arguments.length<2){var l=this.node().__on;if(l){for(var r=0,u=l.length,c;r<u;++r)for(s=0,c=l[r];s<a;++s)if((i=o[s]).type===c.type&&i.name===c.name)return c.value}return}for(l=t?Pu:Ou,s=0;s<a;++s)this.each(l(o[s],t,n));return this}function xa(e,t,n){var o=ya(e),s=o.CustomEvent;typeof s=="function"?s=new s(t,n):(s=o.document.createEvent("Event"),n?(s.initEvent(t,n.bubbles,n.cancelable),s.detail=n.detail):s.initEvent(t,!1,!1)),e.dispatchEvent(s)}function Ru(e,t){return function(){return xa(this,e,t)}}function Uu(e,t){return function(){return xa(this,e,t.apply(this,arguments))}}function Lu(e,t){return this.each((typeof t=="function"?Uu:Ru)(e,t))}function*Gu(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var o=e[t],s=0,a=o.length,i;s<a;++s)(i=o[s])&&(yield i)}var Ca=[null];function et(e,t){this._groups=e,this._parents=t}function vn(){return new et([[document.documentElement]],Ca)}function Hu(){return this}et.prototype=vn.prototype={constructor:et,select:vr,selectAll:_r,selectChild:xr,selectChildren:kr,filter:Nr,data:Br,enter:Ir,exit:Or,join:Pr,merge:zr,selection:Hu,order:Rr,sort:Ur,call:Gr,nodes:Hr,node:Fr,size:Yr,empty:qr,each:Xr,attr:eu,style:su,property:ru,classed:fu,text:hu,html:bu,raise:Su,lower:Cu,append:$u,insert:ku,remove:Iu,clone:Vu,datum:Du,on:zu,dispatch:Lu,[Symbol.iterator]:Gu};function it(e){return typeof e=="string"?new et([[document.querySelector(e)]],[document.documentElement]):new et([[e]],Ca)}function Fu(e){let t;for(;t=e.sourceEvent;)e=t;return e}function ut(e,t){if(e=Fu(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var o=n.createSVGPoint();return o.x=e.clientX,o.y=e.clientY,o=o.matrixTransform(t.getScreenCTM().inverse()),[o.x,o.y]}if(t.getBoundingClientRect){var s=t.getBoundingClientRect();return[e.clientX-s.left-t.clientLeft,e.clientY-s.top-t.clientTop]}}return[e.pageX,e.pageY]}const Yu={passive:!1},ln={capture:!0,passive:!1};function ho(e){e.stopImmediatePropagation()}function Ut(e){e.preventDefault(),e.stopImmediatePropagation()}function $a(e){var t=e.document.documentElement,n=it(e).on("dragstart.drag",Ut,ln);"onselectstart"in t?n.on("selectstart.drag",Ut,ln):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Ea(e,t){var n=e.document.documentElement,o=it(e).on("dragstart.drag",null);t&&(o.on("click.drag",Ut,ln),setTimeout(function(){o.on("click.drag",null)},0)),"onselectstart"in n?o.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Sn=e=>()=>e;function Do(e,{sourceEvent:t,subject:n,target:o,identifier:s,active:a,x:i,y:l,dx:r,dy:u,dispatch:c}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:r,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:c}})}Do.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function qu(e){return!e.ctrlKey&&!e.button}function Xu(){return this.parentNode}function Wu(e,t){return t??{x:e.x,y:e.y}}function Zu(){return navigator.maxTouchPoints||"ontouchstart"in this}function ju(){var e=qu,t=Xu,n=Wu,o=Zu,s={},a=Kn("start","drag","end"),i=0,l,r,u,c,d=0;function p(I){I.on("mousedown.drag",f).filter(o).on("touchstart.drag",y).on("touchmove.drag",k,Yu).on("touchend.drag touchcancel.drag",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(I,B){if(!(c||!e.call(this,I,B))){var H=h(this,t.call(this,I,B),I,B,"mouse");H&&(it(I.view).on("mousemove.drag",v,ln).on("mouseup.drag",g,ln),$a(I.view),ho(I),u=!1,l=I.clientX,r=I.clientY,H("start",I))}}function v(I){if(Ut(I),!u){var B=I.clientX-l,H=I.clientY-r;u=B*B+H*H>d}s.mouse("drag",I)}function g(I){it(I.view).on("mousemove.drag mouseup.drag",null),Ea(I.view,u),Ut(I),s.mouse("end",I)}function y(I,B){if(e.call(this,I,B)){var H=I.changedTouches,F=t.call(this,I,B),Y=H.length,D,G;for(D=0;D<Y;++D)(G=h(this,F,I,B,H[D].identifier,H[D]))&&(ho(I),G("start",I,H[D]))}}function k(I){var B=I.changedTouches,H=B.length,F,Y;for(F=0;F<H;++F)(Y=s[B[F].identifier])&&(Ut(I),Y("drag",I,B[F]))}function E(I){var B=I.changedTouches,H=B.length,F,Y;for(c&&clearTimeout(c),c=setTimeout(function(){c=null},500),F=0;F<H;++F)(Y=s[B[F].identifier])&&(ho(I),Y("end",I,B[F]))}function h(I,B,H,F,Y,D){var G=a.copy(),z=ut(D||H,B),b,V,S;if((S=n.call(I,new Do("beforestart",{sourceEvent:H,target:p,identifier:Y,active:i,x:z[0],y:z[1],dx:0,dy:0,dispatch:G}),F))!=null)return b=S.x-z[0]||0,V=S.y-z[1]||0,function R(C,L,j){var X=z,A;switch(C){case"start":s[Y]=R,A=i++;break;case"end":delete s[Y],--i;case"drag":z=ut(j||L,B),A=i;break}G.call(C,I,new Do(C,{sourceEvent:L,subject:S,target:p,identifier:Y,active:A,x:z[0]+b,y:z[1]+V,dx:z[0]-X[0],dy:z[1]-X[1],dispatch:G}),F)}}return p.filter=function(I){return arguments.length?(e=typeof I=="function"?I:Sn(!!I),p):e},p.container=function(I){return arguments.length?(t=typeof I=="function"?I:Sn(I),p):t},p.subject=function(I){return arguments.length?(n=typeof I=="function"?I:Sn(I),p):n},p.touchable=function(I){return arguments.length?(o=typeof I=="function"?I:Sn(!!I),p):o},p.on=function(){var I=a.on.apply(a,arguments);return I===a?p:I},p.clickDistance=function(I){return arguments.length?(d=(I=+I)*I,p):Math.sqrt(d)},p}function Qo(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function ka(e,t){var n=Object.create(e.prototype);for(var o in t)n[o]=t[o];return n}function hn(){}var rn=.7,Un=1/rn,Lt="\\s*([+-]?\\d+)\\s*",un="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",dt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ku=/^#([0-9a-f]{3,8})$/,Ju=new RegExp(`^rgb\\(${Lt},${Lt},${Lt}\\)$`),Qu=new RegExp(`^rgb\\(${dt},${dt},${dt}\\)$`),ec=new RegExp(`^rgba\\(${Lt},${Lt},${Lt},${un}\\)$`),tc=new RegExp(`^rgba\\(${dt},${dt},${dt},${un}\\)$`),nc=new RegExp(`^hsl\\(${un},${dt},${dt}\\)$`),oc=new RegExp(`^hsla\\(${un},${dt},${dt},${un}\\)$`),vs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Qo(hn,cn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:hs,formatHex:hs,formatHex8:sc,formatHsl:ac,formatRgb:gs,toString:gs});function hs(){return this.rgb().formatHex()}function sc(){return this.rgb().formatHex8()}function ac(){return Na(this).formatHsl()}function gs(){return this.rgb().formatRgb()}function cn(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Ku.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?ys(t):n===3?new Ke(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?xn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?xn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Ju.exec(e))?new Ke(t[1],t[2],t[3],1):(t=Qu.exec(e))?new Ke(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=ec.exec(e))?xn(t[1],t[2],t[3],t[4]):(t=tc.exec(e))?xn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=nc.exec(e))?ws(t[1],t[2]/100,t[3]/100,1):(t=oc.exec(e))?ws(t[1],t[2]/100,t[3]/100,t[4]):vs.hasOwnProperty(e)?ys(vs[e]):e==="transparent"?new Ke(NaN,NaN,NaN,0):null}function ys(e){return new Ke(e>>16&255,e>>8&255,e&255,1)}function xn(e,t,n,o){return o<=0&&(e=t=n=NaN),new Ke(e,t,n,o)}function ic(e){return e instanceof hn||(e=cn(e)),e?(e=e.rgb(),new Ke(e.r,e.g,e.b,e.opacity)):new Ke}function Bo(e,t,n,o){return arguments.length===1?ic(e):new Ke(e,t,n,o??1)}function Ke(e,t,n,o){this.r=+e,this.g=+t,this.b=+n,this.opacity=+o}Qo(Ke,Bo,ka(hn,{brighter(e){return e=e==null?Un:Math.pow(Un,e),new Ke(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?rn:Math.pow(rn,e),new Ke(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ke(Bt(this.r),Bt(this.g),Bt(this.b),Ln(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:_s,formatHex:_s,formatHex8:lc,formatRgb:bs,toString:bs}));function _s(){return`#${Dt(this.r)}${Dt(this.g)}${Dt(this.b)}`}function lc(){return`#${Dt(this.r)}${Dt(this.g)}${Dt(this.b)}${Dt((isNaN(this.opacity)?1:this.opacity)*255)}`}function bs(){const e=Ln(this.opacity);return`${e===1?"rgb(":"rgba("}${Bt(this.r)}, ${Bt(this.g)}, ${Bt(this.b)}${e===1?")":`, ${e})`}`}function Ln(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Bt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Dt(e){return e=Bt(e),(e<16?"0":"")+e.toString(16)}function ws(e,t,n,o){return o<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new lt(e,t,n,o)}function Na(e){if(e instanceof lt)return new lt(e.h,e.s,e.l,e.opacity);if(e instanceof hn||(e=cn(e)),!e)return new lt;if(e instanceof lt)return e;e=e.rgb();var t=e.r/255,n=e.g/255,o=e.b/255,s=Math.min(t,n,o),a=Math.max(t,n,o),i=NaN,l=a-s,r=(a+s)/2;return l?(t===a?i=(n-o)/l+(n<o)*6:n===a?i=(o-t)/l+2:i=(t-n)/l+4,l/=r<.5?a+s:2-a-s,i*=60):l=r>0&&r<1?0:i,new lt(i,l,r,e.opacity)}function rc(e,t,n,o){return arguments.length===1?Na(e):new lt(e,t,n,o??1)}function lt(e,t,n,o){this.h=+e,this.s=+t,this.l=+n,this.opacity=+o}Qo(lt,rc,ka(hn,{brighter(e){return e=e==null?Un:Math.pow(Un,e),new lt(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?rn:Math.pow(rn,e),new lt(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,o=n+(n<.5?n:1-n)*t,s=2*n-o;return new Ke(go(e>=240?e-240:e+120,s,o),go(e,s,o),go(e<120?e+240:e-120,s,o),this.opacity)},clamp(){return new lt(Ss(this.h),Cn(this.s),Cn(this.l),Ln(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Ln(this.opacity);return`${e===1?"hsl(":"hsla("}${Ss(this.h)}, ${Cn(this.s)*100}%, ${Cn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Ss(e){return e=(e||0)%360,e<0?e+360:e}function Cn(e){return Math.max(0,Math.min(1,e||0))}function go(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Ia=e=>()=>e;function uc(e,t){return function(n){return e+n*t}}function cc(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(o){return Math.pow(e+o*t,n)}}function dc(e){return(e=+e)==1?Ta:function(t,n){return n-t?cc(t,n,e):Ia(isNaN(t)?n:t)}}function Ta(e,t){var n=t-e;return n?uc(e,n):Ia(isNaN(e)?t:e)}const xs=function e(t){var n=dc(t);function o(s,a){var i=n((s=Bo(s)).r,(a=Bo(a)).r),l=n(s.g,a.g),r=n(s.b,a.b),u=Ta(s.opacity,a.opacity);return function(c){return s.r=i(c),s.g=l(c),s.b=r(c),s.opacity=u(c),s+""}}return o.gamma=e,o}(1);function Ct(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Ao=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,yo=new RegExp(Ao.source,"g");function fc(e){return function(){return e}}function pc(e){return function(t){return e(t)+""}}function mc(e,t){var n=Ao.lastIndex=yo.lastIndex=0,o,s,a,i=-1,l=[],r=[];for(e=e+"",t=t+"";(o=Ao.exec(e))&&(s=yo.exec(t));)(a=s.index)>n&&(a=t.slice(n,a),l[i]?l[i]+=a:l[++i]=a),(o=o[0])===(s=s[0])?l[i]?l[i]+=s:l[++i]=s:(l[++i]=null,r.push({i,x:Ct(o,s)})),n=yo.lastIndex;return n<t.length&&(a=t.slice(n),l[i]?l[i]+=a:l[++i]=a),l.length<2?r[0]?pc(r[0].x):fc(t):(t=r.length,function(u){for(var c=0,d;c<t;++c)l[(d=r[c]).i]=d.x(u);return l.join("")})}var Cs=180/Math.PI,Oo={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ma(e,t,n,o,s,a){var i,l,r;return(i=Math.sqrt(e*e+t*t))&&(e/=i,t/=i),(r=e*n+t*o)&&(n-=e*r,o-=t*r),(l=Math.sqrt(n*n+o*o))&&(n/=l,o/=l,r/=l),e*o<t*n&&(e=-e,t=-t,r=-r,i=-i),{translateX:s,translateY:a,rotate:Math.atan2(t,e)*Cs,skewX:Math.atan(r)*Cs,scaleX:i,scaleY:l}}var $n;function vc(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Oo:Ma(t.a,t.b,t.c,t.d,t.e,t.f)}function hc(e){return e==null||($n||($n=document.createElementNS("http://www.w3.org/2000/svg","g")),$n.setAttribute("transform",e),!(e=$n.transform.baseVal.consolidate()))?Oo:(e=e.matrix,Ma(e.a,e.b,e.c,e.d,e.e,e.f))}function Va(e,t,n,o){function s(u){return u.length?u.pop()+" ":""}function a(u,c,d,p,f,v){if(u!==d||c!==p){var g=f.push("translate(",null,t,null,n);v.push({i:g-4,x:Ct(u,d)},{i:g-2,x:Ct(c,p)})}else(d||p)&&f.push("translate("+d+t+p+n)}function i(u,c,d,p){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),p.push({i:d.push(s(d)+"rotate(",null,o)-2,x:Ct(u,c)})):c&&d.push(s(d)+"rotate("+c+o)}function l(u,c,d,p){u!==c?p.push({i:d.push(s(d)+"skewX(",null,o)-2,x:Ct(u,c)}):c&&d.push(s(d)+"skewX("+c+o)}function r(u,c,d,p,f,v){if(u!==d||c!==p){var g=f.push(s(f)+"scale(",null,",",null,")");v.push({i:g-4,x:Ct(u,d)},{i:g-2,x:Ct(c,p)})}else(d!==1||p!==1)&&f.push(s(f)+"scale("+d+","+p+")")}return function(u,c){var d=[],p=[];return u=e(u),c=e(c),a(u.translateX,u.translateY,c.translateX,c.translateY,d,p),i(u.rotate,c.rotate,d,p),l(u.skewX,c.skewX,d,p),r(u.scaleX,u.scaleY,c.scaleX,c.scaleY,d,p),u=c=null,function(f){for(var v=-1,g=p.length,y;++v<g;)d[(y=p[v]).i]=y.x(f);return d.join("")}}}var gc=Va(vc,"px, ","px)","deg)"),yc=Va(hc,", ",")",")"),_c=1e-12;function $s(e){return((e=Math.exp(e))+1/e)/2}function bc(e){return((e=Math.exp(e))-1/e)/2}function wc(e){return((e=Math.exp(2*e))-1)/(e+1)}const Sc=function e(t,n,o){function s(a,i){var l=a[0],r=a[1],u=a[2],c=i[0],d=i[1],p=i[2],f=c-l,v=d-r,g=f*f+v*v,y,k;if(g<_c)k=Math.log(p/u)/t,y=function(F){return[l+F*f,r+F*v,u*Math.exp(t*F*k)]};else{var E=Math.sqrt(g),h=(p*p-u*u+o*g)/(2*u*n*E),I=(p*p-u*u-o*g)/(2*p*n*E),B=Math.log(Math.sqrt(h*h+1)-h),H=Math.log(Math.sqrt(I*I+1)-I);k=(H-B)/t,y=function(F){var Y=F*k,D=$s(B),G=u/(n*E)*(D*wc(t*Y+B)-bc(B));return[l+G*f,r+G*v,u*D/$s(t*Y+B)]}}return y.duration=k*1e3*t/Math.SQRT2,y}return s.rho=function(a){var i=Math.max(.001,+a),l=i*i,r=l*l;return e(i,l,r)},s}(Math.SQRT2,2,4);var qt=0,en=0,Kt=0,Da=1e3,Gn,tn,Hn=0,Ot=0,Qn=0,dn=typeof performance=="object"&&performance.now?performance:Date,Ba=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function es(){return Ot||(Ba(xc),Ot=dn.now()+Qn)}function xc(){Ot=0}function Fn(){this._call=this._time=this._next=null}Fn.prototype=Aa.prototype={constructor:Fn,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?es():+n)+(t==null?0:+t),!this._next&&tn!==this&&(tn?tn._next=this:Gn=this,tn=this),this._call=e,this._time=n,Po()},stop:function(){this._call&&(this._call=null,this._time=1/0,Po())}};function Aa(e,t,n){var o=new Fn;return o.restart(e,t,n),o}function Cc(){es(),++qt;for(var e=Gn,t;e;)(t=Ot-e._time)>=0&&e._call.call(void 0,t),e=e._next;--qt}function Es(){Ot=(Hn=dn.now())+Qn,qt=en=0;try{Cc()}finally{qt=0,Ec(),Ot=0}}function $c(){var e=dn.now(),t=e-Hn;t>Da&&(Qn-=t,Hn=e)}function Ec(){for(var e,t=Gn,n,o=1/0;t;)t._call?(o>t._time&&(o=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Gn=n);tn=e,Po(o)}function Po(e){if(!qt){en&&(en=clearTimeout(en));var t=e-Ot;t>24?(e<1/0&&(en=setTimeout(Es,e-dn.now()-Qn)),Kt&&(Kt=clearInterval(Kt))):(Kt||(Hn=dn.now(),Kt=setInterval($c,Da)),qt=1,Ba(Es))}}function ks(e,t,n){var o=new Fn;return t=t==null?0:+t,o.restart(s=>{o.stop(),e(s+t)},t,n),o}var kc=Kn("start","end","cancel","interrupt"),Nc=[],Oa=0,Ns=1,zo=2,Vn=3,Is=4,Ro=5,Dn=6;function eo(e,t,n,o,s,a){var i=e.__transition;if(!i)e.__transition={};else if(n in i)return;Ic(e,n,{name:t,index:o,group:s,on:kc,tween:Nc,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Oa})}function ts(e,t){var n=rt(e,t);if(n.state>Oa)throw new Error("too late; already scheduled");return n}function mt(e,t){var n=rt(e,t);if(n.state>Vn)throw new Error("too late; already running");return n}function rt(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Ic(e,t,n){var o=e.__transition,s;o[t]=n,n.timer=Aa(a,0,n.time);function a(u){n.state=Ns,n.timer.restart(i,n.delay,n.time),n.delay<=u&&i(u-n.delay)}function i(u){var c,d,p,f;if(n.state!==Ns)return r();for(c in o)if(f=o[c],f.name===n.name){if(f.state===Vn)return ks(i);f.state===Is?(f.state=Dn,f.timer.stop(),f.on.call("interrupt",e,e.__data__,f.index,f.group),delete o[c]):+c<t&&(f.state=Dn,f.timer.stop(),f.on.call("cancel",e,e.__data__,f.index,f.group),delete o[c])}if(ks(function(){n.state===Vn&&(n.state=Is,n.timer.restart(l,n.delay,n.time),l(u))}),n.state=zo,n.on.call("start",e,e.__data__,n.index,n.group),n.state===zo){for(n.state=Vn,s=new Array(p=n.tween.length),c=0,d=-1;c<p;++c)(f=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(s[++d]=f);s.length=d+1}}function l(u){for(var c=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(r),n.state=Ro,1),d=-1,p=s.length;++d<p;)s[d].call(e,c);n.state===Ro&&(n.on.call("end",e,e.__data__,n.index,n.group),r())}function r(){n.state=Dn,n.timer.stop(),delete o[t];for(var u in o)return;delete e.__transition}}function Bn(e,t){var n=e.__transition,o,s,a=!0,i;if(n){t=t==null?null:t+"";for(i in n){if((o=n[i]).name!==t){a=!1;continue}s=o.state>zo&&o.state<Ro,o.state=Dn,o.timer.stop(),o.on.call(s?"interrupt":"cancel",e,e.__data__,o.index,o.group),delete n[i]}a&&delete e.__transition}}function Tc(e){return this.each(function(){Bn(this,e)})}function Mc(e,t){var n,o;return function(){var s=mt(this,e),a=s.tween;if(a!==n){o=n=a;for(var i=0,l=o.length;i<l;++i)if(o[i].name===t){o=o.slice(),o.splice(i,1);break}}s.tween=o}}function Vc(e,t,n){var o,s;if(typeof n!="function")throw new Error;return function(){var a=mt(this,e),i=a.tween;if(i!==o){s=(o=i).slice();for(var l={name:t,value:n},r=0,u=s.length;r<u;++r)if(s[r].name===t){s[r]=l;break}r===u&&s.push(l)}a.tween=s}}function Dc(e,t){var n=this._id;if(e+="",arguments.length<2){for(var o=rt(this.node(),n).tween,s=0,a=o.length,i;s<a;++s)if((i=o[s]).name===e)return i.value;return null}return this.each((t==null?Mc:Vc)(n,e,t))}function ns(e,t,n){var o=e._id;return e.each(function(){var s=mt(this,o);(s.value||(s.value={}))[t]=n.apply(this,arguments)}),function(s){return rt(s,o).value[t]}}function Pa(e,t){var n;return(typeof t=="number"?Ct:t instanceof cn?xs:(n=cn(t))?(t=n,xs):mc)(e,t)}function Bc(e){return function(){this.removeAttribute(e)}}function Ac(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Oc(e,t,n){var o,s=n+"",a;return function(){var i=this.getAttribute(e);return i===s?null:i===o?a:a=t(o=i,n)}}function Pc(e,t,n){var o,s=n+"",a;return function(){var i=this.getAttributeNS(e.space,e.local);return i===s?null:i===o?a:a=t(o=i,n)}}function zc(e,t,n){var o,s,a;return function(){var i,l=n(this),r;return l==null?void this.removeAttribute(e):(i=this.getAttribute(e),r=l+"",i===r?null:i===o&&r===s?a:(s=r,a=t(o=i,l)))}}function Rc(e,t,n){var o,s,a;return function(){var i,l=n(this),r;return l==null?void this.removeAttributeNS(e.space,e.local):(i=this.getAttributeNS(e.space,e.local),r=l+"",i===r?null:i===o&&r===s?a:(s=r,a=t(o=i,l)))}}function Uc(e,t){var n=Jn(e),o=n==="transform"?yc:Pa;return this.attrTween(e,typeof t=="function"?(n.local?Rc:zc)(n,o,ns(this,"attr."+e,t)):t==null?(n.local?Ac:Bc)(n):(n.local?Pc:Oc)(n,o,t))}function Lc(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Gc(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function Hc(e,t){var n,o;function s(){var a=t.apply(this,arguments);return a!==o&&(n=(o=a)&&Gc(e,a)),n}return s._value=t,s}function Fc(e,t){var n,o;function s(){var a=t.apply(this,arguments);return a!==o&&(n=(o=a)&&Lc(e,a)),n}return s._value=t,s}function Yc(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var o=Jn(e);return this.tween(n,(o.local?Hc:Fc)(o,t))}function qc(e,t){return function(){ts(this,e).delay=+t.apply(this,arguments)}}function Xc(e,t){return t=+t,function(){ts(this,e).delay=t}}function Wc(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?qc:Xc)(t,e)):rt(this.node(),t).delay}function Zc(e,t){return function(){mt(this,e).duration=+t.apply(this,arguments)}}function jc(e,t){return t=+t,function(){mt(this,e).duration=t}}function Kc(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Zc:jc)(t,e)):rt(this.node(),t).duration}function Jc(e,t){if(typeof t!="function")throw new Error;return function(){mt(this,e).ease=t}}function Qc(e){var t=this._id;return arguments.length?this.each(Jc(t,e)):rt(this.node(),t).ease}function ed(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;mt(this,e).ease=n}}function td(e){if(typeof e!="function")throw new Error;return this.each(ed(this._id,e))}function nd(e){typeof e!="function"&&(e=va(e));for(var t=this._groups,n=t.length,o=new Array(n),s=0;s<n;++s)for(var a=t[s],i=a.length,l=o[s]=[],r,u=0;u<i;++u)(r=a[u])&&e.call(r,r.__data__,u,a)&&l.push(r);return new _t(o,this._parents,this._name,this._id)}function od(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,o=t.length,s=n.length,a=Math.min(o,s),i=new Array(o),l=0;l<a;++l)for(var r=t[l],u=n[l],c=r.length,d=i[l]=new Array(c),p,f=0;f<c;++f)(p=r[f]||u[f])&&(d[f]=p);for(;l<o;++l)i[l]=t[l];return new _t(i,this._parents,this._name,this._id)}function sd(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function ad(e,t,n){var o,s,a=sd(t)?ts:mt;return function(){var i=a(this,e),l=i.on;l!==o&&(s=(o=l).copy()).on(t,n),i.on=s}}function id(e,t){var n=this._id;return arguments.length<2?rt(this.node(),n).on.on(e):this.each(ad(n,e,t))}function ld(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function rd(){return this.on("end.remove",ld(this._id))}function ud(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Ko(e));for(var o=this._groups,s=o.length,a=new Array(s),i=0;i<s;++i)for(var l=o[i],r=l.length,u=a[i]=new Array(r),c,d,p=0;p<r;++p)(c=l[p])&&(d=e.call(c,c.__data__,p,l))&&("__data__"in c&&(d.__data__=c.__data__),u[p]=d,eo(u[p],t,n,p,u,rt(c,n)));return new _t(a,this._parents,t,n)}function cd(e){var t=this._name,n=this._id;typeof e!="function"&&(e=ma(e));for(var o=this._groups,s=o.length,a=[],i=[],l=0;l<s;++l)for(var r=o[l],u=r.length,c,d=0;d<u;++d)if(c=r[d]){for(var p=e.call(c,c.__data__,d,r),f,v=rt(c,n),g=0,y=p.length;g<y;++g)(f=p[g])&&eo(f,t,n,g,p,v);a.push(p),i.push(c)}return new _t(a,i,t,n)}var dd=vn.prototype.constructor;function fd(){return new dd(this._groups,this._parents)}function pd(e,t){var n,o,s;return function(){var a=Yt(this,e),i=(this.style.removeProperty(e),Yt(this,e));return a===i?null:a===n&&i===o?s:s=t(n=a,o=i)}}function za(e){return function(){this.style.removeProperty(e)}}function md(e,t,n){var o,s=n+"",a;return function(){var i=Yt(this,e);return i===s?null:i===o?a:a=t(o=i,n)}}function vd(e,t,n){var o,s,a;return function(){var i=Yt(this,e),l=n(this),r=l+"";return l==null&&(r=l=(this.style.removeProperty(e),Yt(this,e))),i===r?null:i===o&&r===s?a:(s=r,a=t(o=i,l))}}function hd(e,t){var n,o,s,a="style."+t,i="end."+a,l;return function(){var r=mt(this,e),u=r.on,c=r.value[a]==null?l||(l=za(t)):void 0;(u!==n||s!==c)&&(o=(n=u).copy()).on(i,s=c),r.on=o}}function gd(e,t,n){var o=(e+="")=="transform"?gc:Pa;return t==null?this.styleTween(e,pd(e,o)).on("end.style."+e,za(e)):typeof t=="function"?this.styleTween(e,vd(e,o,ns(this,"style."+e,t))).each(hd(this._id,e)):this.styleTween(e,md(e,o,t),n).on("end.style."+e,null)}function yd(e,t,n){return function(o){this.style.setProperty(e,t.call(this,o),n)}}function _d(e,t,n){var o,s;function a(){var i=t.apply(this,arguments);return i!==s&&(o=(s=i)&&yd(e,i,n)),o}return a._value=t,a}function bd(e,t,n){var o="style."+(e+="");if(arguments.length<2)return(o=this.tween(o))&&o._value;if(t==null)return this.tween(o,null);if(typeof t!="function")throw new Error;return this.tween(o,_d(e,t,n??""))}function wd(e){return function(){this.textContent=e}}function Sd(e){return function(){var t=e(this);this.textContent=t??""}}function xd(e){return this.tween("text",typeof e=="function"?Sd(ns(this,"text",e)):wd(e==null?"":e+""))}function Cd(e){return function(t){this.textContent=e.call(this,t)}}function $d(e){var t,n;function o(){var s=e.apply(this,arguments);return s!==n&&(t=(n=s)&&Cd(s)),t}return o._value=e,o}function Ed(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,$d(e))}function kd(){for(var e=this._name,t=this._id,n=Ra(),o=this._groups,s=o.length,a=0;a<s;++a)for(var i=o[a],l=i.length,r,u=0;u<l;++u)if(r=i[u]){var c=rt(r,t);eo(r,e,n,u,i,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new _t(o,this._parents,e,n)}function Nd(){var e,t,n=this,o=n._id,s=n.size();return new Promise(function(a,i){var l={value:i},r={value:function(){--s===0&&a()}};n.each(function(){var u=mt(this,o),c=u.on;c!==e&&(t=(e=c).copy(),t._.cancel.push(l),t._.interrupt.push(l),t._.end.push(r)),u.on=t}),s===0&&a()})}var Id=0;function _t(e,t,n,o){this._groups=e,this._parents=t,this._name=n,this._id=o}function Ra(){return++Id}var vt=vn.prototype;_t.prototype={constructor:_t,select:ud,selectAll:cd,selectChild:vt.selectChild,selectChildren:vt.selectChildren,filter:nd,merge:od,selection:fd,transition:kd,call:vt.call,nodes:vt.nodes,node:vt.node,size:vt.size,empty:vt.empty,each:vt.each,on:id,attr:Uc,attrTween:Yc,style:gd,styleTween:bd,text:xd,textTween:Ed,remove:rd,tween:Dc,delay:Wc,duration:Kc,ease:Qc,easeVarying:td,end:Nd,[Symbol.iterator]:vt[Symbol.iterator]};function Td(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Md={time:null,delay:0,duration:250,ease:Td};function Vd(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Dd(e){var t,n;e instanceof _t?(t=e._id,e=e._name):(t=Ra(),(n=Md).time=es(),e=e==null?null:e+"");for(var o=this._groups,s=o.length,a=0;a<s;++a)for(var i=o[a],l=i.length,r,u=0;u<l;++u)(r=i[u])&&eo(r,e,t,u,i,n||Vd(r,t));return new _t(o,this._parents,e,t)}vn.prototype.interrupt=Tc;vn.prototype.transition=Dd;const En=e=>()=>e;function Bd(e,{sourceEvent:t,target:n,transform:o,dispatch:s}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:s}})}function gt(e,t,n){this.k=e,this.x=t,this.y=n}gt.prototype={constructor:gt,scale:function(e){return e===1?this:new gt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new gt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Xt=new gt(1,0,0);gt.prototype;function _o(e){e.stopImmediatePropagation()}function Jt(e){e.preventDefault(),e.stopImmediatePropagation()}function Ad(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Od(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Ts(){return this.__zoom||Xt}function Pd(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function zd(){return navigator.maxTouchPoints||"ontouchstart"in this}function Rd(e,t,n){var o=e.invertX(t[0][0])-n[0][0],s=e.invertX(t[1][0])-n[1][0],a=e.invertY(t[0][1])-n[0][1],i=e.invertY(t[1][1])-n[1][1];return e.translate(s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s),i>a?(a+i)/2:Math.min(0,a)||Math.max(0,i))}function Ud(){var e=Ad,t=Od,n=Rd,o=Pd,s=zd,a=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],l=250,r=Sc,u=Kn("start","zoom","end"),c,d,p,f=500,v=150,g=0,y=10;function k(S){S.property("__zoom",Ts).on("wheel.zoom",Y,{passive:!1}).on("mousedown.zoom",D).on("dblclick.zoom",G).filter(s).on("touchstart.zoom",z).on("touchmove.zoom",b).on("touchend.zoom touchcancel.zoom",V).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}k.transform=function(S,R,C,L){var j=S.selection?S.selection():S;j.property("__zoom",Ts),S!==j?B(S,R,C,L):j.interrupt().each(function(){H(this,arguments).event(L).start().zoom(null,typeof R=="function"?R.apply(this,arguments):R).end()})},k.scaleBy=function(S,R,C,L){k.scaleTo(S,function(){var j=this.__zoom.k,X=typeof R=="function"?R.apply(this,arguments):R;return j*X},C,L)},k.scaleTo=function(S,R,C,L){k.transform(S,function(){var j=t.apply(this,arguments),X=this.__zoom,A=C==null?I(j):typeof C=="function"?C.apply(this,arguments):C,U=X.invert(A),W=typeof R=="function"?R.apply(this,arguments):R;return n(h(E(X,W),A,U),j,i)},C,L)},k.translateBy=function(S,R,C,L){k.transform(S,function(){return n(this.__zoom.translate(typeof R=="function"?R.apply(this,arguments):R,typeof C=="function"?C.apply(this,arguments):C),t.apply(this,arguments),i)},null,L)},k.translateTo=function(S,R,C,L,j){k.transform(S,function(){var X=t.apply(this,arguments),A=this.__zoom,U=L==null?I(X):typeof L=="function"?L.apply(this,arguments):L;return n(Xt.translate(U[0],U[1]).scale(A.k).translate(typeof R=="function"?-R.apply(this,arguments):-R,typeof C=="function"?-C.apply(this,arguments):-C),X,i)},L,j)};function E(S,R){return R=Math.max(a[0],Math.min(a[1],R)),R===S.k?S:new gt(R,S.x,S.y)}function h(S,R,C){var L=R[0]-C[0]*S.k,j=R[1]-C[1]*S.k;return L===S.x&&j===S.y?S:new gt(S.k,L,j)}function I(S){return[(+S[0][0]+ +S[1][0])/2,(+S[0][1]+ +S[1][1])/2]}function B(S,R,C,L){S.on("start.zoom",function(){H(this,arguments).event(L).start()}).on("interrupt.zoom end.zoom",function(){H(this,arguments).event(L).end()}).tween("zoom",function(){var j=this,X=arguments,A=H(j,X).event(L),U=t.apply(j,X),W=C==null?I(U):typeof C=="function"?C.apply(j,X):C,Q=Math.max(U[1][0]-U[0][0],U[1][1]-U[0][1]),ee=j.__zoom,re=typeof R=="function"?R.apply(j,X):R,ye=r(ee.invert(W).concat(Q/ee.k),re.invert(W).concat(Q/re.k));return function(pe){if(pe===1)pe=re;else{var ve=ye(pe),se=Q/ve[2];pe=new gt(se,W[0]-ve[0]*se,W[1]-ve[1]*se)}A.zoom(null,pe)}})}function H(S,R,C){return!C&&S.__zooming||new F(S,R)}function F(S,R){this.that=S,this.args=R,this.active=0,this.sourceEvent=null,this.extent=t.apply(S,R),this.taps=0}F.prototype={event:function(S){return S&&(this.sourceEvent=S),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(S,R){return this.mouse&&S!=="mouse"&&(this.mouse[1]=R.invert(this.mouse[0])),this.touch0&&S!=="touch"&&(this.touch0[1]=R.invert(this.touch0[0])),this.touch1&&S!=="touch"&&(this.touch1[1]=R.invert(this.touch1[0])),this.that.__zoom=R,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(S){var R=it(this.that).datum();u.call(S,this.that,new Bd(S,{sourceEvent:this.sourceEvent,target:k,type:S,transform:this.that.__zoom,dispatch:u}),R)}};function Y(S,...R){if(!e.apply(this,arguments))return;var C=H(this,R).event(S),L=this.__zoom,j=Math.max(a[0],Math.min(a[1],L.k*Math.pow(2,o.apply(this,arguments)))),X=ut(S);if(C.wheel)(C.mouse[0][0]!==X[0]||C.mouse[0][1]!==X[1])&&(C.mouse[1]=L.invert(C.mouse[0]=X)),clearTimeout(C.wheel);else{if(L.k===j)return;C.mouse=[X,L.invert(X)],Bn(this),C.start()}Jt(S),C.wheel=setTimeout(A,v),C.zoom("mouse",n(h(E(L,j),C.mouse[0],C.mouse[1]),C.extent,i));function A(){C.wheel=null,C.end()}}function D(S,...R){if(p||!e.apply(this,arguments))return;var C=S.currentTarget,L=H(this,R,!0).event(S),j=it(S.view).on("mousemove.zoom",W,!0).on("mouseup.zoom",Q,!0),X=ut(S,C),A=S.clientX,U=S.clientY;$a(S.view),_o(S),L.mouse=[X,this.__zoom.invert(X)],Bn(this),L.start();function W(ee){if(Jt(ee),!L.moved){var re=ee.clientX-A,ye=ee.clientY-U;L.moved=re*re+ye*ye>g}L.event(ee).zoom("mouse",n(h(L.that.__zoom,L.mouse[0]=ut(ee,C),L.mouse[1]),L.extent,i))}function Q(ee){j.on("mousemove.zoom mouseup.zoom",null),Ea(ee.view,L.moved),Jt(ee),L.event(ee).end()}}function G(S,...R){if(e.apply(this,arguments)){var C=this.__zoom,L=ut(S.changedTouches?S.changedTouches[0]:S,this),j=C.invert(L),X=C.k*(S.shiftKey?.5:2),A=n(h(E(C,X),L,j),t.apply(this,R),i);Jt(S),l>0?it(this).transition().duration(l).call(B,A,L,S):it(this).call(k.transform,A,L,S)}}function z(S,...R){if(e.apply(this,arguments)){var C=S.touches,L=C.length,j=H(this,R,S.changedTouches.length===L).event(S),X,A,U,W;for(_o(S),A=0;A<L;++A)U=C[A],W=ut(U,this),W=[W,this.__zoom.invert(W),U.identifier],j.touch0?!j.touch1&&j.touch0[2]!==W[2]&&(j.touch1=W,j.taps=0):(j.touch0=W,X=!0,j.taps=1+!!c);c&&(c=clearTimeout(c)),X&&(j.taps<2&&(d=W[0],c=setTimeout(function(){c=null},f)),Bn(this),j.start())}}function b(S,...R){if(this.__zooming){var C=H(this,R).event(S),L=S.changedTouches,j=L.length,X,A,U,W;for(Jt(S),X=0;X<j;++X)A=L[X],U=ut(A,this),C.touch0&&C.touch0[2]===A.identifier?C.touch0[0]=U:C.touch1&&C.touch1[2]===A.identifier&&(C.touch1[0]=U);if(A=C.that.__zoom,C.touch1){var Q=C.touch0[0],ee=C.touch0[1],re=C.touch1[0],ye=C.touch1[1],pe=(pe=re[0]-Q[0])*pe+(pe=re[1]-Q[1])*pe,ve=(ve=ye[0]-ee[0])*ve+(ve=ye[1]-ee[1])*ve;A=E(A,Math.sqrt(pe/ve)),U=[(Q[0]+re[0])/2,(Q[1]+re[1])/2],W=[(ee[0]+ye[0])/2,(ee[1]+ye[1])/2]}else if(C.touch0)U=C.touch0[0],W=C.touch0[1];else return;C.zoom("touch",n(h(A,U,W),C.extent,i))}}function V(S,...R){if(this.__zooming){var C=H(this,R).event(S),L=S.changedTouches,j=L.length,X,A;for(_o(S),p&&clearTimeout(p),p=setTimeout(function(){p=null},f),X=0;X<j;++X)A=L[X],C.touch0&&C.touch0[2]===A.identifier?delete C.touch0:C.touch1&&C.touch1[2]===A.identifier&&delete C.touch1;if(C.touch1&&!C.touch0&&(C.touch0=C.touch1,delete C.touch1),C.touch0)C.touch0[1]=this.__zoom.invert(C.touch0[0]);else if(C.end(),C.taps===2&&(A=ut(A,this),Math.hypot(d[0]-A[0],d[1]-A[1])<y)){var U=it(this).on("dblclick.zoom");U&&U.apply(this,arguments)}}}return k.wheelDelta=function(S){return arguments.length?(o=typeof S=="function"?S:En(+S),k):o},k.filter=function(S){return arguments.length?(e=typeof S=="function"?S:En(!!S),k):e},k.touchable=function(S){return arguments.length?(s=typeof S=="function"?S:En(!!S),k):s},k.extent=function(S){return arguments.length?(t=typeof S=="function"?S:En([[+S[0][0],+S[0][1]],[+S[1][0],+S[1][1]]]),k):t},k.scaleExtent=function(S){return arguments.length?(a[0]=+S[0],a[1]=+S[1],k):[a[0],a[1]]},k.translateExtent=function(S){return arguments.length?(i[0][0]=+S[0][0],i[1][0]=+S[1][0],i[0][1]=+S[0][1],i[1][1]=+S[1][1],k):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},k.constrain=function(S){return arguments.length?(n=S,k):n},k.duration=function(S){return arguments.length?(l=+S,k):l},k.interpolate=function(S){return arguments.length?(r=S,k):r},k.on=function(){var S=u.on.apply(u,arguments);return S===u?k:S},k.clickDistance=function(S){return arguments.length?(g=(S=+S)*S,k):Math.sqrt(g)},k.tapDistance=function(S){return arguments.length?(y=+S,k):y},k}var oe=(e=>(e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom",e))(oe||{}),os=(e=>(e.Partial="partial",e.Full="full",e))(os||{}),Mt=(e=>(e.Bezier="default",e.SimpleBezier="simple-bezier",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e))(Mt||{}),Nt=(e=>(e.Strict="strict",e.Loose="loose",e))(Nt||{}),Gt=(e=>(e.Arrow="arrow",e.ArrowClosed="arrowclosed",e))(Gt||{}),sn=(e=>(e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal",e))(sn||{});function Uo(e){var t,n;const o=((n=(t=e.composedPath)==null?void 0:t.call(e))==null?void 0:n[0])||e.target,s=typeof(o==null?void 0:o.hasAttribute)=="function"?o.hasAttribute("contenteditable"):!1,a=typeof(o==null?void 0:o.closest)=="function"?o.closest(".nokey"):null;return["INPUT","SELECT","TEXTAREA"].includes(o==null?void 0:o.nodeName)||s||!!a}function Ld(e){return e.ctrlKey||e.metaKey||e.shiftKey}function Ms(e,t,n,o){const s=t.replace("+",`
`).replace(`

`,`
+`).split(`
`).map(i=>i.trim().toLowerCase());if(s.length===1)return e.toLowerCase()===t.toLowerCase();o||n.add(e.toLowerCase());const a=s.every((i,l)=>n.has(i)&&Array.from(n.values())[l]===s[l]);return o&&n.delete(e.toLowerCase()),a}function Gd(e,t){return n=>{if(!n.code&&!n.key)return!1;const o=Hd(n.code,e);return Array.isArray(e)?e.some(s=>Ms(n[o],s,t,n.type==="keyup")):Ms(n[o],e,t,n.type==="keyup")}}function Hd(e,t){return t.includes(e)?"code":"key"}function an(e,t){const n=Ue(()=>Te(t==null?void 0:t.actInsideInputWithModifier)??!1),o=Ue(()=>Te(t==null?void 0:t.target)??window),s=q(Te(e)===!0);let a=!1;const i=new Set;let l=u(Te(e));Me(()=>Te(e),(c,d)=>{typeof d=="boolean"&&typeof c!="boolean"&&r(),l=u(c)},{immediate:!0}),fa(["blur","contextmenu"],r),fs((...c)=>l(...c),c=>{a=Ld(c),!((!a||a&&!n.value)&&Uo(c))&&(c.preventDefault(),s.value=!0)},{eventName:"keydown",target:o}),fs((...c)=>l(...c),c=>{if(s.value){if((!a||a&&!n.value)&&Uo(c))return;a=!1,s.value=!1}},{eventName:"keyup",target:o});function r(){a=!1,i.clear(),s.value=Te(e)===!0}function u(c){return c===null?(r(),()=>!1):typeof c=="boolean"?(r(),s.value=c,()=>!1):Array.isArray(c)||typeof c=="string"?Gd(c,i):c}return s}const Ua="vue-flow__node-desc",La="vue-flow__edge-desc",Fd="vue-flow__aria-live",Ga=["Enter"," ","Escape"],Ht={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};function Yn(e){return{...e.computedPosition||{x:0,y:0},width:e.dimensions.width||0,height:e.dimensions.height||0}}function qn(e,t){const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),o=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*o)}function to(e){return{width:e.offsetWidth,height:e.offsetHeight}}function Pt(e,t=0,n=1){return Math.min(Math.max(e,t),n)}function Ha(e,t){return{x:Pt(e.x,t[0][0],t[1][0]),y:Pt(e.y,t[0][1],t[1][1])}}function Vs(e){const t=e.getRootNode();return"elementFromPoint"in t?t:window.document}function It(e){return e&&typeof e=="object"&&"id"in e&&"source"in e&&"target"in e}function At(e){return e&&typeof e=="object"&&"id"in e&&"position"in e&&!It(e)}function nn(e){return At(e)&&"computedPosition"in e}function kn(e){return!Number.isNaN(e)&&Number.isFinite(e)}function Yd(e){return kn(e.width)&&kn(e.height)&&kn(e.x)&&kn(e.y)}function qd(e,t,n){const o={id:e.id.toString(),type:e.type??"default",dimensions:on({width:0,height:0}),computedPosition:on({z:0,...e.position}),handleBounds:{source:[],target:[]},draggable:void 0,selectable:void 0,connectable:void 0,focusable:void 0,selected:!1,dragging:!1,resizing:!1,initialized:!1,isParent:!1,position:{x:0,y:0},data:Le(e.data)?e.data:{},events:on(Le(e.events)?e.events:{})};return Object.assign(t??o,e,{id:e.id.toString(),parentNode:n})}function Fa(e,t,n){var o,s;const a={id:e.id.toString(),type:e.type??(t==null?void 0:t.type)??"default",source:e.source.toString(),target:e.target.toString(),sourceHandle:(o=e.sourceHandle)==null?void 0:o.toString(),targetHandle:(s=e.targetHandle)==null?void 0:s.toString(),updatable:e.updatable??(n==null?void 0:n.updatable),selectable:e.selectable??(n==null?void 0:n.selectable),focusable:e.focusable??(n==null?void 0:n.focusable),data:Le(e.data)?e.data:{},events:on(Le(e.events)?e.events:{}),label:e.label??"",interactionWidth:e.interactionWidth??(n==null?void 0:n.interactionWidth),...n??{}};return Object.assign(t??a,e,{id:e.id.toString()})}function Ya(e,t,n,o){const s=typeof e=="string"?e:e.id,a=new Set,i=o==="source"?"target":"source";for(const l of n)l[i]===s&&a.add(l[o]);return t.filter(l=>a.has(l.id))}function Xd(...e){if(e.length===3){const[a,i,l]=e;return Ya(a,i,l,"target")}const[t,n]=e,o=typeof t=="string"?t:t.id;return n.filter(a=>It(a)&&a.source===o).map(a=>n.find(i=>At(i)&&i.id===a.target))}function Wd(...e){if(e.length===3){const[a,i,l]=e;return Ya(a,i,l,"source")}const[t,n]=e,o=typeof t=="string"?t:t.id;return n.filter(a=>It(a)&&a.target===o).map(a=>n.find(i=>At(i)&&i.id===a.source))}function qa({source:e,sourceHandle:t,target:n,targetHandle:o}){return`vueflow__edge-${e}${t??""}-${n}${o??""}`}function Zd(e,t){return t.some(n=>It(n)&&n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle))}function Lo({x:e,y:t},{x:n,y:o,zoom:s}){return{x:e*s+n,y:t*s+o}}function fn({x:e,y:t},{x:n,y:o,zoom:s},a=!1,i=[1,1]){const l={x:(e-n)/s,y:(t-o)/s};return a?no(l,i):l}function jd(e,t){return{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}}function Xa({x:e,y:t,width:n,height:o}){return{x:e,y:t,x2:e+n,y2:t+o}}function Kd({x:e,y:t,x2:n,y2:o}){return{x:e,y:t,width:n-e,height:o-t}}function ss(e){let t={x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,x2:Number.NEGATIVE_INFINITY,y2:Number.NEGATIVE_INFINITY};for(let n=0;n<e.length;n++){const o=e[n];t=jd(t,Xa({...o.computedPosition,...o.dimensions}))}return Kd(t)}function Wa(e,t,n={x:0,y:0,zoom:1},o=!1,s=!1){const a={...fn(t,n),width:t.width/n.zoom,height:t.height/n.zoom},i=[];for(const l of e){const{dimensions:r,selectable:u=!0,hidden:c=!1}=l,d=r.width??l.width??null,p=r.height??l.height??null;if(s&&!u||c)continue;const f=qn(a,Yn(l)),v=d===null||p===null,g=o&&f>0,y=(d??0)*(p??0);(v||g||f>=y||l.dragging)&&i.push(l)}return i}function Za(e,t){const n=new Set;if(typeof e=="string")n.add(e);else if(e.length>=1)for(const o of e)n.add(o.id);return t.filter(o=>n.has(o.source)||n.has(o.target))}function Ds(e,t,n,o,s,a=.1,i={x:0,y:0}){const l=t/(e.width*(1+a)),r=n/(e.height*(1+a)),u=Math.min(l,r),c=Pt(u,o,s),d=e.x+e.width/2,p=e.y+e.height/2,f=t/2-d*c+(i.x??0),v=n/2-p*c+(i.y??0);return{x:f,y:v,zoom:c}}function Jd(e,t){return{x:t.x+e.x,y:t.y+e.y,z:(e.z>t.z?e.z:t.z)+1}}function ja(e,t){if(!e.parentNode)return!1;const n=t(e.parentNode);return n?n.selected?!0:ja(n,t):!1}function pn(e,t){return typeof e>"u"?"":typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(o=>`${o}=${e[o]}`).join("&")}`}function Bs(e,t,n){return e<t?Pt(Math.abs(e-t),1,t)/t:e>n?-Pt(Math.abs(e-n),1,t)/t:0}function Ka(e,t,n=15,o=40){const s=Bs(e.x,o,t.width-o)*n,a=Bs(e.y,o,t.height-o)*n;return[s,a]}function bo(e,t){if(t){const n=e.position.x+e.dimensions.width-t.dimensions.width,o=e.position.y+e.dimensions.height-t.dimensions.height;if(n>0||o>0||e.position.x<0||e.position.y<0){let s={};if(typeof t.style=="function"?s={...t.style(t)}:t.style&&(s={...t.style}),s.width=s.width??`${t.dimensions.width}px`,s.height=s.height??`${t.dimensions.height}px`,n>0)if(typeof s.width=="string"){const a=Number(s.width.replace("px",""));s.width=`${a+n}px`}else s.width+=n;if(o>0)if(typeof s.height=="string"){const a=Number(s.height.replace("px",""));s.height=`${a+o}px`}else s.height+=o;if(e.position.x<0){const a=Math.abs(e.position.x);if(t.position.x=t.position.x-a,typeof s.width=="string"){const i=Number(s.width.replace("px",""));s.width=`${i+a}px`}else s.width+=a;e.position.x=0}if(e.position.y<0){const a=Math.abs(e.position.y);if(t.position.y=t.position.y-a,typeof s.height=="string"){const i=Number(s.height.replace("px",""));s.height=`${i+a}px`}else s.height+=a;e.position.y=0}t.dimensions.width=Number(s.width.toString().replace("px","")),t.dimensions.height=Number(s.height.toString().replace("px","")),typeof t.style=="function"?t.style=a=>{const i=t.style;return{...i(a),...s}}:t.style={...t.style,...s}}}}function As(e,t){var n,o;const s=e.filter(i=>i.type==="add"||i.type==="remove");for(const i of s)if(i.type==="add")t.findIndex(r=>r.id===i.item.id)===-1&&t.push(i.item);else if(i.type==="remove"){const l=t.findIndex(r=>r.id===i.id);l!==-1&&t.splice(l,1)}const a=t.map(i=>i.id);for(const i of t)for(const l of e)if(l.id===i.id)switch(l.type){case"select":i.selected=l.selected;break;case"position":if(nn(i)&&(typeof l.position<"u"&&(i.position=l.position),typeof l.dragging<"u"&&(i.dragging=l.dragging),i.expandParent&&i.parentNode)){const r=t[a.indexOf(i.parentNode)];r&&nn(r)&&bo(i,r)}break;case"dimensions":if(nn(i)&&(typeof l.dimensions<"u"&&(i.dimensions=l.dimensions),typeof l.updateStyle<"u"&&l.updateStyle&&(i.style={...i.style||{},width:`${(n=l.dimensions)==null?void 0:n.width}px`,height:`${(o=l.dimensions)==null?void 0:o.height}px`}),typeof l.resizing<"u"&&(i.resizing=l.resizing),i.expandParent&&i.parentNode)){const r=t[a.indexOf(i.parentNode)];r&&nn(r)&&(!!r.dimensions.width&&!!r.dimensions.height?bo(i,r):Fe(()=>{bo(i,r)}))}break}return t}function xt(e,t){return{id:e,type:"select",selected:t}}function Os(e){return{item:e,type:"add"}}function Ps(e){return{id:e,type:"remove"}}function zs(e,t,n,o,s){return{id:e,source:t,target:n,sourceHandle:o||null,targetHandle:s||null,type:"remove"}}function $t(e,t=new Set,n=!1){const o=[];for(const[s,a]of e){const i=t.has(s);!(a.selected===void 0&&!i)&&a.selected!==i&&(n&&(a.selected=i),o.push(xt(a.id,i)))}return o}function ae(e){const t=new Set;let n=!1;const o=()=>t.size>0;e&&(n=!0,t.add(e));const s=l=>{t.delete(l)};return{on:l=>{e&&n&&t.delete(e),t.add(l);const r=()=>{s(l),e&&n&&t.add(e)};return jn(r),{off:r}},off:s,trigger:l=>Promise.all(Array.from(t).map(r=>r(l))),hasListeners:o,fns:t}}function Rs(e,t,n){let o=e;do{if(o&&o.matches(t))return!0;if(o===n)return!1;o=o.parentElement}while(o);return!1}function Qd(e,t,n,o,s){var a,i;const l=[];for(const r of e)(r.selected||r.id===s)&&(!r.parentNode||!ja(r,o))&&(r.draggable||t&&typeof r.draggable>"u")&&l.push(on({id:r.id,position:r.position||{x:0,y:0},distance:{x:n.x-((a=r.computedPosition)==null?void 0:a.x)||0,y:n.y-((i=r.computedPosition)==null?void 0:i.y)||0},from:r.computedPosition,extent:r.extent,parentNode:r.parentNode,dimensions:r.dimensions,expandParent:r.expandParent}));return l}function wo({id:e,dragItems:t,findNode:n}){const o=[];for(const s of t){const a=n(s.id);a&&o.push(a)}return[e?o.find(s=>s.id===e):o[0],o]}function Ja(e){if(Array.isArray(e))switch(e.length){case 1:return[e[0],e[0],e[0],e[0]];case 2:return[e[0],e[1],e[0],e[1]];case 3:return[e[0],e[1],e[2],e[1]];case 4:return e;default:return[0,0,0,0]}return[e,e,e,e]}function ef(e,t,n){const[o,s,a,i]=typeof e!="string"?Ja(e.padding):[0,0,0,0];return n&&typeof n.computedPosition.x<"u"&&typeof n.computedPosition.y<"u"&&typeof n.dimensions.width<"u"&&typeof n.dimensions.height<"u"?[[n.computedPosition.x+i,n.computedPosition.y+o],[n.computedPosition.x+n.dimensions.width-s,n.computedPosition.y+n.dimensions.height-a]]:!1}function tf(e,t,n,o){let s=e.extent||n;if((s==="parent"||!Array.isArray(s)&&(s==null?void 0:s.range)==="parent")&&!e.expandParent)if(e.parentNode&&o&&e.dimensions.width&&e.dimensions.height){const a=ef(s,e,o);a&&(s=a)}else t(new Ye(Ge.NODE_EXTENT_INVALID,e.id)),s=n;else if(Array.isArray(s)){const a=(o==null?void 0:o.computedPosition.x)||0,i=(o==null?void 0:o.computedPosition.y)||0;s=[[s[0][0]+a,s[0][1]+i],[s[1][0]+a,s[1][1]+i]]}else if(s!=="parent"&&(s!=null&&s.range)&&Array.isArray(s.range)){const[a,i,l,r]=Ja(s.padding),u=(o==null?void 0:o.computedPosition.x)||0,c=(o==null?void 0:o.computedPosition.y)||0;s=[[s.range[0][0]+u+r,s.range[0][1]+c+a],[s.range[1][0]+u-i,s.range[1][1]+c-l]]}return s==="parent"?[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]]:s}function nf({width:e,height:t},n){return[n[0],[n[1][0]-(e||0),n[1][1]-(t||0)]]}function as(e,t,n,o,s){const a=nf(e.dimensions,tf(e,n,o,s)),i=Ha(t,a);return{position:{x:i.x-((s==null?void 0:s.computedPosition.x)||0),y:i.y-((s==null?void 0:s.computedPosition.y)||0)},computedPosition:i}}function Wt(e,t,n=oe.Left,o=!1){const s=((t==null?void 0:t.x)??0)+e.computedPosition.x,a=((t==null?void 0:t.y)??0)+e.computedPosition.y,{width:i,height:l}=t??af(e);if(o)return{x:s+i/2,y:a+l/2};switch((t==null?void 0:t.position)??n){case oe.Top:return{x:s+i/2,y:a};case oe.Right:return{x:s+i,y:a+l/2};case oe.Bottom:return{x:s+i/2,y:a+l};case oe.Left:return{x:s,y:a+l/2}}}function Us(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function of({sourcePos:e,targetPos:t,sourceWidth:n,sourceHeight:o,targetWidth:s,targetHeight:a,width:i,height:l,viewport:r}){const u={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+n,t.x+s),y2:Math.max(e.y+o,t.y+a)};u.x===u.x2&&(u.x2+=1),u.y===u.y2&&(u.y2+=1);const c=Xa({x:(0-r.x)/r.zoom,y:(0-r.y)/r.zoom,width:i/r.zoom,height:l/r.zoom}),d=Math.max(0,Math.min(c.x2,u.x2)-Math.max(c.x,u.x)),p=Math.max(0,Math.min(c.y2,u.y2)-Math.max(c.y,u.y));return Math.ceil(d*p)>0}function sf(e,t,n=!1){const o=typeof e.zIndex=="number";let s=o?e.zIndex:0;const a=t(e.source),i=t(e.target);return!a||!i?0:(n&&(s=o?e.zIndex:Math.max(a.computedPosition.z||0,i.computedPosition.z||0)),s)}var Ge=(e=>(e.MISSING_STYLES="MISSING_STYLES",e.MISSING_VIEWPORT_DIMENSIONS="MISSING_VIEWPORT_DIMENSIONS",e.NODE_INVALID="NODE_INVALID",e.NODE_NOT_FOUND="NODE_NOT_FOUND",e.NODE_MISSING_PARENT="NODE_MISSING_PARENT",e.NODE_TYPE_MISSING="NODE_TYPE_MISSING",e.NODE_EXTENT_INVALID="NODE_EXTENT_INVALID",e.EDGE_INVALID="EDGE_INVALID",e.EDGE_NOT_FOUND="EDGE_NOT_FOUND",e.EDGE_SOURCE_MISSING="EDGE_SOURCE_MISSING",e.EDGE_TARGET_MISSING="EDGE_TARGET_MISSING",e.EDGE_TYPE_MISSING="EDGE_TYPE_MISSING",e.EDGE_SOURCE_TARGET_SAME="EDGE_SOURCE_TARGET_SAME",e.EDGE_SOURCE_TARGET_MISSING="EDGE_SOURCE_TARGET_MISSING",e.EDGE_ORPHANED="EDGE_ORPHANED",e.USEVUEFLOW_OPTIONS="USEVUEFLOW_OPTIONS",e))(Ge||{});const Ls={MISSING_STYLES:()=>"It seems that you haven't loaded the necessary styles. Please import '@vue-flow/core/dist/style.css' to ensure that the graph is rendered correctly",MISSING_VIEWPORT_DIMENSIONS:()=>"The Vue Flow parent container needs a width and a height to render the graph",NODE_INVALID:e=>`Node is invalid
Node: ${e}`,NODE_NOT_FOUND:e=>`Node not found
Node: ${e}`,NODE_MISSING_PARENT:(e,t)=>`Node is missing a parent
Node: ${e}
Parent: ${t}`,NODE_TYPE_MISSING:e=>`Node type is missing
Type: ${e}`,NODE_EXTENT_INVALID:e=>`Only child nodes can use a parent extent
Node: ${e}`,EDGE_INVALID:e=>`An edge needs a source and a target
Edge: ${e}`,EDGE_SOURCE_MISSING:(e,t)=>`Edge source is missing
Edge: ${e} 
Source: ${t}`,EDGE_TARGET_MISSING:(e,t)=>`Edge target is missing
Edge: ${e} 
Target: ${t}`,EDGE_TYPE_MISSING:e=>`Edge type is missing
Type: ${e}`,EDGE_SOURCE_TARGET_SAME:(e,t,n)=>`Edge source and target are the same
Edge: ${e} 
Source: ${t} 
Target: ${n}`,EDGE_SOURCE_TARGET_MISSING:(e,t,n)=>`Edge source or target is missing
Edge: ${e} 
Source: ${t} 
Target: ${n}`,EDGE_ORPHANED:e=>`Edge was orphaned (suddenly missing source or target) and has been removed
Edge: ${e}`,EDGE_NOT_FOUND:e=>`Edge not found
Edge: ${e}`,USEVUEFLOW_OPTIONS:()=>"The options parameter is deprecated and will be removed in the next major version. Please use the id parameter instead"};class Ye extends Error{constructor(t,...n){var o;super((o=Ls[t])==null?void 0:o.call(Ls,...n)),this.name="VueFlowError",this.code=t,this.args=n}}function is(e){return"clientX"in e}function Qa(e){return"sourceEvent"in e}function Et(e,t){var n,o;const s=is(e),a=s?e.clientX:(n=e.touches)==null?void 0:n[0].clientX,i=s?e.clientY:(o=e.touches)==null?void 0:o[0].clientY;return{x:a-((t==null?void 0:t.left)??0),y:i-((t==null?void 0:t.top)??0)}}const Xn=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function af(e){var t,n;return{width:((t=e.dimensions)==null?void 0:t.width)??e.width??0,height:((n=e.dimensions)==null?void 0:n.height)??e.height??0}}function no(e,t=[1,1]){return{x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}}const lf=()=>!0;function So(e){e==null||e.classList.remove("valid","connecting","vue-flow__handle-valid","vue-flow__handle-connecting")}function rf(e,t,n){const o=[],s={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const a of t.values())qn(s,Yn(a))>0&&o.push(a);return o}const uf=250;function cf(e,t,n,o){var s,a;let i=[],l=Number.POSITIVE_INFINITY;const r=rf(e,n,t+uf);for(const u of r){const c=[...((s=u.handleBounds)==null?void 0:s.source)??[],...((a=u.handleBounds)==null?void 0:a.target)??[]];for(const d of c){if(o.nodeId===d.nodeId&&o.type===d.type&&o.id===d.id)continue;const{x:p,y:f}=Wt(u,d,d.position,!0),v=Math.sqrt((p-e.x)**2+(f-e.y)**2);v>t||(v<l?(i=[{...d,x:p,y:f}],l=v):v===l&&i.push({...d,x:p,y:f}))}}if(!i.length)return null;if(i.length>1){const u=o.type==="source"?"target":"source";return i.find(c=>c.type===u)??i[0]}return i[0]}function Gs(e,{handle:t,connectionMode:n,fromNodeId:o,fromHandleId:s,fromType:a,doc:i,lib:l,flowId:r,isValidConnection:u=lf},c,d,p){const f=a==="target",v=t?i.querySelector(`.${l}-flow__handle[data-id="${r}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:g,y}=Et(e),k=i.elementFromPoint(g,y),E=k!=null&&k.classList.contains(`${l}-flow__handle`)?k:v,h={handleDomNode:E,isValid:!1,connection:null,toHandle:null};if(E){const I=ei(void 0,E),B=E.getAttribute("data-nodeid"),H=E.getAttribute("data-handleid"),F=E.classList.contains("connectable"),Y=E.classList.contains("connectableend");if(!B||!I)return h;const D={source:f?B:o,sourceHandle:f?H:s,target:f?o:B,targetHandle:f?s:H};h.connection=D;const z=F&&Y&&(n===Nt.Strict?f&&I==="source"||!f&&I==="target":B!==o||H!==s);h.isValid=z&&u(D,{nodes:d,edges:c,sourceNode:p(o),targetNode:p(B)}),h.toHandle=t}return h}function ei(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function df(e,t){let n=null;return t?n="valid":e&&!t&&(n="invalid"),n}function ff(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}function pf(e,t,n,o,s,a=!1){var i,l,r;const u=o.get(e);if(!u)return null;const c=s===Nt.Strict?(i=u.handleBounds)==null?void 0:i[t]:[...((l=u.handleBounds)==null?void 0:l.source)??[],...((r=u.handleBounds)==null?void 0:r.target)??[]],d=(n?c==null?void 0:c.find(p=>p.id===n):c==null?void 0:c[0])??null;return d&&a?{...d,...Wt(u,d,d.position,!0)}:d}const Go={[oe.Left]:oe.Right,[oe.Right]:oe.Left,[oe.Top]:oe.Bottom,[oe.Bottom]:oe.Top},mf=["production","prod"];function oo(e,...t){ti()&&console.warn(`[Vue Flow]: ${e}`,...t)}function ti(){return!mf.includes("production")}function Hs(e,t,n,o){const s=t.querySelectorAll(`.vue-flow__handle.${e}`);return Array.from(s).map(i=>{const l=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),position:i.getAttribute("data-handlepos"),nodeId:i.getAttribute("data-nodeid"),type:e,x:(l.left-n.left)/o,y:(l.top-n.top)/o,...to(i)}})}function Ho(e,t,n,o,s,a=!1,i){s.value=!1,e.selected?(a||e.selected&&t)&&(o([e]),Fe(()=>{i.blur()})):n([e])}function Le(e){return typeof P(e)<"u"}function vf(e,t,n,o){if(!e||!e.source||!e.target)return n(new Ye(Ge.EDGE_INVALID,(e==null?void 0:e.id)??"[ID UNKNOWN]")),!1;let s;return It(e)?s=e:s={...e,id:qa(e)},s=Fa(s,void 0,o),Zd(s,t)?!1:s}function hf(e,t,n,o,s){if(!t.source||!t.target)return s(new Ye(Ge.EDGE_INVALID,e.id)),!1;if(!n)return s(new Ye(Ge.EDGE_NOT_FOUND,e.id)),!1;const{id:a,...i}=e;return{...i,id:o?qa(t):a,source:t.source,target:t.target,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle}}function Fs(e,t,n){const o={},s=[];for(let a=0;a<e.length;++a){const i=e[a];if(!At(i)){n(new Ye(Ge.NODE_INVALID,i==null?void 0:i.id)||`[ID UNKNOWN|INDEX ${a}]`);continue}const l=qd(i,t(i.id),i.parentNode);i.parentNode&&(o[i.parentNode]=!0),s[a]=l}for(const a of s){const i=t(a.parentNode)||s.find(l=>l.id===a.parentNode);a.parentNode&&!i&&n(new Ye(Ge.NODE_MISSING_PARENT,a.id,a.parentNode)),(a.parentNode||o[a.id])&&(o[a.id]&&(a.isParent=!0),i&&(i.isParent=!0))}return s}function Ys(e,t,n,o,s,a){let i=s;const l=o.get(i)||new Map;o.set(i,l.set(n,t)),i=`${s}-${e}`;const r=o.get(i)||new Map;if(o.set(i,r.set(n,t)),a){i=`${s}-${e}-${a}`;const u=o.get(i)||new Map;o.set(i,u.set(n,t))}}function xo(e,t,n){e.clear(),t.clear();for(const o of n){const{source:s,target:a,sourceHandle:i=null,targetHandle:l=null}=o,r={edgeId:o.id,source:s,target:a,sourceHandle:i,targetHandle:l},u=`${s}-${i}--${a}-${l}`,c=`${a}-${l}--${s}-${i}`;Ys("source",r,c,e,s,i),Ys("target",r,u,e,a,l),t.set(o.id,o)}}function qs(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Co(e,t,n,o,s,a,i,l){const r=[];for(const u of e){const c=It(u)?u:vf(u,l,s,a);if(!c)continue;const d=n(c.source),p=n(c.target);if(!d||!p){s(new Ye(Ge.EDGE_SOURCE_TARGET_MISSING,c.id,c.source,c.target));continue}if(!d){s(new Ye(Ge.EDGE_SOURCE_MISSING,c.id,c.source));continue}if(!p){s(new Ye(Ge.EDGE_TARGET_MISSING,c.id,c.target));continue}if(t&&!t(c,{edges:l,nodes:i,sourceNode:d,targetNode:p})){s(new Ye(Ge.EDGE_INVALID,c.id));continue}const f=o(c.id);r.push({...Fa(c,f,a),sourceNode:d,targetNode:p})}return r}const Xs=Symbol("vueFlow"),ls=Symbol("nodeId"),ni=Symbol("nodeRef"),gf=Symbol("edgeId"),yf=Symbol("edgeRef"),so=Symbol("slots");function oi(e){const{vueFlowRef:t,snapToGrid:n,snapGrid:o,noDragClassName:s,nodes:a,nodeExtent:i,nodeDragThreshold:l,viewport:r,autoPanOnNodeDrag:u,autoPanSpeed:c,nodesDraggable:d,panBy:p,findNode:f,multiSelectionActive:v,nodesSelectionActive:g,selectNodesOnDrag:y,removeSelectedElements:k,addSelectedNodes:E,updateNodePositions:h,emits:I}=Re(),{onStart:B,onDrag:H,onStop:F,onClick:Y,el:D,disabled:G,id:z,selectable:b,dragHandle:V}=e,S=q(!1);let R=[],C,L=null,j={x:void 0,y:void 0},X={x:0,y:0},A=null,U=!1,W=0,Q=!1;const ee=wf(),re=({x:ie,y:fe})=>{j={x:ie,y:fe};let _e=!1;if(R=R.map(x=>{const w={x:ie-x.distance.x,y:fe-x.distance.y},{computedPosition:N}=as(x,n.value?no(w,o.value):w,I.error,i.value,x.parentNode?f(x.parentNode):void 0);return _e=_e||x.position.x!==N.x||x.position.y!==N.y,x.position=N,x}),!!_e&&(h(R,!0,!0),S.value=!0,A)){const[x,w]=wo({id:z,dragItems:R,findNode:f});H({event:A,node:x,nodes:w})}},ye=()=>{if(!L)return;const[ie,fe]=Ka(X,L,c.value);if(ie!==0||fe!==0){const _e={x:(j.x??0)-ie/r.value.zoom,y:(j.y??0)-fe/r.value.zoom};p({x:ie,y:fe})&&re(_e)}W=requestAnimationFrame(ye)},pe=(ie,fe)=>{U=!0;const _e=f(z);!y.value&&!v.value&&_e&&(_e.selected||k()),_e&&Te(b)&&y.value&&Ho(_e,v.value,E,k,g,!1,fe);const x=ee(ie.sourceEvent);if(j=x,R=Qd(a.value,d.value,x,f,z),R.length){const[w,N]=wo({id:z,dragItems:R,findNode:f});B({event:ie.sourceEvent,node:w,nodes:N})}},ve=(ie,fe)=>{var _e;ie.sourceEvent.type==="touchmove"&&ie.sourceEvent.touches.length>1||(l.value===0&&pe(ie,fe),j=ee(ie.sourceEvent),L=((_e=t.value)==null?void 0:_e.getBoundingClientRect())||null,X=Et(ie.sourceEvent,L))},se=(ie,fe)=>{const _e=ee(ie.sourceEvent);if(!Q&&U&&u.value&&(Q=!0,ye()),!U){const x=_e.xSnapped-(j.x??0),w=_e.ySnapped-(j.y??0);Math.sqrt(x*x+w*w)>l.value&&pe(ie,fe)}(j.x!==_e.xSnapped||j.y!==_e.ySnapped)&&R.length&&U&&(A=ie.sourceEvent,X=Et(ie.sourceEvent,L),re(_e))},Se=ie=>{if(!Qa(ie)&&!U&&!S.value&&!v.value){const fe=ie,_e=ee(fe),x=_e.xSnapped-(j.x??0),w=_e.ySnapped-(j.y??0),N=Math.sqrt(x*x+w*w);N!==0&&N<=l.value&&(Y==null||Y(fe));return}if(S.value=!1,Q=!1,U=!1,j={x:void 0,y:void 0},cancelAnimationFrame(W),R.length){h(R,!1,!1);const[fe,_e]=wo({id:z,dragItems:R,findNode:f});F({event:ie.sourceEvent,node:fe,nodes:_e})}};return Me([()=>Te(G),D],([ie,fe],_e,x)=>{if(fe){const w=it(fe);ie||(C=ju().on("start",N=>ve(N,fe)).on("drag",N=>se(N,fe)).on("end",N=>Se(N)).filter(N=>{const $=N.target,Z=Te(V);return!N.button&&(!s.value||!Rs($,`.${s.value}`,fe)&&(!Z||Rs($,Z,fe)))}),w.call(C)),x(()=>{w.on(".drag",null),C&&(C.on("start",null),C.on("drag",null),C.on("end",null))})}}),S}function _f(){return{doubleClick:ae(),click:ae(),mouseEnter:ae(),mouseMove:ae(),mouseLeave:ae(),contextMenu:ae(),updateStart:ae(),update:ae(),updateEnd:ae()}}function bf(e,t){const n=_f();return n.doubleClick.on(o=>{var s,a;t.edgeDoubleClick(o),(a=(s=e.events)==null?void 0:s.doubleClick)==null||a.call(s,o)}),n.click.on(o=>{var s,a;t.edgeClick(o),(a=(s=e.events)==null?void 0:s.click)==null||a.call(s,o)}),n.mouseEnter.on(o=>{var s,a;t.edgeMouseEnter(o),(a=(s=e.events)==null?void 0:s.mouseEnter)==null||a.call(s,o)}),n.mouseMove.on(o=>{var s,a;t.edgeMouseMove(o),(a=(s=e.events)==null?void 0:s.mouseMove)==null||a.call(s,o)}),n.mouseLeave.on(o=>{var s,a;t.edgeMouseLeave(o),(a=(s=e.events)==null?void 0:s.mouseLeave)==null||a.call(s,o)}),n.contextMenu.on(o=>{var s,a;t.edgeContextMenu(o),(a=(s=e.events)==null?void 0:s.contextMenu)==null||a.call(s,o)}),n.updateStart.on(o=>{var s,a;t.edgeUpdateStart(o),(a=(s=e.events)==null?void 0:s.updateStart)==null||a.call(s,o)}),n.update.on(o=>{var s,a;t.edgeUpdate(o),(a=(s=e.events)==null?void 0:s.update)==null||a.call(s,o)}),n.updateEnd.on(o=>{var s,a;t.edgeUpdateEnd(o),(a=(s=e.events)==null?void 0:s.updateEnd)==null||a.call(s,o)}),Object.entries(n).reduce((o,[s,a])=>(o.emit[s]=a.trigger,o.on[s]=a.on,o),{emit:{},on:{}})}function wf(){const{viewport:e,snapGrid:t,snapToGrid:n}=Re();return o=>{const s=Qa(o)?o.sourceEvent:o,{x:a,y:i}=Et(s),l=fn({x:a,y:i},e.value),{x:r,y:u}=n.value?no(l,t.value):l;return{xSnapped:r,ySnapped:u,...l}}}function Nn(){return!0}function si({handleId:e,nodeId:t,type:n,isValidConnection:o,edgeUpdaterType:s,onEdgeUpdate:a,onEdgeUpdateEnd:i}){const{id:l,vueFlowRef:r,connectionMode:u,connectionRadius:c,connectOnClick:d,connectionClickStartHandle:p,nodesConnectable:f,autoPanOnConnect:v,autoPanSpeed:g,findNode:y,panBy:k,startConnection:E,updateConnection:h,endConnection:I,emits:B,viewport:H,edges:F,nodes:Y,isValidConnection:D,nodeLookup:G}=Re();let z=null,b=!1,V=null;function S(C){var L;const j=Te(n)==="target",X=is(C),A=Vs(C.target);if(X&&C.button===0||!X){let U=function(be){x=Et(be,ie),re=cf(fn(x,H.value,!1,[1,1]),c.value,G.value,$),w||(N(),w=!0);const ke=Gs(be,{handle:re,connectionMode:u.value,fromNodeId:Te(t),fromHandleId:Te(e),fromType:j?"target":"source",isValidConnection:ee,doc:A,lib:"vue",flowId:l,nodeLookup:G.value},F.value,Y.value,y);V=ke.handleDomNode,z=ke.connection,b=ff(!!re,ke.isValid);const xe={...de,isValid:b,to:re&&b?Lo({x:re.x,y:re.y},H.value):x,toHandle:ke.toHandle,toPosition:b&&ke.toHandle?ke.toHandle.position:Go[$.position],toNode:ke.toHandle?G.value.get(ke.toHandle.nodeId):null};if(!(b&&re&&(de!=null&&de.toHandle)&&xe.toHandle&&de.toHandle.type===xe.toHandle.type&&de.toHandle.nodeId===xe.toHandle.nodeId&&de.toHandle.id===xe.toHandle.id&&de.to.x===xe.to.x&&de.to.y===xe.to.y)){if(h(re&&b?Lo({x:re.x,y:re.y},H.value):x,ke.toHandle,df(!!re,b)),de=xe,!re&&!b&&!V)return So(_e);z&&z.source!==z.target&&V&&(So(_e),_e=V,V.classList.add("connecting","vue-flow__handle-connecting"),V.classList.toggle("valid",!!b),V.classList.toggle("vue-flow__handle-valid",!!b))}},W=function(be){(re||V)&&z&&b&&(a?a(be,z):B.connect(z)),B.connectEnd(be),s&&(i==null||i(be)),So(_e),cancelAnimationFrame(ye),I(be),w=!1,b=!1,z=null,V=null,A.removeEventListener("mousemove",U),A.removeEventListener("mouseup",W),A.removeEventListener("touchmove",U),A.removeEventListener("touchend",W)};const Q=y(Te(t));let ee=Te(o)||D.value||Nn;!ee&&Q&&(ee=(j?Q.isValidSourcePos:Q.isValidTargetPos)||Nn);let re,ye=0;const{x:pe,y:ve}=Et(C),se=A==null?void 0:A.elementFromPoint(pe,ve),Se=ei(Te(s),se),ie=(L=r.value)==null?void 0:L.getBoundingClientRect();if(!ie||!Se)return;const fe=pf(Te(t),Se,Te(e),G.value,u.value);if(!fe)return;let _e,x=Et(C,ie),w=!1;const N=()=>{if(!v.value)return;const[be,ke]=Ka(x,ie,g.value);k({x:be,y:ke}),ye=requestAnimationFrame(N)},$={...fe,nodeId:Te(t),type:Se,position:fe.position},Z=G.value.get(Te(t)),ce={inProgress:!0,isValid:null,from:Wt(Z,$,oe.Left,!0),fromHandle:$,fromPosition:$.position,fromNode:Z,to:x,toHandle:null,toPosition:Go[$.position],toNode:null};E({nodeId:Te(t),id:Te(e),type:Se,position:(se==null?void 0:se.getAttribute("data-handlepos"))||oe.Top},{x:pe-ie.left,y:ve-ie.top}),B.connectStart({event:C,nodeId:Te(t),handleId:Te(e),handleType:Se});let de=ce;A.addEventListener("mousemove",U),A.addEventListener("mouseup",W),A.addEventListener("touchmove",U),A.addEventListener("touchend",W)}}function R(C){var L,j;if(!d.value)return;const X=Te(n)==="target";if(!p.value){B.clickConnectStart({event:C,nodeId:Te(t),handleId:Te(e)}),E({nodeId:Te(t),type:Te(n),id:Te(e),position:oe.Top},void 0,!0);return}let A=Te(o)||D.value||Nn;const U=y(Te(t));if(!A&&U&&(A=(X?U.isValidSourcePos:U.isValidTargetPos)||Nn),U&&(typeof U.connectable>"u"?f.value:U.connectable)===!1)return;const W=Vs(C.target),Q=Gs(C,{handle:{nodeId:Te(t),id:Te(e),type:Te(n),position:oe.Top},connectionMode:u.value,fromNodeId:p.value.nodeId,fromHandleId:p.value.id||null,fromType:p.value.type,isValidConnection:A,doc:W,lib:"vue",flowId:l,nodeLookup:G.value},F.value,Y.value,y),ee=((L=Q.connection)==null?void 0:L.source)===((j=Q.connection)==null?void 0:j.target);Q.isValid&&Q.connection&&!ee&&B.connect(Q.connection),B.clickConnectEnd(C),I(C,!0)}return{handlePointerDown:S,handleClick:R}}function Sf(){return Xe(ls,"")}function ai(e){const t=e??Sf()??"",n=Xe(ni,q(null)),{findNode:o,edges:s,emits:a}=Re(),i=o(t);return i||a.error(new Ye(Ge.NODE_NOT_FOUND,t)),{id:t,nodeEl:n,node:i,parentNode:J(()=>o(i.parentNode)),connectedEdges:J(()=>Za([i],s.value))}}function xf(){return{doubleClick:ae(),click:ae(),mouseEnter:ae(),mouseMove:ae(),mouseLeave:ae(),contextMenu:ae(),dragStart:ae(),drag:ae(),dragStop:ae()}}function Cf(e,t){const n=xf();return n.doubleClick.on(o=>{var s,a;t.nodeDoubleClick(o),(a=(s=e.events)==null?void 0:s.doubleClick)==null||a.call(s,o)}),n.click.on(o=>{var s,a;t.nodeClick(o),(a=(s=e.events)==null?void 0:s.click)==null||a.call(s,o)}),n.mouseEnter.on(o=>{var s,a;t.nodeMouseEnter(o),(a=(s=e.events)==null?void 0:s.mouseEnter)==null||a.call(s,o)}),n.mouseMove.on(o=>{var s,a;t.nodeMouseMove(o),(a=(s=e.events)==null?void 0:s.mouseMove)==null||a.call(s,o)}),n.mouseLeave.on(o=>{var s,a;t.nodeMouseLeave(o),(a=(s=e.events)==null?void 0:s.mouseLeave)==null||a.call(s,o)}),n.contextMenu.on(o=>{var s,a;t.nodeContextMenu(o),(a=(s=e.events)==null?void 0:s.contextMenu)==null||a.call(s,o)}),n.dragStart.on(o=>{var s,a;t.nodeDragStart(o),(a=(s=e.events)==null?void 0:s.dragStart)==null||a.call(s,o)}),n.drag.on(o=>{var s,a;t.nodeDrag(o),(a=(s=e.events)==null?void 0:s.drag)==null||a.call(s,o)}),n.dragStop.on(o=>{var s,a;t.nodeDragStop(o),(a=(s=e.events)==null?void 0:s.dragStop)==null||a.call(s,o)}),Object.entries(n).reduce((o,[s,a])=>(o.emit[s]=a.trigger,o.on[s]=a.on,o),{emit:{},on:{}})}function ii(){const{getSelectedNodes:e,nodeExtent:t,updateNodePositions:n,findNode:o,snapGrid:s,snapToGrid:a,nodesDraggable:i,emits:l}=Re();return(r,u=!1)=>{const c=a.value?s.value[0]:5,d=a.value?s.value[1]:5,p=u?4:1,f=r.x*c*p,v=r.y*d*p,g=[];for(const y of e.value)if(y.draggable||i&&typeof y.draggable>"u"){const k={x:y.computedPosition.x+f,y:y.computedPosition.y+v},{computedPosition:E}=as(y,k,l.error,t.value,y.parentNode?o(y.parentNode):void 0);g.push({id:y.id,position:E,from:y.position,distance:{x:r.x,y:r.y},dimensions:y.dimensions})}n(g,!0,!1)}}const $o=.1;function St(){return oo("Viewport not initialized yet."),Promise.resolve(!1)}const $f={zoomIn:St,zoomOut:St,zoomTo:St,fitView:St,setCenter:St,fitBounds:St,project:e=>e,screenToFlowCoordinate:e=>e,flowToScreenCoordinate:e=>e,setViewport:St,setTransform:St,getViewport:()=>({x:0,y:0,zoom:1}),getTransform:()=>({x:0,y:0,zoom:1}),viewportInitialized:!1};function Ef(e){function t(o,s){return new Promise(a=>{e.d3Selection&&e.d3Zoom?e.d3Zoom.scaleBy(Eo(e.d3Selection,s,()=>{a(!0)}),o):a(!1)})}function n(o,s,a,i){return new Promise(l=>{const{x:r,y:u}=Ha({x:-o,y:-s},e.translateExtent),c=Xt.translate(-r,-u).scale(a);e.d3Selection&&e.d3Zoom?e.d3Zoom.transform(Eo(e.d3Selection,i,()=>{l(!0)}),c):l(!1)})}return J(()=>e.d3Zoom&&e.d3Selection&&e.dimensions.width&&e.dimensions.height?{viewportInitialized:!0,zoomIn:s=>t(1.2,s==null?void 0:s.duration),zoomOut:s=>t(1/1.2,s==null?void 0:s.duration),zoomTo:(s,a)=>new Promise(i=>{e.d3Selection&&e.d3Zoom?e.d3Zoom.scaleTo(Eo(e.d3Selection,a==null?void 0:a.duration,()=>{i(!0)}),s):i(!1)}),setViewport:(s,a)=>n(s.x,s.y,s.zoom,a==null?void 0:a.duration),setTransform:(s,a)=>n(s.x,s.y,s.zoom,a==null?void 0:a.duration),getViewport:()=>({x:e.viewport.x,y:e.viewport.y,zoom:e.viewport.zoom}),getTransform:()=>({x:e.viewport.x,y:e.viewport.y,zoom:e.viewport.zoom}),fitView:(s={padding:$o,includeHiddenNodes:!1,duration:0})=>{var a,i;const l=[];for(const p of e.nodes)p.dimensions.width&&p.dimensions.height&&((s==null?void 0:s.includeHiddenNodes)||!p.hidden)&&(!((a=s.nodes)!=null&&a.length)||(i=s.nodes)!=null&&i.length&&s.nodes.includes(p.id))&&l.push(p);if(!l.length)return Promise.resolve(!1);const r=ss(l),{x:u,y:c,zoom:d}=Ds(r,e.dimensions.width,e.dimensions.height,s.minZoom??e.minZoom,s.maxZoom??e.maxZoom,s.padding??$o,s.offset);return n(u,c,d,s==null?void 0:s.duration)},setCenter:(s,a,i)=>{const l=typeof(i==null?void 0:i.zoom)<"u"?i.zoom:e.maxZoom,r=e.dimensions.width/2-s*l,u=e.dimensions.height/2-a*l;return n(r,u,l,i==null?void 0:i.duration)},fitBounds:(s,a={padding:$o})=>{const{x:i,y:l,zoom:r}=Ds(s,e.dimensions.width,e.dimensions.height,e.minZoom,e.maxZoom,a.padding);return n(i,l,r,a==null?void 0:a.duration)},project:s=>fn(s,e.viewport,e.snapToGrid,e.snapGrid),screenToFlowCoordinate:s=>{if(e.vueFlowRef){const{x:a,y:i}=e.vueFlowRef.getBoundingClientRect(),l={x:s.x-a,y:s.y-i};return fn(l,e.viewport,e.snapToGrid,e.snapGrid)}return{x:0,y:0}},flowToScreenCoordinate:s=>{if(e.vueFlowRef){const{x:a,y:i}=e.vueFlowRef.getBoundingClientRect(),l={x:s.x+a,y:s.y+i};return Lo(l,e.viewport)}return{x:0,y:0}}}:$f)}function Eo(e,t=0,n){return e.transition().duration(t).on("end",n)}function kf(e,t,n){const o=na(!0);return o.run(()=>{const s=()=>{o.run(()=>{let g,y,k=!!(n.nodes.value.length||n.edges.value.length);g=Rt([e.modelValue,()=>{var E,h;return(h=(E=e.modelValue)==null?void 0:E.value)==null?void 0:h.length}],([E])=>{E&&Array.isArray(E)&&(y==null||y.pause(),n.setElements(E),!y&&!k&&E.length?k=!0:y==null||y.resume())}),y=Rt([n.nodes,n.edges,()=>n.edges.value.length,()=>n.nodes.value.length],([E,h])=>{var I;(I=e.modelValue)!=null&&I.value&&Array.isArray(e.modelValue.value)&&(g==null||g.pause(),e.modelValue.value=[...E,...h],Fe(()=>{g==null||g.resume()}))},{immediate:k}),Tn(()=>{g==null||g.stop(),y==null||y.stop()})})},a=()=>{o.run(()=>{let g,y,k=!!n.nodes.value.length;g=Rt([e.nodes,()=>{var E,h;return(h=(E=e.nodes)==null?void 0:E.value)==null?void 0:h.length}],([E])=>{E&&Array.isArray(E)&&(y==null||y.pause(),n.setNodes(E),!y&&!k&&E.length?k=!0:y==null||y.resume())}),y=Rt([n.nodes,()=>n.nodes.value.length],([E])=>{var h;(h=e.nodes)!=null&&h.value&&Array.isArray(e.nodes.value)&&(g==null||g.pause(),e.nodes.value=[...E],Fe(()=>{g==null||g.resume()}))},{immediate:k}),Tn(()=>{g==null||g.stop(),y==null||y.stop()})})},i=()=>{o.run(()=>{let g,y,k=!!n.edges.value.length;g=Rt([e.edges,()=>{var E,h;return(h=(E=e.edges)==null?void 0:E.value)==null?void 0:h.length}],([E])=>{E&&Array.isArray(E)&&(y==null||y.pause(),n.setEdges(E),!y&&!k&&E.length?k=!0:y==null||y.resume())}),y=Rt([n.edges,()=>n.edges.value.length],([E])=>{var h;(h=e.edges)!=null&&h.value&&Array.isArray(e.edges.value)&&(g==null||g.pause(),e.edges.value=[...E],Fe(()=>{g==null||g.resume()}))},{immediate:k}),Tn(()=>{g==null||g.stop(),y==null||y.stop()})})},l=()=>{o.run(()=>{Me(()=>t.maxZoom,()=>{t.maxZoom&&Le(t.maxZoom)&&n.setMaxZoom(t.maxZoom)},{immediate:!0})})},r=()=>{o.run(()=>{Me(()=>t.minZoom,()=>{t.minZoom&&Le(t.minZoom)&&n.setMinZoom(t.minZoom)},{immediate:!0})})},u=()=>{o.run(()=>{Me(()=>t.translateExtent,()=>{t.translateExtent&&Le(t.translateExtent)&&n.setTranslateExtent(t.translateExtent)},{immediate:!0})})},c=()=>{o.run(()=>{Me(()=>t.nodeExtent,()=>{t.nodeExtent&&Le(t.nodeExtent)&&n.setNodeExtent(t.nodeExtent)},{immediate:!0})})},d=()=>{o.run(()=>{Me(()=>t.applyDefault,()=>{Le(t.applyDefault)&&(n.applyDefault.value=t.applyDefault)},{immediate:!0})})},p=()=>{o.run(()=>{const g=async y=>{let k=y;typeof t.autoConnect=="function"&&(k=await t.autoConnect(y)),k!==!1&&n.addEdges([k])};Me(()=>t.autoConnect,()=>{Le(t.autoConnect)&&(n.autoConnect.value=t.autoConnect)},{immediate:!0}),Me(n.autoConnect,(y,k,E)=>{y?n.onConnect(g):n.hooks.value.connect.off(g),E(()=>{n.hooks.value.connect.off(g)})},{immediate:!0})})},f=()=>{const g=["id","modelValue","translateExtent","nodeExtent","edges","nodes","maxZoom","minZoom","applyDefault","autoConnect"];for(const y of Object.keys(t)){const k=y;if(!g.includes(k)){const E=Ue(()=>t[k]),h=n[k];qo(h)&&o.run(()=>{Me(E,I=>{Le(I)&&(h.value=I)},{immediate:!0})})}}};(()=>{s(),a(),i(),r(),l(),u(),c(),d(),p(),f()})()}),()=>o.stop()}function Nf(){return{edgesChange:ae(),nodesChange:ae(),nodeDoubleClick:ae(),nodeClick:ae(),nodeMouseEnter:ae(),nodeMouseMove:ae(),nodeMouseLeave:ae(),nodeContextMenu:ae(),nodeDragStart:ae(),nodeDrag:ae(),nodeDragStop:ae(),nodesInitialized:ae(),miniMapNodeClick:ae(),miniMapNodeDoubleClick:ae(),miniMapNodeMouseEnter:ae(),miniMapNodeMouseMove:ae(),miniMapNodeMouseLeave:ae(),connect:ae(),connectStart:ae(),connectEnd:ae(),clickConnectStart:ae(),clickConnectEnd:ae(),paneReady:ae(),init:ae(),move:ae(),moveStart:ae(),moveEnd:ae(),selectionDragStart:ae(),selectionDrag:ae(),selectionDragStop:ae(),selectionContextMenu:ae(),selectionStart:ae(),selectionEnd:ae(),viewportChangeStart:ae(),viewportChange:ae(),viewportChangeEnd:ae(),paneScroll:ae(),paneClick:ae(),paneContextMenu:ae(),paneMouseEnter:ae(),paneMouseMove:ae(),paneMouseLeave:ae(),edgeContextMenu:ae(),edgeMouseEnter:ae(),edgeMouseMove:ae(),edgeMouseLeave:ae(),edgeDoubleClick:ae(),edgeClick:ae(),edgeUpdateStart:ae(),edgeUpdate:ae(),edgeUpdateEnd:ae(),updateNodeInternals:ae(),error:ae(e=>oo(e.message))}}function If(e,t){Ci(()=>{for(const[n,o]of Object.entries(t.value)){const s=a=>{e(n,a)};o.fns.add(s),jn(()=>{o.off(s)})}})}function li(){return{vueFlowRef:null,viewportRef:null,nodes:[],edges:[],connectionLookup:new Map,nodeTypes:{},edgeTypes:{},initialized:!1,dimensions:{width:0,height:0},viewport:{x:0,y:0,zoom:1},d3Zoom:null,d3Selection:null,d3ZoomHandler:null,minZoom:.5,maxZoom:2,translateExtent:[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],nodeExtent:[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],selectionMode:os.Full,paneDragging:!1,preventScrolling:!0,zoomOnScroll:!0,zoomOnPinch:!0,zoomOnDoubleClick:!0,panOnScroll:!1,panOnScrollSpeed:.5,panOnScrollMode:sn.Free,paneClickDistance:0,panOnDrag:!0,edgeUpdaterRadius:10,onlyRenderVisibleElements:!1,defaultViewport:{x:0,y:0,zoom:1},nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,defaultMarkerColor:"#b1b1b7",connectionLineStyle:{},connectionLineType:null,connectionLineOptions:{type:Mt.Bezier,style:{}},connectionMode:Nt.Loose,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectionPosition:{x:Number.NaN,y:Number.NaN},connectionRadius:20,connectOnClick:!0,connectionStatus:null,isValidConnection:null,snapGrid:[15,15],snapToGrid:!1,edgesUpdatable:!1,edgesFocusable:!0,nodesFocusable:!0,nodesConnectable:!0,nodesDraggable:!0,nodeDragThreshold:1,elementsSelectable:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,selectionKeyCode:"Shift",multiSelectionKeyCode:Xn()?"Meta":"Control",zoomActivationKeyCode:Xn()?"Meta":"Control",deleteKeyCode:"Backspace",panActivationKeyCode:"Space",hooks:Nf(),applyDefault:!0,autoConnect:!1,fitViewOnInit:!1,fitViewOnInitDone:!1,noDragClassName:"nodrag",noWheelClassName:"nowheel",noPanClassName:"nopan",defaultEdgeOptions:void 0,elevateEdgesOnSelect:!1,elevateNodesOnSelect:!0,autoPanOnNodeDrag:!0,autoPanOnConnect:!0,autoPanSpeed:15,disableKeyboardA11y:!1,ariaLiveMessage:""}}const Tf=["id","vueFlowRef","viewportRef","initialized","modelValue","nodes","edges","maxZoom","minZoom","translateExtent","hooks","defaultEdgeOptions"];function Mf(e,t,n){const o=Ef(e),s=x=>{const w=x??[];e.hooks.updateNodeInternals.trigger(w)},a=x=>Wd(x,e.nodes,e.edges),i=x=>Xd(x,e.nodes,e.edges),l=x=>Za(x,e.edges),r=({id:x,type:w,nodeId:N})=>{var $;return Array.from((($=e.connectionLookup.get(`${N}-${w}-${x??null}`))==null?void 0:$.values())??[])},u=x=>{if(x)return t.value.get(x)},c=x=>{if(x)return n.value.get(x)},d=(x,w,N)=>{var $,Z;const le=[];for(const ce of x){const de={id:ce.id,type:"position",dragging:N,from:ce.from};if(w&&(de.position=ce.position,ce.parentNode)){const be=u(ce.parentNode);de.position={x:de.position.x-((($=be==null?void 0:be.computedPosition)==null?void 0:$.x)??0),y:de.position.y-(((Z=be==null?void 0:be.computedPosition)==null?void 0:Z.y)??0)}}le.push(de)}le!=null&&le.length&&e.hooks.nodesChange.trigger(le)},p=x=>{if(!e.vueFlowRef)return;const w=e.vueFlowRef.querySelector(".vue-flow__transformationpane");if(!w)return;const N=window.getComputedStyle(w),{m22:$}=new window.DOMMatrixReadOnly(N.transform),Z=[];for(let le=0;le<x.length;++le){const ce=x[le],de=u(ce.id);if(de){const be=to(ce.nodeElement);if(!!(be.width&&be.height&&(de.dimensions.width!==be.width||de.dimensions.height!==be.height||ce.forceUpdate))){const xe=ce.nodeElement.getBoundingClientRect();de.dimensions=be,de.handleBounds.source=Hs("source",ce.nodeElement,xe,$),de.handleBounds.target=Hs("target",ce.nodeElement,xe,$),Z.push({id:de.id,type:"dimensions",dimensions:be})}}}!e.fitViewOnInitDone&&e.fitViewOnInit&&o.value.fitView().then(()=>{e.fitViewOnInitDone=!0}),Z.length&&e.hooks.nodesChange.trigger(Z)},f=(x,w)=>{const N=new Set,$=new Set;for(const ce of x)At(ce)?N.add(ce.id):It(ce)&&$.add(ce.id);const Z=$t(t.value,N,!0),le=$t(n.value,$);if(e.multiSelectionActive){for(const ce of N)Z.push(xt(ce,w));for(const ce of $)le.push(xt(ce,w))}Z.length&&e.hooks.nodesChange.trigger(Z),le.length&&e.hooks.edgesChange.trigger(le)},v=x=>{if(e.multiSelectionActive){const w=x.map(N=>xt(N.id,!0));e.hooks.nodesChange.trigger(w);return}e.hooks.nodesChange.trigger($t(t.value,new Set(x.map(w=>w.id)),!0)),e.hooks.edgesChange.trigger($t(n.value))},g=x=>{if(e.multiSelectionActive){const w=x.map(N=>xt(N.id,!0));e.hooks.edgesChange.trigger(w);return}e.hooks.edgesChange.trigger($t(n.value,new Set(x.map(w=>w.id)))),e.hooks.nodesChange.trigger($t(t.value,new Set,!0))},y=x=>{f(x,!0)},k=x=>{const N=(x||e.nodes).map($=>($.selected=!1,xt($.id,!1)));e.hooks.nodesChange.trigger(N)},E=x=>{const N=(x||e.edges).map($=>($.selected=!1,xt($.id,!1)));e.hooks.edgesChange.trigger(N)},h=x=>{if(!x||!x.length)return f([],!1);const w=x.reduce((N,$)=>{const Z=xt($.id,!1);return At($)?N.nodes.push(Z):N.edges.push(Z),N},{nodes:[],edges:[]});w.nodes.length&&e.hooks.nodesChange.trigger(w.nodes),w.edges.length&&e.hooks.edgesChange.trigger(w.edges)},I=x=>{var w;(w=e.d3Zoom)==null||w.scaleExtent([x,e.maxZoom]),e.minZoom=x},B=x=>{var w;(w=e.d3Zoom)==null||w.scaleExtent([e.minZoom,x]),e.maxZoom=x},H=x=>{var w;(w=e.d3Zoom)==null||w.translateExtent(x),e.translateExtent=x},F=x=>{e.nodeExtent=x,s()},Y=x=>{var w;(w=e.d3Zoom)==null||w.clickDistance(x)},D=x=>{e.nodesDraggable=x,e.nodesConnectable=x,e.elementsSelectable=x},G=x=>{const w=x instanceof Function?x(e.nodes):x;!e.initialized&&!w.length||(e.nodes=Fs(w,u,e.hooks.error.trigger))},z=x=>{const w=x instanceof Function?x(e.edges):x;if(!e.initialized&&!w.length)return;const N=Co(w,e.isValidConnection,u,c,e.hooks.error.trigger,e.defaultEdgeOptions,e.nodes,e.edges);xo(e.connectionLookup,n.value,N),e.edges=N},b=x=>{const w=x instanceof Function?x([...e.nodes,...e.edges]):x;!e.initialized&&!w.length||(G(w.filter(At)),z(w.filter(It)))},V=x=>{let w=x instanceof Function?x(e.nodes):x;w=Array.isArray(w)?w:[w];const N=Fs(w,u,e.hooks.error.trigger),$=[];for(const Z of N)$.push(Os(Z));$.length&&e.hooks.nodesChange.trigger($)},S=x=>{let w=x instanceof Function?x(e.edges):x;w=Array.isArray(w)?w:[w];const N=Co(w,e.isValidConnection,u,c,e.hooks.error.trigger,e.defaultEdgeOptions,e.nodes,e.edges),$=[];for(const Z of N)$.push(Os(Z));$.length&&e.hooks.edgesChange.trigger($)},R=(x,w=!0,N=!1)=>{const $=x instanceof Function?x(e.nodes):x,Z=Array.isArray($)?$:[$],le=[],ce=[];function de(ke){const xe=l(ke);for(const De of xe)(!Le(De.deletable)||De.deletable)&&ce.push(zs(De.id,De.source,De.target,De.sourceHandle,De.targetHandle))}function be(ke){const xe=[];for(const De of e.nodes)De.parentNode===ke&&xe.push(De);if(xe.length){for(const De of xe)le.push(Ps(De.id));w&&de(xe);for(const De of xe)be(De.id)}}for(const ke of Z){const xe=typeof ke=="string"?u(ke):ke;xe&&(Le(xe.deletable)&&!xe.deletable||(le.push(Ps(xe.id)),w&&de([xe]),N&&be(xe.id)))}ce.length&&e.hooks.edgesChange.trigger(ce),le.length&&e.hooks.nodesChange.trigger(le)},C=x=>{const w=x instanceof Function?x(e.edges):x,N=Array.isArray(w)?w:[w],$=[];for(const Z of N){const le=typeof Z=="string"?c(Z):Z;le&&(Le(le.deletable)&&!le.deletable||$.push(zs(typeof Z=="string"?Z:Z.id,le.source,le.target,le.sourceHandle,le.targetHandle)))}e.hooks.edgesChange.trigger($)},L=(x,w,N=!0)=>{const $=c(x.id),Z=hf(x,w,$,N,e.hooks.error.trigger);if(Z){const[le]=Co([Z],e.isValidConnection,u,c,e.hooks.error.trigger,e.defaultEdgeOptions,e.nodes,e.edges);return e.edges.splice(e.edges.indexOf($),1,le),xo(e.connectionLookup,n.value,[le]),le}return!1},j=(x,w,N={replace:!1})=>{const $=c(x);if(!$)return;const Z=typeof w=="function"?w($):w;$.data=N.replace?Z:{...$.data,...Z}},X=x=>As(x,e.nodes),A=x=>{const w=As(x,e.edges);return xo(e.connectionLookup,n.value,w),w},U=(x,w,N={replace:!1})=>{const $=u(x);if(!$)return;const Z=typeof w=="function"?w($):w;N.replace?e.nodes.splice(e.nodes.indexOf($),1,Z):Object.assign($,Z)},W=(x,w,N={replace:!1})=>{const $=u(x);if(!$)return;const Z=typeof w=="function"?w($):w;$.data=N.replace?Z:{...$.data,...Z}},Q=(x,w,N=!1)=>{N?e.connectionClickStartHandle=x:e.connectionStartHandle=x,e.connectionEndHandle=null,e.connectionStatus=null,w&&(e.connectionPosition=w)},ee=(x,w=null,N=null)=>{e.connectionStartHandle&&(e.connectionPosition=x,e.connectionEndHandle=w,e.connectionStatus=N)},re=(x,w)=>{e.connectionPosition={x:Number.NaN,y:Number.NaN},e.connectionEndHandle=null,e.connectionStatus=null,w?e.connectionClickStartHandle=null:e.connectionStartHandle=null},ye=x=>{const w=Yd(x),N=w?null:nn(x)?x:u(x.id);return!w&&!N?[null,null,w]:[w?x:Yn(N),N,w]},pe=(x,w=!0,N=e.nodes)=>{const[$,Z,le]=ye(x);if(!$)return[];const ce=[];for(const de of N||e.nodes){if(!le&&(de.id===Z.id||!de.computedPosition))continue;const be=Yn(de),ke=qn(be,$);(w&&ke>0||ke>=Number($.width)*Number($.height))&&ce.push(de)}return ce},ve=(x,w,N=!0)=>{const[$]=ye(x);if(!$)return!1;const Z=qn($,w);return N&&Z>0||Z>=Number($.width)*Number($.height)},se=x=>{const{viewport:w,dimensions:N,d3Zoom:$,d3Selection:Z,translateExtent:le}=e;if(!$||!Z||!x.x&&!x.y)return!1;const ce=Xt.translate(w.x+x.x,w.y+x.y).scale(w.zoom),de=[[0,0],[N.width,N.height]],be=$.constrain()(ce,de,le),ke=e.viewport.x!==be.x||e.viewport.y!==be.y||e.viewport.zoom!==be.k;return $.transform(Z,be),ke},Se=x=>{const w=x instanceof Function?x(e):x,N=["d3Zoom","d3Selection","d3ZoomHandler","viewportRef","vueFlowRef","dimensions","hooks"];Le(w.defaultEdgeOptions)&&(e.defaultEdgeOptions=w.defaultEdgeOptions);const $=w.modelValue||w.nodes||w.edges?[]:void 0;$&&(w.modelValue&&$.push(...w.modelValue),w.nodes&&$.push(...w.nodes),w.edges&&$.push(...w.edges),b($));const Z=()=>{Le(w.maxZoom)&&B(w.maxZoom),Le(w.minZoom)&&I(w.minZoom),Le(w.translateExtent)&&H(w.translateExtent)};for(const le of Object.keys(w)){const ce=le,de=w[ce];![...Tf,...N].includes(ce)&&Le(de)&&(e[ce]=de)}Mo(()=>e.d3Zoom).not.toBeNull().then(Z),e.initialized||(e.initialized=!0)};return{updateNodePositions:d,updateNodeDimensions:p,setElements:b,setNodes:G,setEdges:z,addNodes:V,addEdges:S,removeNodes:R,removeEdges:C,findNode:u,findEdge:c,updateEdge:L,updateEdgeData:j,updateNode:U,updateNodeData:W,applyEdgeChanges:A,applyNodeChanges:X,addSelectedElements:y,addSelectedNodes:v,addSelectedEdges:g,setMinZoom:I,setMaxZoom:B,setTranslateExtent:H,setNodeExtent:F,setPaneClickDistance:Y,removeSelectedElements:h,removeSelectedNodes:k,removeSelectedEdges:E,startConnection:Q,updateConnection:ee,endConnection:re,setInteractive:D,setState:Se,getIntersectingNodes:pe,getIncomers:a,getOutgoers:i,getConnectedEdges:l,getHandleConnections:r,isNodeIntersecting:ve,panBy:se,fitView:x=>o.value.fitView(x),zoomIn:x=>o.value.zoomIn(x),zoomOut:x=>o.value.zoomOut(x),zoomTo:(x,w)=>o.value.zoomTo(x,w),setViewport:(x,w)=>o.value.setViewport(x,w),setTransform:(x,w)=>o.value.setTransform(x,w),getViewport:()=>o.value.getViewport(),getTransform:()=>o.value.getTransform(),setCenter:(x,w,N)=>o.value.setCenter(x,w,N),fitBounds:(x,w)=>o.value.fitBounds(x,w),project:x=>o.value.project(x),screenToFlowCoordinate:x=>o.value.screenToFlowCoordinate(x),flowToScreenCoordinate:x=>o.value.flowToScreenCoordinate(x),toObject:()=>{const x=[],w=[];for(const N of e.nodes){const{computedPosition:$,handleBounds:Z,selected:le,dimensions:ce,isParent:de,resizing:be,dragging:ke,events:xe,...De}=N;x.push(De)}for(const N of e.edges){const{selected:$,sourceNode:Z,targetNode:le,events:ce,...de}=N;w.push(de)}return JSON.parse(JSON.stringify({nodes:x,edges:w,position:[e.viewport.x,e.viewport.y],zoom:e.viewport.zoom,viewport:e.viewport}))},fromObject:x=>new Promise(w=>{const{nodes:N,edges:$,position:Z,zoom:le,viewport:ce}=x;if(N&&G(N),$&&z($),ce!=null&&ce.x&&(ce!=null&&ce.y)||Z){const de=(ce==null?void 0:ce.x)||Z[0],be=(ce==null?void 0:ce.y)||Z[1],ke=(ce==null?void 0:ce.zoom)||le||e.viewport.zoom;return Mo(()=>o.value.viewportInitialized).toBe(!0).then(()=>{o.value.setViewport({x:de,y:be,zoom:ke}).then(()=>{w(!0)})})}else w(!0)}),updateNodeInternals:s,viewportHelper:o,$reset:()=>{const x=li();if(e.edges=[],e.nodes=[],e.d3Zoom&&e.d3Selection){const w=Xt.translate(x.defaultViewport.x??0,x.defaultViewport.y??0).scale(Pt(x.defaultViewport.zoom??1,x.minZoom,x.maxZoom)),N=e.viewportRef.getBoundingClientRect(),$=[[0,0],[N.width,N.height]],Z=e.d3Zoom.constrain()(w,$,x.translateExtent);e.d3Zoom.transform(e.d3Selection,Z)}Se(x)},$destroy:()=>{}}}const Vf=["data-id","data-handleid","data-nodeid","data-handlepos"],Df={name:"Handle",compatConfig:{MODE:3}},bt=Ie({...Df,props:{id:{default:null},type:{},position:{default:()=>oe.Top},isValidConnection:{type:Function},connectable:{type:[Boolean,Number,String,Function],default:void 0},connectableStart:{type:Boolean,default:!0},connectableEnd:{type:Boolean,default:!0}},setup(e,{expose:t}){const n=Ei(e,["position","connectable","connectableStart","connectableEnd","id"]),o=Ue(()=>n.type??"source"),s=Ue(()=>n.isValidConnection??null),{id:a,connectionStartHandle:i,connectionClickStartHandle:l,connectionEndHandle:r,vueFlowRef:u,nodesConnectable:c,noDragClassName:d,noPanClassName:p}=Re(),{id:f,node:v,nodeEl:g,connectedEdges:y}=ai(),k=q(),E=Ue(()=>typeof e.connectableStart<"u"?e.connectableStart:!0),h=Ue(()=>typeof e.connectableEnd<"u"?e.connectableEnd:!0),I=Ue(()=>{var z,b,V,S,R,C;return((z=i.value)==null?void 0:z.nodeId)===f&&((b=i.value)==null?void 0:b.id)===e.id&&((V=i.value)==null?void 0:V.type)===o.value||((S=r.value)==null?void 0:S.nodeId)===f&&((R=r.value)==null?void 0:R.id)===e.id&&((C=r.value)==null?void 0:C.type)===o.value}),B=Ue(()=>{var z,b,V;return((z=l.value)==null?void 0:z.nodeId)===f&&((b=l.value)==null?void 0:b.id)===e.id&&((V=l.value)==null?void 0:V.type)===o.value}),{handlePointerDown:H,handleClick:F}=si({nodeId:f,handleId:e.id,isValidConnection:s,type:o}),Y=J(()=>typeof e.connectable=="string"&&e.connectable==="single"?!y.value.some(z=>{const b=z[`${o.value}Handle`];return z[o.value]!==f?!1:b?b===e.id:!0}):typeof e.connectable=="number"?y.value.filter(z=>{const b=z[`${o.value}Handle`];return z[o.value]!==f?!1:b?b===e.id:!0}).length<e.connectable:typeof e.connectable=="function"?e.connectable(v,y.value):Le(e.connectable)?e.connectable:c.value);Ze(()=>{var z;if(!v.dimensions.width||!v.dimensions.height)return;const b=(z=v.handleBounds[o.value])==null?void 0:z.find(X=>X.id===e.id);if(!u.value||b)return;const V=u.value.querySelector(".vue-flow__transformationpane");if(!g.value||!k.value||!V||!e.id)return;const S=g.value.getBoundingClientRect(),R=k.value.getBoundingClientRect(),C=window.getComputedStyle(V),{m22:L}=new window.DOMMatrixReadOnly(C.transform),j={id:e.id,position:e.position,x:(R.left-S.left)/L,y:(R.top-S.top)/L,type:o.value,nodeId:f,...to(k.value)};v.handleBounds[o.value]=[...v.handleBounds[o.value]??[],j]}),oa(()=>{const z=v.handleBounds[o.value];z&&(v.handleBounds[o.value]=z.filter(b=>b.id!==e.id))});function D(z){const b=is(z);Y.value&&E.value&&(b&&z.button===0||!b)&&H(z)}function G(z){!f||!l.value&&!E.value||Y.value&&F(z)}return t({handleClick:F,handlePointerDown:H,onClick:G,onPointerDown:D}),(z,b)=>(_(),T("div",{ref_key:"handle",ref:k,"data-id":`${P(a)}-${P(f)}-${e.id}-${o.value}`,"data-handleid":e.id,"data-nodeid":P(f),"data-handlepos":z.position,class:He(["vue-flow__handle",[`vue-flow__handle-${z.position}`,`vue-flow__handle-${e.id}`,P(d),P(p),o.value,{connectable:Y.value,connecting:B.value,connectablestart:E.value,connectableend:h.value,connectionindicator:Y.value&&(E.value&&!I.value||h.value&&I.value)}]]),onMousedown:D,onTouchstartPassive:D,onClick:G},[nt(z.$slots,"default",{id:z.id})],42,Vf))}}),ao=function({sourcePosition:e=oe.Bottom,targetPosition:t=oe.Top,label:n,connectable:o=!0,isValidTargetPos:s,isValidSourcePos:a,data:i}){const l=i.label||n;return[Ae(bt,{type:"target",position:t,connectable:o,isValidConnection:s}),typeof l!="string"&&l?Ae(l):Ae(Ee,[l]),Ae(bt,{type:"source",position:e,connectable:o,isValidConnection:a})]};ao.props=["sourcePosition","targetPosition","label","isValidTargetPos","isValidSourcePos","connectable","data"];ao.inheritAttrs=!1;ao.compatConfig={MODE:3};const Bf=ao,io=function({targetPosition:e=oe.Top,label:t,connectable:n=!0,isValidTargetPos:o,data:s}){const a=s.label||t;return[Ae(bt,{type:"target",position:e,connectable:n,isValidConnection:o}),typeof a!="string"&&a?Ae(a):Ae(Ee,[a])]};io.props=["targetPosition","label","isValidTargetPos","connectable","data"];io.inheritAttrs=!1;io.compatConfig={MODE:3};const Af=io,lo=function({sourcePosition:e=oe.Bottom,label:t,connectable:n=!0,isValidSourcePos:o,data:s}){const a=s.label||t;return[typeof a!="string"&&a?Ae(a):Ae(Ee,[a]),Ae(bt,{type:"source",position:e,connectable:n,isValidConnection:o})]};lo.props=["sourcePosition","label","isValidSourcePos","connectable","data"];lo.inheritAttrs=!1;lo.compatConfig={MODE:3};const Of=lo,Pf=["transform"],zf=["width","height","x","y","rx","ry"],Rf=["y"],Uf={name:"EdgeText",compatConfig:{MODE:3}},Lf=Ie({...Uf,props:{x:{},y:{},label:{},labelStyle:{default:()=>({})},labelShowBg:{type:Boolean,default:!0},labelBgStyle:{default:()=>({})},labelBgPadding:{default:()=>[2,4]},labelBgBorderRadius:{default:2}},setup(e){const t=q({x:0,y:0,width:0,height:0}),n=q(null),o=J(()=>`translate(${e.x-t.value.width/2} ${e.y-t.value.height/2})`);Ze(s),Me([()=>e.x,()=>e.y,n,()=>e.label],s);function s(){if(!n.value)return;const a=n.value.getBBox();(a.width!==t.value.width||a.height!==t.value.height)&&(t.value=a)}return(a,i)=>(_(),T("g",{transform:o.value,class:"vue-flow__edge-textwrapper"},[a.labelShowBg?(_(),T("rect",{key:0,class:"vue-flow__edge-textbg",width:`${t.value.width+2*a.labelBgPadding[0]}px`,height:`${t.value.height+2*a.labelBgPadding[1]}px`,x:-a.labelBgPadding[0],y:-a.labelBgPadding[1],style:ot(a.labelBgStyle),rx:a.labelBgBorderRadius,ry:a.labelBgBorderRadius},null,12,zf)):K("",!0),m("text",Ft(a.$attrs,{ref_key:"el",ref:n,class:"vue-flow__edge-text",y:t.value.height/2,dy:"0.3em",style:a.labelStyle}),[nt(a.$slots,"default",{},()=>[typeof a.label!="string"?(_(),me(sa(a.label),{key:0})):(_(),T(Ee,{key:1},[Ce(te(a.label),1)],64))])],16,Rf)],8,Pf))}}),Gf=["id","d","marker-end","marker-start"],Hf=["d","stroke-width"],Ff={name:"BaseEdge",inheritAttrs:!1,compatConfig:{MODE:3}},gn=Ie({...Ff,props:{id:{},labelX:{},labelY:{},path:{},label:{},markerStart:{},markerEnd:{},interactionWidth:{default:20},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{}},setup(e,{expose:t}){const n=q(null),o=q(null),s=q(null),a=bi();return t({pathEl:n,interactionEl:o,labelEl:s}),(i,l)=>(_(),T(Ee,null,[m("path",Ft(P(a),{id:i.id,ref_key:"pathEl",ref:n,d:i.path,class:"vue-flow__edge-path","marker-end":i.markerEnd,"marker-start":i.markerStart}),null,16,Gf),i.interactionWidth?(_(),T("path",{key:0,ref_key:"interactionEl",ref:o,fill:"none",d:i.path,"stroke-width":i.interactionWidth,"stroke-opacity":0,class:"vue-flow__edge-interaction"},null,8,Hf)):K("",!0),i.label&&i.labelX&&i.labelY?(_(),me(Lf,{key:1,ref_key:"labelEl",ref:s,x:i.labelX,y:i.labelY,label:i.label,"label-show-bg":i.labelShowBg,"label-bg-style":i.labelBgStyle,"label-bg-padding":i.labelBgPadding,"label-bg-border-radius":i.labelBgBorderRadius,"label-style":i.labelStyle},null,8,["x","y","label","label-show-bg","label-bg-style","label-bg-padding","label-bg-border-radius","label-style"])):K("",!0)],64))}});function ri({sourceX:e,sourceY:t,targetX:n,targetY:o}){const s=Math.abs(n-e)/2,a=n<e?n+s:n-s,i=Math.abs(o-t)/2,l=o<t?o+i:o-i;return[a,l,s,i]}function ui({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:s,sourceControlY:a,targetControlX:i,targetControlY:l}){const r=e*.125+s*.375+i*.375+n*.125,u=t*.125+a*.375+l*.375+o*.125,c=Math.abs(r-e),d=Math.abs(u-t);return[r,u,c,d]}function In(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function Ws({pos:e,x1:t,y1:n,x2:o,y2:s,c:a}){let i,l;switch(e){case oe.Left:i=t-In(t-o,a),l=n;break;case oe.Right:i=t+In(o-t,a),l=n;break;case oe.Top:i=t,l=n-In(n-s,a);break;case oe.Bottom:i=t,l=n+In(s-n,a);break}return[i,l]}function ci(e){const{sourceX:t,sourceY:n,sourcePosition:o=oe.Bottom,targetX:s,targetY:a,targetPosition:i=oe.Top,curvature:l=.25}=e,[r,u]=Ws({pos:o,x1:t,y1:n,x2:s,y2:a,c:l}),[c,d]=Ws({pos:i,x1:s,y1:a,x2:t,y2:n,c:l}),[p,f,v,g]=ui({sourceX:t,sourceY:n,targetX:s,targetY:a,sourceControlX:r,sourceControlY:u,targetControlX:c,targetControlY:d});return[`M${t},${n} C${r},${u} ${c},${d} ${s},${a}`,p,f,v,g]}function Zs({pos:e,x1:t,y1:n,x2:o,y2:s}){let a,i;switch(e){case oe.Left:case oe.Right:a=.5*(t+o),i=n;break;case oe.Top:case oe.Bottom:a=t,i=.5*(n+s);break}return[a,i]}function di(e){const{sourceX:t,sourceY:n,sourcePosition:o=oe.Bottom,targetX:s,targetY:a,targetPosition:i=oe.Top}=e,[l,r]=Zs({pos:o,x1:t,y1:n,x2:s,y2:a}),[u,c]=Zs({pos:i,x1:s,y1:a,x2:t,y2:n}),[d,p,f,v]=ui({sourceX:t,sourceY:n,targetX:s,targetY:a,sourceControlX:l,sourceControlY:r,targetControlX:u,targetControlY:c});return[`M${t},${n} C${l},${r} ${u},${c} ${s},${a}`,d,p,f,v]}const js={[oe.Left]:{x:-1,y:0},[oe.Right]:{x:1,y:0},[oe.Top]:{x:0,y:-1},[oe.Bottom]:{x:0,y:1}};function Yf({source:e,sourcePosition:t=oe.Bottom,target:n}){return t===oe.Left||t===oe.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1}}function Ks(e,t){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function qf({source:e,sourcePosition:t=oe.Bottom,target:n,targetPosition:o=oe.Top,center:s,offset:a}){const i=js[t],l=js[o],r={x:e.x+i.x*a,y:e.y+i.y*a},u={x:n.x+l.x*a,y:n.y+l.y*a},c=Yf({source:r,sourcePosition:t,target:u}),d=c.x!==0?"x":"y",p=c[d];let f,v,g;const y={x:0,y:0},k={x:0,y:0},[E,h,I,B]=ri({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(i[d]*l[d]===-1){v=s.x??E,g=s.y??h;const F=[{x:v,y:r.y},{x:v,y:u.y}],Y=[{x:r.x,y:g},{x:u.x,y:g}];i[d]===p?f=d==="x"?F:Y:f=d==="x"?Y:F}else{const F=[{x:r.x,y:u.y}],Y=[{x:u.x,y:r.y}];if(d==="x"?f=i.x===p?Y:F:f=i.y===p?F:Y,t===o){const V=Math.abs(e[d]-n[d]);if(V<=a){const S=Math.min(a-1,a-V);i[d]===p?y[d]=(r[d]>e[d]?-1:1)*S:k[d]=(u[d]>n[d]?-1:1)*S}}if(t!==o){const V=d==="x"?"y":"x",S=i[d]===l[V],R=r[V]>u[V],C=r[V]<u[V];(i[d]===1&&(!S&&R||S&&C)||i[d]!==1&&(!S&&C||S&&R))&&(f=d==="x"?F:Y)}const D={x:r.x+y.x,y:r.y+y.y},G={x:u.x+k.x,y:u.y+k.y},z=Math.max(Math.abs(D.x-f[0].x),Math.abs(G.x-f[0].x)),b=Math.max(Math.abs(D.y-f[0].y),Math.abs(G.y-f[0].y));z>=b?(v=(D.x+G.x)/2,g=f[0].y):(v=f[0].x,g=(D.y+G.y)/2)}return[[e,{x:r.x+y.x,y:r.y+y.y},...f,{x:u.x+k.x,y:u.y+k.y},n],v,g,I,B]}function Xf(e,t,n,o){const s=Math.min(Ks(e,t)/2,Ks(t,n)/2,o),{x:a,y:i}=t;if(e.x===a&&a===n.x||e.y===i&&i===n.y)return`L${a} ${i}`;if(e.y===i){const u=e.x<n.x?-1:1,c=e.y<n.y?1:-1;return`L ${a+s*u},${i}Q ${a},${i} ${a},${i+s*c}`}const l=e.x<n.x?1:-1,r=e.y<n.y?-1:1;return`L ${a},${i+s*r}Q ${a},${i} ${a+s*l},${i}`}function Fo(e){const{sourceX:t,sourceY:n,sourcePosition:o=oe.Bottom,targetX:s,targetY:a,targetPosition:i=oe.Top,borderRadius:l=5,centerX:r,centerY:u,offset:c=20}=e,[d,p,f,v,g]=qf({source:{x:t,y:n},sourcePosition:o,target:{x:s,y:a},targetPosition:i,center:{x:r,y:u},offset:c});return[d.reduce((k,E,h)=>{let I;return h>0&&h<d.length-1?I=Xf(d[h-1],E,d[h+1],l):I=`${h===0?"M":"L"}${E.x} ${E.y}`,k+=I,k},""),p,f,v,g]}function Wf(e){const{sourceX:t,sourceY:n,targetX:o,targetY:s}=e,[a,i,l,r]=ri({sourceX:t,sourceY:n,targetX:o,targetY:s});return[`M ${t},${n}L ${o},${s}`,a,i,l,r]}const Zf=Ie({name:"StraightEdge",props:["label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","markerEnd","markerStart","interactionWidth"],compatConfig:{MODE:3},setup(e,{attrs:t}){return()=>{const[n,o,s]=Wf(e);return Ae(gn,{path:n,labelX:o,labelY:s,...t,...e})}}}),jf=Zf,Kf=Ie({name:"SmoothStepEdge",props:["sourcePosition","targetPosition","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","borderRadius","markerEnd","markerStart","interactionWidth","offset"],compatConfig:{MODE:3},setup(e,{attrs:t}){return()=>{const[n,o,s]=Fo({...e,sourcePosition:e.sourcePosition??oe.Bottom,targetPosition:e.targetPosition??oe.Top});return Ae(gn,{path:n,labelX:o,labelY:s,...t,...e})}}}),fi=Kf,Jf=Ie({name:"StepEdge",props:["sourcePosition","targetPosition","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","markerEnd","markerStart","interactionWidth"],setup(e,{attrs:t}){return()=>Ae(fi,{...e,...t,borderRadius:0})}}),Qf=Jf,ep=Ie({name:"BezierEdge",props:["sourcePosition","targetPosition","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","curvature","markerEnd","markerStart","interactionWidth"],compatConfig:{MODE:3},setup(e,{attrs:t}){return()=>{const[n,o,s]=ci({...e,sourcePosition:e.sourcePosition??oe.Bottom,targetPosition:e.targetPosition??oe.Top});return Ae(gn,{path:n,labelX:o,labelY:s,...t,...e})}}}),tp=ep,np=Ie({name:"SimpleBezierEdge",props:["sourcePosition","targetPosition","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","markerEnd","markerStart","interactionWidth"],compatConfig:{MODE:3},setup(e,{attrs:t}){return()=>{const[n,o,s]=di({...e,sourcePosition:e.sourcePosition??oe.Bottom,targetPosition:e.targetPosition??oe.Top});return Ae(gn,{path:n,labelX:o,labelY:s,...t,...e})}}}),op=np,sp={input:Of,default:Bf,output:Af},ap={default:tp,straight:jf,step:Qf,smoothstep:fi,simplebezier:op};function ip(e,t,n){const o=J(()=>g=>t.value.get(g)),s=J(()=>g=>n.value.get(g)),a=J(()=>{const g={...ap,...e.edgeTypes},y=Object.keys(g);for(const k of e.edges)k.type&&!y.includes(k.type)&&(g[k.type]=k.type);return g}),i=J(()=>{const g={...sp,...e.nodeTypes},y=Object.keys(g);for(const k of e.nodes)k.type&&!y.includes(k.type)&&(g[k.type]=k.type);return g}),l=J(()=>e.onlyRenderVisibleElements?Wa(e.nodes,{x:0,y:0,width:e.dimensions.width,height:e.dimensions.height},e.viewport,!0):e.nodes),r=J(()=>{if(e.onlyRenderVisibleElements){const g=[];for(const y of e.edges){const k=t.value.get(y.source),E=t.value.get(y.target);of({sourcePos:k.computedPosition||{x:0,y:0},targetPos:E.computedPosition||{x:0,y:0},sourceWidth:k.dimensions.width,sourceHeight:k.dimensions.height,targetWidth:E.dimensions.width,targetHeight:E.dimensions.height,width:e.dimensions.width,height:e.dimensions.height,viewport:e.viewport})&&g.push(y)}return g}return e.edges}),u=J(()=>[...l.value,...r.value]),c=J(()=>{const g=[];for(const y of e.nodes)y.selected&&g.push(y);return g}),d=J(()=>{const g=[];for(const y of e.edges)y.selected&&g.push(y);return g}),p=J(()=>[...c.value,...d.value]),f=J(()=>{const g=[];for(const y of e.nodes)y.dimensions.width&&y.dimensions.height&&y.handleBounds!==void 0&&g.push(y);return g}),v=J(()=>l.value.length>0&&f.value.length===l.value.length);return{getNode:o,getEdge:s,getElements:u,getEdgeTypes:a,getNodeTypes:i,getEdges:r,getNodes:l,getSelectedElements:p,getSelectedNodes:c,getSelectedEdges:d,getNodesInitialized:f,areNodesInitialized:v}}class Vt{constructor(){this.currentId=0,this.flows=new Map}static getInstance(){var t;const n=(t=mn())==null?void 0:t.appContext.app,o=(n==null?void 0:n.config.globalProperties.$vueFlowStorage)??Vt.instance;return Vt.instance=o??new Vt,n&&(n.config.globalProperties.$vueFlowStorage=Vt.instance),Vt.instance}set(t,n){return this.flows.set(t,n)}get(t){return this.flows.get(t)}remove(t){return this.flows.delete(t)}create(t,n){const o=li(),s=at(o),a={};for(const[p,f]of Object.entries(s.hooks)){const v=`on${p.charAt(0).toUpperCase()+p.slice(1)}`;a[v]=f.on}const i={};for(const[p,f]of Object.entries(s.hooks))i[p]=f.trigger;const l=J(()=>{const p=new Map;for(const f of s.nodes)p.set(f.id,f);return p}),r=J(()=>{const p=new Map;for(const f of s.edges)p.set(f.id,f);return p}),u=ip(s,l,r),c=Mf(s,l,r);c.setState({...s,...n});const d={...a,...u,...c,...ar(s),nodeLookup:l,edgeLookup:r,emits:i,id:t,vueFlowVersion:"1.42.1",$destroy:()=>{this.remove(t)}};return this.set(t,d),d}getId(){return`vue-flow-${this.currentId++}`}}function Re(e){const t=Vt.getInstance(),n=aa(),o=typeof e=="object",s=o?e:{id:e},a=s.id,i=a??(n==null?void 0:n.vueFlowId);let l;if(n){const r=Xe(Xs,null);typeof r<"u"&&r!==null&&(!i||r.id===i)&&(l=r)}if(l||i&&(l=t.get(i)),!l||i&&l.id!==i){const r=a??t.getId(),u=t.create(r,s);l=u,(n??na(!0)).run(()=>{Me(u.applyDefault,(d,p,f)=>{const v=y=>{u.applyNodeChanges(y)},g=y=>{u.applyEdgeChanges(y)};d?(u.onNodesChange(v),u.onEdgesChange(g)):(u.hooks.value.nodesChange.off(v),u.hooks.value.edgesChange.off(g)),f(()=>{u.hooks.value.nodesChange.off(v),u.hooks.value.edgesChange.off(g)})},{immediate:!0}),jn(()=>{if(l){const d=t.get(l.id);d?d.$destroy():oo(`No store instance found for id ${l.id} in storage.`)}})})}else o&&l.setState(s);if(n&&(ct(Xs,l),n.vueFlowId=l.id),o){const r=mn();(r==null?void 0:r.type.name)!=="VueFlow"&&l.emits.error(new Ye(Ge.USEVUEFLOW_OPTIONS))}return l}function lp(e){const{emits:t,dimensions:n}=Re();let o;Ze(()=>{const s=e.value,a=()=>{if(!s)return;const i=to(s);(i.width===0||i.height===0)&&t.error(new Ye(Ge.MISSING_VIEWPORT_DIMENSIONS)),n.value={width:i.width||500,height:i.height||500}};a(),window.addEventListener("resize",a),s&&(o=new ResizeObserver(()=>a()),o.observe(s)),Xo(()=>{window.removeEventListener("resize",a),o&&s&&o.unobserve(s)})})}const rp={name:"UserSelection",compatConfig:{MODE:3}},up=Ie({...rp,props:{userSelectionRect:{}},setup(e){return(t,n)=>(_(),T("div",{class:"vue-flow__selection vue-flow__container",style:ot({width:`${t.userSelectionRect.width}px`,height:`${t.userSelectionRect.height}px`,transform:`translate(${t.userSelectionRect.x}px, ${t.userSelectionRect.y}px)`})},null,4))}}),cp=["tabIndex"],dp={name:"NodesSelection",compatConfig:{MODE:3}},fp=Ie({...dp,setup(e){const{emits:t,viewport:n,getSelectedNodes:o,noPanClassName:s,disableKeyboardA11y:a,userSelectionActive:i}=Re(),l=ii(),r=q(null),u=oi({el:r,onStart(v){t.selectionDragStart(v)},onDrag(v){t.selectionDrag(v)},onStop(v){t.selectionDragStop(v)}});Ze(()=>{var v;a.value||(v=r.value)==null||v.focus({preventScroll:!0})});const c=J(()=>ss(o.value)),d=J(()=>({width:`${c.value.width}px`,height:`${c.value.height}px`,top:`${c.value.y}px`,left:`${c.value.x}px`}));function p(v){t.selectionContextMenu({event:v,nodes:o.value})}function f(v){a||Ht[v.key]&&(v.preventDefault(),l({x:Ht[v.key].x,y:Ht[v.key].y},v.shiftKey))}return(v,g)=>!P(i)&&c.value.width&&c.value.height?(_(),T("div",{key:0,class:He(["vue-flow__nodesselection vue-flow__container",P(s)]),style:ot({transform:`translate(${P(n).x}px,${P(n).y}px) scale(${P(n).zoom})`})},[m("div",{ref_key:"el",ref:r,class:He([{dragging:P(u)},"vue-flow__nodesselection-rect"]),style:ot(d.value),tabIndex:P(a)?void 0:-1,onContextmenu:p,onKeydown:f},null,46,cp)],6)):K("",!0)}});function pp(e,t){return{x:e.clientX-t.left,y:e.clientY-t.top}}const mp={name:"Pane",compatConfig:{MODE:3}},vp=Ie({...mp,props:{isSelecting:{type:Boolean},selectionKeyPressed:{type:Boolean}},setup(e){const{vueFlowRef:t,nodes:n,viewport:o,emits:s,userSelectionActive:a,removeSelectedElements:i,userSelectionRect:l,elementsSelectable:r,nodesSelectionActive:u,getSelectedEdges:c,getSelectedNodes:d,removeNodes:p,removeEdges:f,selectionMode:v,deleteKeyCode:g,multiSelectionKeyCode:y,multiSelectionActive:k,edgeLookup:E,nodeLookup:h,connectionLookup:I,defaultEdgeOptions:B}=Re(),H=q(null),F=q(new Set),Y=q(new Set),D=q(),G=Ue(()=>r.value&&(e.isSelecting||a.value));let z=!1,b=!1;const V=an(g,{actInsideInputWithModifier:!1}),S=an(y);Me(V,W=>{W&&(p(d.value),f(c.value),u.value=!1)}),Me(S,W=>{k.value=W});function R(W,Q){return ee=>{ee.target===Q&&(W==null||W(ee))}}function C(W){if(z){z=!1;return}s.paneClick(W),i(),u.value=!1}function L(W){W.preventDefault(),W.stopPropagation(),s.paneContextMenu(W)}function j(W){s.paneScroll(W)}function X(W){var Q,ee,re;if(D.value=(Q=t.value)==null?void 0:Q.getBoundingClientRect(),!r.value||!e.isSelecting||W.button!==0||W.target!==H.value||!D.value)return;(re=(ee=W.target)==null?void 0:ee.setPointerCapture)==null||re.call(ee,W.pointerId);const{x:ye,y:pe}=pp(W,D.value);b=!0,z=!1,i(),l.value={width:0,height:0,startX:ye,startY:pe,x:ye,y:pe},s.selectionStart(W)}function A(W){var Q;if(!D.value||!l.value)return;z=!0;const{x:ee,y:re}=Et(W,D.value),{startX:ye=0,startY:pe=0}=l.value,ve={startX:ye,startY:pe,x:ee<ye?ee:ye,y:re<pe?re:pe,width:Math.abs(ee-ye),height:Math.abs(re-pe)},se=F.value,Se=Y.value;F.value=new Set(Wa(n.value,ve,o.value,v.value===os.Partial,!0).map(fe=>fe.id)),Y.value=new Set;const ie=((Q=B.value)==null?void 0:Q.selectable)??!0;for(const fe of F.value){const _e=I.value.get(fe);if(_e)for(const{edgeId:x}of _e.values()){const w=E.value.get(x);w&&(w.selectable??ie)&&Y.value.add(x)}}if(!qs(se,F.value)){const fe=$t(h.value,F.value,!0);s.nodesChange(fe)}if(!qs(Se,Y.value)){const fe=$t(E.value,Y.value);s.edgesChange(fe)}l.value=ve,a.value=!0,u.value=!1}function U(W){var Q;W.button!==0||!b||((Q=W.target)==null||Q.releasePointerCapture(W.pointerId),!a.value&&l.value&&W.target===H.value&&C(W),a.value=!1,l.value=null,u.value=F.value.size>0,s.selectionEnd(W),e.selectionKeyPressed&&(z=!1),b=!1)}return(W,Q)=>(_(),T("div",{ref_key:"container",ref:H,class:He(["vue-flow__pane vue-flow__container",{selection:W.isSelecting}]),onClick:Q[0]||(Q[0]=ee=>G.value?void 0:R(C,H.value)(ee)),onContextmenu:Q[1]||(Q[1]=ee=>R(L,H.value)(ee)),onWheelPassive:Q[2]||(Q[2]=ee=>R(j,H.value)(ee)),onPointerenter:Q[3]||(Q[3]=ee=>G.value?void 0:P(s).paneMouseEnter(ee)),onPointerdown:Q[4]||(Q[4]=ee=>G.value?X(ee):P(s).paneMouseMove(ee)),onPointermove:Q[5]||(Q[5]=ee=>G.value?A(ee):P(s).paneMouseMove(ee)),onPointerup:Q[6]||(Q[6]=ee=>G.value?U(ee):void 0),onPointerleave:Q[7]||(Q[7]=ee=>P(s).paneMouseLeave(ee))},[nt(W.$slots,"default"),P(a)&&P(l)?(_(),me(up,{key:0,"user-selection-rect":P(l)},null,8,["user-selection-rect"])):K("",!0),P(u)&&P(d).length?(_(),me(fp,{key:1})):K("",!0)],34))}}),hp={name:"Transform",compatConfig:{MODE:3}},gp=Ie({...hp,setup(e){const{viewport:t,fitViewOnInit:n,fitViewOnInitDone:o}=Re(),s=J(()=>n.value?!o.value:!1),a=J(()=>`translate(${t.value.x}px,${t.value.y}px) scale(${t.value.zoom})`);return(i,l)=>(_(),T("div",{class:"vue-flow__transformationpane vue-flow__container",style:ot({transform:a.value,opacity:s.value?0:void 0})},[nt(i.$slots,"default")],4))}}),yp={name:"Viewport",compatConfig:{MODE:3}},_p=Ie({...yp,setup(e){const{minZoom:t,maxZoom:n,defaultViewport:o,translateExtent:s,zoomActivationKeyCode:a,selectionKeyCode:i,panActivationKeyCode:l,panOnScroll:r,panOnScrollMode:u,panOnScrollSpeed:c,panOnDrag:d,zoomOnDoubleClick:p,zoomOnPinch:f,zoomOnScroll:v,preventScrolling:g,noWheelClassName:y,noPanClassName:k,emits:E,connectionStartHandle:h,userSelectionActive:I,paneDragging:B,d3Zoom:H,d3Selection:F,d3ZoomHandler:Y,viewport:D,viewportRef:G,paneClickDistance:z}=Re();lp(G);const b=q(!1),V=q(!1);let S=null,R=!1,C=0,L={x:0,y:0,zoom:0};const j=an(l),X=an(i),A=an(a),U=Ue(()=>(!X.value||X.value&&i.value===!0)&&(j.value||d.value)),W=Ue(()=>j.value||r.value),Q=Ue(()=>X.value||i.value===!0&&U.value!==!0);Ze(()=>{if(!G.value){oo("Viewport element is missing");return}const se=G.value,Se=se.getBoundingClientRect(),ie=Ud().clickDistance(z.value).scaleExtent([t.value,n.value]).translateExtent(s.value),fe=it(se).call(ie),_e=fe.on("wheel.zoom"),x=Xt.translate(o.value.x??0,o.value.y??0).scale(Pt(o.value.zoom??1,t.value,n.value)),w=[[0,0],[Se.width,Se.height]],N=ie.constrain()(x,w,s.value);ie.transform(fe,N),ie.wheelDelta(re),H.value=ie,F.value=fe,Y.value=_e,D.value={x:N.x,y:N.y,zoom:N.k},ie.on("start",$=>{var Z;if(!$.sourceEvent)return null;C=$.sourceEvent.button,b.value=!0;const le=pe($.transform);((Z=$.sourceEvent)==null?void 0:Z.type)==="mousedown"&&(B.value=!0),L=le,E.viewportChangeStart(le),E.moveStart({event:$,flowTransform:le})}),ie.on("end",$=>{if(!$.sourceEvent)return null;if(b.value=!1,B.value=!1,ee(U.value,C??0)&&!R&&E.paneContextMenu($.sourceEvent),R=!1,ye(L,$.transform)){const Z=pe($.transform);L=Z,E.viewportChangeEnd(Z),E.moveEnd({event:$,flowTransform:Z})}}),ie.filter($=>{var Z;const le=A.value||v.value,ce=f.value&&$.ctrlKey,de=$.button;if(de===1&&$.type==="mousedown"&&(ve($,"vue-flow__node")||ve($,"vue-flow__edge")))return!0;if(!U.value&&!le&&!W.value&&!p.value&&!f.value||I.value||!p.value&&$.type==="dblclick"||ve($,y.value)&&$.type==="wheel"||ve($,k.value)&&($.type!=="wheel"||W.value&&$.type==="wheel"&&!A.value)||!f.value&&$.ctrlKey&&$.type==="wheel"||!le&&!W.value&&!ce&&$.type==="wheel")return!1;if(!f&&$.type==="touchstart"&&((Z=$.touches)==null?void 0:Z.length)>1)return $.preventDefault(),!1;if(!U.value&&($.type==="mousedown"||$.type==="touchstart")||i.value===!0&&Array.isArray(d.value)&&d.value.includes(0)&&de===0||Array.isArray(d.value)&&!d.value.includes(de)&&($.type==="mousedown"||$.type==="touchstart"))return!1;const be=Array.isArray(d.value)&&d.value.includes(de)||i.value===!0&&Array.isArray(d.value)&&!d.value.includes(0)||!de||de<=1;return(!$.ctrlKey||j.value||$.type==="wheel")&&be}),Me([I,U],()=>{I.value&&!b.value?ie.on("zoom",null):I.value||ie.on("zoom",$=>{D.value={x:$.transform.x,y:$.transform.y,zoom:$.transform.k};const Z=pe($.transform);R=ee(U.value,C??0),E.viewportChange(Z),E.move({event:$,flowTransform:Z})})},{immediate:!0}),Me([I,W,u,A,f,g,y],()=>{W.value&&!A.value&&!I.value?fe.on("wheel.zoom",$=>{if(ve($,y.value))return!1;const Z=A.value||v.value,le=f.value&&$.ctrlKey;if(!(!g.value||W.value||Z||le))return!1;$.preventDefault(),$.stopImmediatePropagation();const de=fe.property("__zoom").k||1,be=Xn();if(!j.value&&$.ctrlKey&&f.value&&be){const Tt=ut($),fo=re($),po=de*2**fo;ie.scaleTo(fe,po,Tt,$);return}const ke=$.deltaMode===1?20:1;let xe=u.value===sn.Vertical?0:$.deltaX*ke,De=u.value===sn.Horizontal?0:$.deltaY*ke;!be&&$.shiftKey&&u.value!==sn.Vertical&&!xe&&De&&(xe=De,De=0),ie.translateBy(fe,-(xe/de)*c.value,-(De/de)*c.value);const Je=pe(fe.property("__zoom"));S&&clearTimeout(S),V.value?(E.move({event:$,flowTransform:Je}),E.viewportChange(Je),S=setTimeout(()=>{E.moveEnd({event:$,flowTransform:Je}),E.viewportChangeEnd(Je),V.value=!1},150)):(V.value=!0,E.moveStart({event:$,flowTransform:Je}),E.viewportChangeStart(Je))},{passive:!1}):typeof _e<"u"&&fe.on("wheel.zoom",function($,Z){const le=!g.value&&$.type==="wheel"&&!$.ctrlKey,ce=A.value||v.value,de=f.value&&$.ctrlKey;if(!ce&&!r.value&&!de&&$.type==="wheel"||le||ve($,y.value))return null;$.preventDefault(),_e.call(this,$,Z)},{passive:!1})},{immediate:!0})});function ee(se,Se){return Se===2&&Array.isArray(se)&&se.includes(2)}function re(se){const Se=se.ctrlKey&&Xn()?10:1;return-se.deltaY*(se.deltaMode===1?.05:se.deltaMode?1:.002)*Se}function ye(se,Se){return se.x!==Se.x&&!Number.isNaN(Se.x)||se.y!==Se.y&&!Number.isNaN(Se.y)||se.zoom!==Se.k&&!Number.isNaN(Se.k)}function pe(se){return{x:se.x,y:se.y,zoom:se.k}}function ve(se,Se){return se.target.closest(`.${Se}`)}return(se,Se)=>(_(),T("div",{ref_key:"viewportRef",ref:G,class:"vue-flow__viewport vue-flow__container"},[O(vp,{"is-selecting":Q.value,"selection-key-pressed":P(X),class:He({connecting:!!P(h),dragging:P(B),draggable:P(d)===!0||Array.isArray(P(d))&&P(d).includes(0)})},{default:$e(()=>[O(gp,null,{default:$e(()=>[nt(se.$slots,"default")]),_:3})]),_:3},8,["is-selecting","selection-key-pressed","class"])],512))}}),bp=["id"],wp=["id"],Sp=["id"],xp={name:"A11yDescriptions",compatConfig:{MODE:3}},Cp=Ie({...xp,setup(e){const{id:t,disableKeyboardA11y:n,ariaLiveMessage:o}=Re();return(s,a)=>(_(),T(Ee,null,[m("div",{id:`${P(Ua)}-${P(t)}`,style:{display:"none"}}," Press enter or space to select a node. "+te(P(n)?"":"You can then use the arrow keys to move the node around.")+" You can then use the arrow keys to move the node around, press delete to remove it and press escape to cancel. ",9,bp),m("div",{id:`${P(La)}-${P(t)}`,style:{display:"none"}}," Press enter or space to select an edge. You can then press delete to remove it or press escape to cancel. ",8,wp),P(n)?K("",!0):(_(),T("div",{key:0,id:`${P(Fd)}-${P(t)}`,"aria-live":"assertive","aria-atomic":"true",style:{position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)","clip-path":"inset(100%)"}},te(P(o)),9,Sp))],64))}});function $p(){const e=Re();Me(()=>e.viewportHelper.value.viewportInitialized,t=>{t&&setTimeout(()=>{e.emits.init(e),e.emits.paneReady(e)},1)})}function Ep(e,t,n){return n===oe.Left?e-t:n===oe.Right?e+t:e}function kp(e,t,n){return n===oe.Top?e-t:n===oe.Bottom?e+t:e}const rs=function({radius:e=10,centerX:t=0,centerY:n=0,position:o=oe.Top,type:s}){return Ae("circle",{class:`vue-flow__edgeupdater vue-flow__edgeupdater-${s}`,cx:Ep(t,e,o),cy:kp(n,e,o),r:e,stroke:"transparent",fill:"transparent"})};rs.props=["radius","centerX","centerY","position","type"];rs.compatConfig={MODE:3};const Js=rs,Np=Ie({name:"Edge",compatConfig:{MODE:3},props:["id"],setup(e){const{id:t,addSelectedEdges:n,connectionMode:o,edgeUpdaterRadius:s,emits:a,nodesSelectionActive:i,noPanClassName:l,getEdgeTypes:r,removeSelectedEdges:u,findEdge:c,findNode:d,isValidConnection:p,multiSelectionActive:f,disableKeyboardA11y:v,elementsSelectable:g,edgesUpdatable:y,edgesFocusable:k,hooks:E}=Re(),h=J(()=>c(e.id)),{emit:I,on:B}=bf(h.value,a),H=Xe(so),F=mn(),Y=q(!1),D=q(!1),G=q(""),z=q(null),b=q("source"),V=q(null),S=Ue(()=>typeof h.value.selectable>"u"?g.value:h.value.selectable),R=Ue(()=>typeof h.value.updatable>"u"?y.value:h.value.updatable),C=Ue(()=>typeof h.value.focusable>"u"?k.value:h.value.focusable);ct(gf,e.id),ct(yf,V);const L=J(()=>h.value.class instanceof Function?h.value.class(h.value):h.value.class),j=J(()=>h.value.style instanceof Function?h.value.style(h.value):h.value.style),X=J(()=>{const w=h.value.type||"default",N=H==null?void 0:H[`edge-${w}`];if(N)return N;let $=h.value.template??r.value[w];if(typeof $=="string"&&F){const Z=Object.keys(F.appContext.components);Z&&Z.includes(w)&&($=ge(w,!1))}return $&&typeof $!="string"?$:(a.error(new Ye(Ge.EDGE_TYPE_MISSING,$)),!1)}),{handlePointerDown:A}=si({nodeId:G,handleId:z,type:b,isValidConnection:p,edgeUpdaterType:b,onEdgeUpdate:Q,onEdgeUpdateEnd:ee});return()=>{const w=d(h.value.source),N=d(h.value.target),$="pathOptions"in h.value?h.value.pathOptions:{};if(!w&&!N)return a.error(new Ye(Ge.EDGE_SOURCE_TARGET_MISSING,h.value.id,h.value.source,h.value.target)),null;if(!w)return a.error(new Ye(Ge.EDGE_SOURCE_MISSING,h.value.id,h.value.source)),null;if(!N)return a.error(new Ye(Ge.EDGE_TARGET_MISSING,h.value.id,h.value.target)),null;if(!h.value||h.value.hidden||w.hidden||N.hidden)return null;let Z;o.value===Nt.Strict?Z=w.handleBounds.source:Z=[...w.handleBounds.source||[],...w.handleBounds.target||[]];const le=Us(Z,h.value.sourceHandle);let ce;o.value===Nt.Strict?ce=N.handleBounds.target:ce=[...N.handleBounds.target||[],...N.handleBounds.source||[]];const de=Us(ce,h.value.targetHandle),be=(le==null?void 0:le.position)||oe.Bottom,ke=(de==null?void 0:de.position)||oe.Top,{x:xe,y:De}=Wt(w,le,be),{x:Je,y:Tt}=Wt(N,de,ke);return h.value.sourceX=xe,h.value.sourceY=De,h.value.targetX=Je,h.value.targetY=Tt,Ae("g",{ref:V,key:e.id,"data-id":e.id,class:["vue-flow__edge",`vue-flow__edge-${X.value===!1?"default":h.value.type||"default"}`,l.value,L.value,{updating:Y.value,selected:h.value.selected,animated:h.value.animated,inactive:!S.value&&!E.value.edgeClick.hasListeners()}],onClick:ye,onContextmenu:pe,onDblclick:ve,onMouseenter:se,onMousemove:Se,onMouseleave:ie,onKeyDown:C.value?x:void 0,tabIndex:C.value?0:void 0,"aria-label":h.value.ariaLabel===null?void 0:h.value.ariaLabel||`Edge from ${h.value.source} to ${h.value.target}`,"aria-describedby":C.value?`${La}-${t}`:void 0,role:C.value?"button":"img"},[D.value?null:Ae(X.value===!1?r.value.default:X.value,{id:e.id,sourceNode:w,targetNode:N,source:h.value.source,target:h.value.target,type:h.value.type,updatable:R.value,selected:h.value.selected,animated:h.value.animated,label:h.value.label,labelStyle:h.value.labelStyle,labelShowBg:h.value.labelShowBg,labelBgStyle:h.value.labelBgStyle,labelBgPadding:h.value.labelBgPadding,labelBgBorderRadius:h.value.labelBgBorderRadius,data:h.value.data,events:{...h.value.events,...B},style:j.value,markerStart:`url('#${pn(h.value.markerStart,t)}')`,markerEnd:`url('#${pn(h.value.markerEnd,t)}')`,sourcePosition:be,targetPosition:ke,sourceX:xe,sourceY:De,targetX:Je,targetY:Tt,sourceHandleId:h.value.sourceHandle,targetHandleId:h.value.targetHandle,interactionWidth:h.value.interactionWidth,...$}),[R.value==="source"||R.value===!0?[Ae("g",{onMousedown:fe,onMouseenter:U,onMouseout:W},Ae(Js,{position:be,centerX:xe,centerY:De,radius:s.value,type:"source","data-type":"source"}))]:null,R.value==="target"||R.value===!0?[Ae("g",{onMousedown:_e,onMouseenter:U,onMouseout:W},Ae(Js,{position:ke,centerX:Je,centerY:Tt,radius:s.value,type:"target","data-type":"target"}))]:null]])};function U(){Y.value=!0}function W(){Y.value=!1}function Q(w,N){I.update({event:w,edge:h.value,connection:N})}function ee(w){I.updateEnd({event:w,edge:h.value}),D.value=!1}function re(w,N){w.button===0&&(D.value=!0,G.value=N?h.value.target:h.value.source,z.value=(N?h.value.targetHandle:h.value.sourceHandle)??"",b.value=N?"target":"source",I.updateStart({event:w,edge:h.value}),A(w))}function ye(w){var N;const $={event:w,edge:h.value};S.value&&(i.value=!1,h.value.selected&&f.value?(u([h.value]),(N=V.value)==null||N.blur()):n([h.value])),I.click($)}function pe(w){I.contextMenu({event:w,edge:h.value})}function ve(w){I.doubleClick({event:w,edge:h.value})}function se(w){I.mouseEnter({event:w,edge:h.value})}function Se(w){I.mouseMove({event:w,edge:h.value})}function ie(w){I.mouseLeave({event:w,edge:h.value})}function fe(w){re(w,!0)}function _e(w){re(w,!1)}function x(w){var N;!v.value&&Ga.includes(w.key)&&S.value&&(w.key==="Escape"?((N=V.value)==null||N.blur(),u([c(e.id)])):n([c(e.id)]))}}}),Ip=Np,Tp=Ie({name:"ConnectionLine",compatConfig:{MODE:3},setup(){var e;const{id:t,connectionMode:n,connectionStartHandle:o,connectionEndHandle:s,connectionPosition:a,connectionLineType:i,connectionLineStyle:l,connectionLineOptions:r,connectionStatus:u,viewport:c,findNode:d}=Re(),p=(e=Xe(so))==null?void 0:e["connection-line"],f=J(()=>{var E;return d((E=o.value)==null?void 0:E.nodeId)}),v=J(()=>{var E;return d((E=s.value)==null?void 0:E.nodeId)??null}),g=J(()=>({x:(a.value.x-c.value.x)/c.value.zoom,y:(a.value.y-c.value.y)/c.value.zoom})),y=J(()=>r.value.markerStart?`url(#${pn(r.value.markerStart,t)})`:""),k=J(()=>r.value.markerEnd?`url(#${pn(r.value.markerEnd,t)})`:"");return()=>{var E,h,I;if(!f.value||!o.value)return null;const B=o.value.id,H=o.value.type,F=f.value.handleBounds;let Y=(F==null?void 0:F[H])||[];if(n.value===Nt.Loose){const j=(F==null?void 0:F[H==="source"?"target":"source"])||[];Y=[...Y,...j]}if(!Y)return null;const D=(B?Y.find(j=>j.id===B):Y[0])??null,G=(D==null?void 0:D.position)||oe.Top,{x:z,y:b}=Wt(f.value,D,G);let V=null;v.value&&(n.value===Nt.Strict?V=((E=v.value.handleBounds[H==="source"?"target":"source"])==null?void 0:E.find(j=>{var X;return j.id===((X=s.value)==null?void 0:X.id)}))||null:V=((h=[...v.value.handleBounds.source||[],...v.value.handleBounds.target||[]])==null?void 0:h.find(j=>{var X;return j.id===((X=s.value)==null?void 0:X.id)}))||null);const S=((I=s.value)==null?void 0:I.position)??(G?Go[G]:null);if(!G||!S)return null;const R=i.value??r.value.type??Mt.Bezier;let C="";const L={sourceX:z,sourceY:b,sourcePosition:G,targetX:g.value.x,targetY:g.value.y,targetPosition:S};return R===Mt.Bezier?[C]=ci(L):R===Mt.Step?[C]=Fo({...L,borderRadius:0}):R===Mt.SmoothStep?[C]=Fo(L):R===Mt.SimpleBezier?[C]=di(L):C=`M${z},${b} ${g.value.x},${g.value.y}`,Ae("svg",{class:"vue-flow__edges vue-flow__connectionline vue-flow__container"},Ae("g",{class:"vue-flow__connection"},p?Ae(p,{sourceX:z,sourceY:b,sourcePosition:G,targetX:g.value.x,targetY:g.value.y,targetPosition:S,sourceNode:f.value,sourceHandle:D,targetNode:v.value,targetHandle:V,markerEnd:k.value,markerStart:y.value,connectionStatus:u.value}):Ae("path",{d:C,class:[r.value.class,u,"vue-flow__connection-path"],style:{...l.value,...r.value.style},"marker-end":k.value,"marker-start":y.value})))}}}),Mp=Tp,Vp=["id","markerWidth","markerHeight","markerUnits","orient"],Dp={name:"MarkerType",compatConfig:{MODE:3}},Bp=Ie({...Dp,props:{id:{},type:{},color:{default:"none"},width:{default:12.5},height:{default:12.5},markerUnits:{default:"strokeWidth"},orient:{default:"auto-start-reverse"},strokeWidth:{default:1}},setup(e){return(t,n)=>(_(),T("marker",{id:t.id,class:"vue-flow__arrowhead",viewBox:"-10 -10 20 20",refX:"0",refY:"0",markerWidth:`${t.width}`,markerHeight:`${t.height}`,markerUnits:t.markerUnits,orient:t.orient},[t.type===P(Gt).ArrowClosed?(_(),T("polyline",{key:0,style:ot({stroke:t.color,fill:t.color,strokeWidth:t.strokeWidth}),"stroke-linecap":"round","stroke-linejoin":"round",points:"-5,-4 0,0 -5,4 -5,-4"},null,4)):K("",!0),t.type===P(Gt).Arrow?(_(),T("polyline",{key:1,style:ot({stroke:t.color,strokeWidth:t.strokeWidth}),"stroke-linecap":"round","stroke-linejoin":"round",fill:"none",points:"-5,-4 0,0 -5,4"},null,4)):K("",!0)],8,Vp))}}),Ap={class:"vue-flow__marker vue-flow__container"},Op={name:"MarkerDefinitions",compatConfig:{MODE:3}},Pp=Ie({...Op,setup(e){const{id:t,edges:n,connectionLineOptions:o,defaultMarkerColor:s}=Re(),a=J(()=>{const i=new Set,l=[],r=u=>{if(u){const c=pn(u,t);i.has(c)||(typeof u=="object"?l.push({...u,id:c,color:u.color||s.value}):l.push({id:c,color:s.value,type:u}),i.add(c))}};for(const u of[o.value.markerEnd,o.value.markerStart])r(u);for(const u of n.value)for(const c of[u.markerStart,u.markerEnd])r(c);return l.sort((u,c)=>u.id.localeCompare(c.id))});return(i,l)=>(_(),T("svg",Ap,[m("defs",null,[(_(!0),T(Ee,null,ze(a.value,r=>(_(),me(Bp,{id:r.id,key:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,"stroke-width":r.strokeWidth,orient:r.orient},null,8,["id","type","color","width","height","markerUnits","stroke-width","orient"]))),128))])]))}}),zp={name:"Edges",compatConfig:{MODE:3}},Rp=Ie({...zp,setup(e){const{findNode:t,getEdges:n,elevateEdgesOnSelect:o}=Re();return(s,a)=>(_(),T(Ee,null,[O(Pp),(_(!0),T(Ee,null,ze(P(n),i=>(_(),T("svg",{key:i.id,class:"vue-flow__edges vue-flow__container",style:ot({zIndex:P(sf)(i,P(t),P(o))})},[O(P(Ip),{id:i.id},null,8,["id"])],4))),128)),O(P(Mp))],64))}}),Up=Ie({name:"Node",compatConfig:{MODE:3},props:["id","resizeObserver"],setup(e){const{id:t,noPanClassName:n,selectNodesOnDrag:o,nodesSelectionActive:s,multiSelectionActive:a,emits:i,removeSelectedNodes:l,addSelectedNodes:r,updateNodeDimensions:u,onUpdateNodeInternals:c,getNodeTypes:d,nodeExtent:p,elevateNodesOnSelect:f,disableKeyboardA11y:v,ariaLiveMessage:g,snapToGrid:y,snapGrid:k,nodeDragThreshold:E,nodesDraggable:h,elementsSelectable:I,nodesConnectable:B,nodesFocusable:H,hooks:F}=Re(),Y=q(null);ct(ni,Y),ct(ls,e.id);const D=Xe(so),G=mn(),z=ii(),{node:b,parentNode:V}=ai(e.id),{emit:S,on:R}=Cf(b,i),C=Ue(()=>typeof b.draggable>"u"?h.value:b.draggable),L=Ue(()=>typeof b.selectable>"u"?I.value:b.selectable),j=Ue(()=>typeof b.connectable>"u"?B.value:b.connectable),X=Ue(()=>typeof b.focusable>"u"?H.value:b.focusable),A=Ue(()=>L.value||C.value||F.value.nodeClick.hasListeners()||F.value.nodeDoubleClick.hasListeners()||F.value.nodeMouseEnter.hasListeners()||F.value.nodeMouseMove.hasListeners()||F.value.nodeMouseLeave.hasListeners()),U=Ue(()=>!!b.dimensions.width&&!!b.dimensions.height),W=J(()=>{const N=b.type||"default",$=D==null?void 0:D[`node-${N}`];if($)return $;let Z=b.template||d.value[N];if(typeof Z=="string"&&G){const le=Object.keys(G.appContext.components);le&&le.includes(N)&&(Z=ge(N,!1))}return Z&&typeof Z!="string"?Z:(i.error(new Ye(Ge.NODE_TYPE_MISSING,Z)),!1)}),Q=oi({id:e.id,el:Y,disabled:()=>!C.value,selectable:L,dragHandle:()=>b.dragHandle,onStart(N){S.dragStart(N)},onDrag(N){S.drag(N)},onStop(N){S.dragStop(N)},onClick(N){x(N)}}),ee=J(()=>b.class instanceof Function?b.class(b):b.class),re=J(()=>{const N=(b.style instanceof Function?b.style(b):b.style)||{},$=b.width instanceof Function?b.width(b):b.width,Z=b.height instanceof Function?b.height(b):b.height;return!N.width&&$&&(N.width=typeof $=="string"?$:`${$}px`),!N.height&&Z&&(N.height=typeof Z=="string"?Z:`${Z}px`),N}),ye=Ue(()=>Number(b.zIndex??re.value.zIndex??0));return c(N=>{(N.includes(e.id)||!N.length)&&ve()}),Ze(()=>{Me(()=>b.hidden,(N=!1,$,Z)=>{!N&&Y.value&&(e.resizeObserver.observe(Y.value),Z(()=>{Y.value&&e.resizeObserver.unobserve(Y.value)}))},{immediate:!0,flush:"post"})}),Me([()=>b.type,()=>b.sourcePosition,()=>b.targetPosition],()=>{Fe(()=>{u([{id:e.id,nodeElement:Y.value,forceUpdate:!0}])})}),Me([()=>b.position.x,()=>b.position.y,()=>{var N;return(N=V.value)==null?void 0:N.computedPosition.x},()=>{var N;return(N=V.value)==null?void 0:N.computedPosition.y},()=>{var N;return(N=V.value)==null?void 0:N.computedPosition.z},ye,()=>b.selected,()=>b.dimensions.height,()=>b.dimensions.width,()=>{var N;return(N=V.value)==null?void 0:N.dimensions.height},()=>{var N;return(N=V.value)==null?void 0:N.dimensions.width}],([N,$,Z,le,ce,de])=>{const be={x:N,y:$,z:de+(f.value&&b.selected?1e3:0)};typeof Z<"u"&&typeof le<"u"?b.computedPosition=Jd({x:Z,y:le,z:ce},be):b.computedPosition=be},{flush:"post",immediate:!0}),Me([()=>b.extent,p],([N,$],[Z,le])=>{(N!==Z||$!==le)&&pe()}),b.extent==="parent"||typeof b.extent=="object"&&"range"in b.extent&&b.extent.range==="parent"?Mo(()=>U).toBe(!0).then(pe):pe(),()=>b.hidden?null:Ae("div",{ref:Y,"data-id":b.id,class:["vue-flow__node",`vue-flow__node-${W.value===!1?"default":b.type||"default"}`,{[n.value]:C.value,dragging:Q==null?void 0:Q.value,draggable:C.value,selected:b.selected,selectable:L.value,parent:b.isParent},ee.value],style:{visibility:U.value?"visible":"hidden",zIndex:b.computedPosition.z??ye.value,transform:`translate(${b.computedPosition.x}px,${b.computedPosition.y}px)`,pointerEvents:A.value?"all":"none",...re.value},tabIndex:X.value?0:void 0,role:X.value?"button":void 0,"aria-describedby":v.value?void 0:`${Ua}-${t}`,"aria-label":b.ariaLabel,onMouseenter:se,onMousemove:Se,onMouseleave:ie,onContextmenu:fe,onClick:x,onDblclick:_e,onKeydown:w},[Ae(W.value===!1?d.value.default:W.value,{id:b.id,type:b.type,data:b.data,events:{...b.events,...R},selected:b.selected,resizing:b.resizing,dragging:Q.value,connectable:j.value,position:b.computedPosition,dimensions:b.dimensions,isValidTargetPos:b.isValidTargetPos,isValidSourcePos:b.isValidSourcePos,parent:b.parentNode,parentNodeId:b.parentNode,zIndex:b.computedPosition.z??ye.value,targetPosition:b.targetPosition,sourcePosition:b.sourcePosition,label:b.label,dragHandle:b.dragHandle,onUpdateNodeInternals:ve})]);function pe(){const N=b.computedPosition,{computedPosition:$,position:Z}=as(b,y.value?no(N,k.value):N,i.error,p.value,V.value);(b.computedPosition.x!==$.x||b.computedPosition.y!==$.y)&&(b.computedPosition={...b.computedPosition,...$}),(b.position.x!==Z.x||b.position.y!==Z.y)&&(b.position=Z)}function ve(){Y.value&&u([{id:e.id,nodeElement:Y.value,forceUpdate:!0}])}function se(N){Q!=null&&Q.value||S.mouseEnter({event:N,node:b})}function Se(N){Q!=null&&Q.value||S.mouseMove({event:N,node:b})}function ie(N){Q!=null&&Q.value||S.mouseLeave({event:N,node:b})}function fe(N){return S.contextMenu({event:N,node:b})}function _e(N){return S.doubleClick({event:N,node:b})}function x(N){L.value&&(!o.value||!C.value||E.value>0)&&Ho(b,a.value,r,l,s,!1,Y.value),S.click({event:N,node:b})}function w(N){if(!(Uo(N)||v.value))if(Ga.includes(N.key)&&L.value){const $=N.key==="Escape";Ho(b,a.value,r,l,s,$,Y.value)}else C.value&&b.selected&&Ht[N.key]&&(N.preventDefault(),g.value=`Moved selected node ${N.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~b.position.x}, y: ${~~b.position.y}`,z({x:Ht[N.key].x,y:Ht[N.key].y},N.shiftKey))}}}),Lp=Up;function Gp(e={includeHiddenNodes:!1}){const{nodes:t}=Re();return J(()=>{if(t.value.length===0)return!1;for(const n of t.value)if((e.includeHiddenNodes||!n.hidden)&&((n==null?void 0:n.handleBounds)===void 0||n.dimensions.width===0||n.dimensions.height===0))return!1;return!0})}const Hp={class:"vue-flow__nodes vue-flow__container"},Fp={name:"Nodes",compatConfig:{MODE:3}},Yp=Ie({...Fp,setup(e){const{getNodes:t,updateNodeDimensions:n,emits:o}=Re(),s=Gp(),a=q();return Me(s,i=>{i&&Fe(()=>{o.nodesInitialized(t.value)})},{immediate:!0}),Ze(()=>{a.value=new ResizeObserver(i=>{const l=i.map(r=>({id:r.target.getAttribute("data-id"),nodeElement:r.target,forceUpdate:!0}));Fe(()=>n(l))})}),Xo(()=>{var i;return(i=a.value)==null?void 0:i.disconnect()}),(i,l)=>(_(),T("div",Hp,[a.value?(_(!0),T(Ee,{key:0},ze(P(t),(r,u,c,d)=>{const p=[r.id];if(d&&d.key===r.id&&$i(d,p))return d;const f=(_(),me(P(Lp),{id:r.id,key:r.id,"resize-observer":a.value},null,8,["id","resize-observer"]));return f.memo=p,f},l,0),128)):K("",!0)]))}});function qp(){const{emits:e}=Re();Ze(()=>{if(ti()){const t=document.querySelector(".vue-flow__pane");t&&window.getComputedStyle(t).zIndex!=="1"&&e.error(new Ye(Ge.MISSING_STYLES))}})}const Xp=m("div",{class:"vue-flow__edge-labels"},null,-1),Wp={name:"VueFlow",compatConfig:{MODE:3}},Zp=Ie({...Wp,props:{id:{},modelValue:{},nodes:{},edges:{},edgeTypes:{},nodeTypes:{},connectionMode:{},connectionLineType:{},connectionLineStyle:{default:void 0},connectionLineOptions:{default:void 0},connectionRadius:{},isValidConnection:{type:[Function,null],default:void 0},deleteKeyCode:{default:void 0},selectionKeyCode:{type:[Boolean,null],default:void 0},multiSelectionKeyCode:{default:void 0},zoomActivationKeyCode:{default:void 0},panActivationKeyCode:{default:void 0},snapToGrid:{type:Boolean,default:void 0},snapGrid:{},onlyRenderVisibleElements:{type:Boolean,default:void 0},edgesUpdatable:{type:[Boolean,String],default:void 0},nodesDraggable:{type:Boolean,default:void 0},nodesConnectable:{type:Boolean,default:void 0},nodeDragThreshold:{},elementsSelectable:{type:Boolean,default:void 0},selectNodesOnDrag:{type:Boolean,default:void 0},panOnDrag:{type:[Boolean,Array],default:void 0},minZoom:{},maxZoom:{},defaultViewport:{},translateExtent:{},nodeExtent:{},defaultMarkerColor:{},zoomOnScroll:{type:Boolean,default:void 0},zoomOnPinch:{type:Boolean,default:void 0},panOnScroll:{type:Boolean,default:void 0},panOnScrollSpeed:{},panOnScrollMode:{},paneClickDistance:{},zoomOnDoubleClick:{type:Boolean,default:void 0},preventScrolling:{type:Boolean,default:void 0},selectionMode:{},edgeUpdaterRadius:{},fitViewOnInit:{type:Boolean,default:void 0},connectOnClick:{type:Boolean,default:void 0},applyDefault:{type:Boolean,default:void 0},autoConnect:{type:[Boolean,Function],default:void 0},noDragClassName:{},noWheelClassName:{},noPanClassName:{},defaultEdgeOptions:{},elevateEdgesOnSelect:{type:Boolean,default:void 0},elevateNodesOnSelect:{type:Boolean,default:void 0},disableKeyboardA11y:{type:Boolean,default:void 0},edgesFocusable:{type:Boolean,default:void 0},nodesFocusable:{type:Boolean,default:void 0},autoPanOnConnect:{type:Boolean,default:void 0},autoPanOnNodeDrag:{type:Boolean,default:void 0},autoPanSpeed:{}},emits:["nodesChange","edgesChange","nodesInitialized","paneReady","init","updateNodeInternals","error","connect","connectStart","connectEnd","clickConnectStart","clickConnectEnd","moveStart","move","moveEnd","selectionDragStart","selectionDrag","selectionDragStop","selectionContextMenu","selectionStart","selectionEnd","viewportChangeStart","viewportChange","viewportChangeEnd","paneScroll","paneClick","paneContextMenu","paneMouseEnter","paneMouseMove","paneMouseLeave","edgeUpdate","edgeContextMenu","edgeMouseEnter","edgeMouseMove","edgeMouseLeave","edgeDoubleClick","edgeClick","edgeUpdateStart","edgeUpdateEnd","nodeContextMenu","nodeMouseEnter","nodeMouseMove","nodeMouseLeave","nodeDoubleClick","nodeClick","nodeDragStart","nodeDrag","nodeDragStop","miniMapNodeClick","miniMapNodeDoubleClick","miniMapNodeMouseEnter","miniMapNodeMouseMove","miniMapNodeMouseLeave","update:modelValue","update:nodes","update:edges"],setup(e,{expose:t,emit:n}){const o=e,s=wi(),a=vo(o,"modelValue",n),i=vo(o,"nodes",n),l=vo(o,"edges",n),r=Re(o),u=kf({modelValue:a,nodes:i,edges:l},o,r);return If(n,r.hooks),$p(),qp(),ct(so,s),oa(()=>{u()}),t(r),(c,d)=>(_(),T("div",{ref:P(r).vueFlowRef,class:"vue-flow"},[O(_p,null,{default:$e(()=>[O(Rp),Xp,O(Yp),nt(c.$slots,"zoom-pane")]),_:3}),nt(c.$slots,"default"),O(Cp)],512))}}),Qs=8,ko="vueflow_camera_positions";function jp(e){const{getViewport:t,setViewport:n}=Re(),o=()=>{const u=localStorage.getItem(ko);return u?JSON.parse(u):{}},s=()=>{const u=o(),c=Object.entries(u);if(c.length<=Qs)return;const p=c.sort((v,g)=>(g[1].timestamp||0)-(v[1].timestamp||0)).slice(0,Qs),f=Object.fromEntries(p);localStorage.setItem(ko,JSON.stringify(f))},a=()=>{const c={...t(),botId:e,timestamp:Date.now()},d=o();d[e]=c,localStorage.setItem(ko,JSON.stringify(d))},i=()=>{const c=o()[e];c&&c.botId===e&&n(c,{duration:0})};return{saveCameraPosition:a,loadCameraPosition:i,initCameraTracking:()=>{i(),s()},setupViewportTracking:()=>{const u=()=>{a()};return window.addEventListener("beforeunload",u),()=>{window.removeEventListener("beforeunload",u)}},cleanupOldCameraPositions:s}}var yt=(e=>(e.Lines="lines",e.Dots="dots",e))(yt||{});const pi=function({dimensions:e,size:t,color:n}){return Ae("path",{stroke:n,"stroke-width":t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`})},mi=function({radius:e,color:t}){return Ae("circle",{cx:e,cy:e,r:e,fill:t})};yt.Lines+"",yt.Dots+"";const Kp={[yt.Dots]:"#81818a",[yt.Lines]:"#eee"},Jp=["id","x","y","width","height","patternTransform"],Qp={key:2,height:"100",width:"100"},em=["fill"],tm=["x","y","fill"],nm={name:"Background",compatConfig:{MODE:3}},om=Ie({...nm,props:{id:{},variant:{default:()=>yt.Dots},gap:{default:20},size:{default:1},lineWidth:{default:1},patternColor:{},color:{},bgColor:{},height:{default:100},width:{default:100},x:{default:0},y:{default:0},offset:{default:0}},setup(e){const{id:t,viewport:n}=Re(),o=J(()=>{const i=n.value.zoom,[l,r]=Array.isArray(e.gap)?e.gap:[e.gap,e.gap],u=[l*i||1,r*i||1],c=e.size*i,[d,p]=Array.isArray(e.offset)?e.offset:[e.offset,e.offset],f=[d*i||1+u[0]/2,p*i||1+u[1]/2];return{scaledGap:u,offset:f,size:c}}),s=Ue(()=>`pattern-${t}${e.id?`-${e.id}`:""}`),a=Ue(()=>e.color||e.patternColor||Kp[e.variant||yt.Dots]);return(i,l)=>(_(),T("svg",{class:"vue-flow__background vue-flow__container",style:ot({height:`${i.height>100?100:i.height}%`,width:`${i.width>100?100:i.width}%`})},[nt(i.$slots,"pattern-container",{id:s.value},()=>[m("pattern",{id:s.value,x:P(n).x%o.value.scaledGap[0],y:P(n).y%o.value.scaledGap[1],width:o.value.scaledGap[0],height:o.value.scaledGap[1],patternTransform:`translate(-${o.value.offset[0]},-${o.value.offset[1]})`,patternUnits:"userSpaceOnUse"},[nt(i.$slots,"pattern",{},()=>[i.variant===P(yt).Lines?(_(),me(P(pi),{key:0,size:i.lineWidth,color:a.value,dimensions:o.value.scaledGap},null,8,["size","color","dimensions"])):i.variant===P(yt).Dots?(_(),me(P(mi),{key:1,color:a.value,radius:o.value.size/2},null,8,["color","radius"])):K("",!0),i.bgColor?(_(),T("svg",Qp,[m("rect",{width:"100%",height:"100%",fill:i.bgColor},null,8,em)])):K("",!0)])],8,Jp)]),m("rect",{x:i.x,y:i.y,width:"100%",height:"100%",fill:`url(#${s.value})`},null,8,tm),nt(i.$slots,"default",{id:s.value})],4))}}),sm={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},ro=Ie({...sm,props:{nodeId:null,isVisible:{type:Boolean},position:{default:oe.Top},offset:{default:10},align:{default:"center"}},setup(e){const t=e,n=Xe(ls,null),{viewportRef:o,viewport:s,getSelectedNodes:a,findNode:i}=Re();function l(f,v,g,y,k){let E=.5;k==="start"?E=0:k==="end"&&(E=1);let h=[(f.x+f.width*E)*v.zoom+v.x,f.y*v.zoom+v.y-y],I=[-100*E,-100];switch(g){case oe.Right:h=[(f.x+f.width)*v.zoom+v.x+y,(f.y+f.height*E)*v.zoom+v.y],I=[0,-100*E];break;case oe.Bottom:h[1]=(f.y+f.height)*v.zoom+v.y+y,I[1]=0;break;case oe.Left:h=[f.x*v.zoom+v.x-y,(f.y+f.height*E)*v.zoom+v.y],I=[-100,-100*E];break}return`translate(${h[0]}px, ${h[1]}px) translate(${I[0]}%, ${I[1]}%)`}const r=J(()=>(Array.isArray(t.nodeId)?t.nodeId:[t.nodeId||n||""]).reduce((f,v)=>{const g=i(v);return g&&f.push(g),f},[])),u=J(()=>typeof t.isVisible=="boolean"?t.isVisible:r.value.length===1&&r.value[0].selected&&a.value.length===1),c=J(()=>ss(r.value)),d=J(()=>Math.max(...r.value.map(f=>(f.computedPosition.z||1)+1))),p=J(()=>({position:"absolute",transform:l(c.value,s.value,t.position,t.offset,t.align),zIndex:d.value}));return(f,v)=>(_(),me(Ni,{to:P(o),disabled:!P(o)},[P(u)&&P(r).length?(_(),T("div",Ft({key:0},f.$attrs,{style:P(p),class:"vue-flow__node-toolbar"}),[nt(f.$slots,"default")],16)):K("",!0)],8,["to","disabled"]))}}),am={class:"header"},im={__name:"nodeHeader",props:{title:{type:String,required:!0},showIcon:{type:Boolean,default:!0}},setup(e){return(t,n)=>(_(),T("div",am,[e.showIcon?(_(),me(P(Cl),{key:0,class:"icon"})):K("",!0),m("span",null,te(e.title),1)]))}},uo=Oe(im,[["__scopeId","data-v-980c93ee"]]),lm={class:"flex"},rm={__name:"tab1",props:{node:{type:Object,required:!0}},emits:["update-node"],setup(e,{expose:t,emit:n}){const o=q(!1),s=e,a=q({name:s.node.data.name||"",description:s.node.data.description||"",is_proxy:s.node.data.is_proxy,id:s.node.id,type:s.node.type}),i=n,l=async()=>{i("update-node",a.value),Be.success("Сохранено!"),o.value=!1};return t({isSomethingChanged:o,save:l}),(r,u)=>{const c=ge("BaseCopyableId"),d=ge("BaseInput"),p=ge("BaseTextarea"),f=ge("BaseCheckbox"),v=ge("BaseButton");return _(),T("div",lm,[O(c,{id:s.node.id},null,8,["id"]),O(d,{modelValue:a.value.name,"onUpdate:modelValue":u[0]||(u[0]=g=>a.value.name=g),label:"Название шага",class:"section-input",onInput:u[1]||(u[1]=g=>o.value=!0)},null,8,["modelValue"]),O(p,{modelValue:a.value.description,"onUpdate:modelValue":u[2]||(u[2]=g=>a.value.description=g),label:"Описание шага",onInput:u[3]||(u[3]=g=>o.value=!0)},null,8,["modelValue"]),O(f,{modelValue:a.value.is_proxy,"onUpdate:modelValue":u[4]||(u[4]=g=>a.value.is_proxy=g),"label-color":"rgb(255, 255, 255)",class:"section-checkbox",onInput:u[5]||(u[5]=g=>o.value=!0)},{default:$e(()=>u[6]||(u[6]=[Ce(" Прокси ")])),_:1},8,["modelValue"]),O(v,{class:"button",size:"small",styleType:"secondary",type:"submit",onClick:l},{default:$e(()=>u[7]||(u[7]=[Ce(" Сохранить ")])),_:1})])}}},um=Oe(rm,[["__scopeId","data-v-0c5b97bb"]]),cm={key:1,class:"flex"},dm={class:"widgets-block"},fm=["disabled"],pm={key:0,class:"widget-card"},mm={class:"btns-block"},vm={__name:"tab2",props:{node:{type:Object,required:!0}},emits:["graphUpdate-node"],setup(e,{expose:t,emit:n}){const o=e,s=q(!1),a=Ai(),i=Pi(),l=q(null),r=q(""),u=q(!1),c=J(()=>[...a.widgets].reverse()),d=n,p=q({id:"",text:"",recipient_id:"",widget_id:"",channel_id:"",attachments:[],params:""}),f=()=>{u.value=!0},v=J(()=>!c.value||c.value.length===0?[{value:"",label:"..."}]:c.value.map(b=>({value:b.id,label:b.name||`Виджет ${b.id}`}))),g=b=>{if(!b){l.value=null,p.value.widget_id="";return}const V=c.value.find(S=>S.id===b);l.value=V||null,p.value.widget_id=(V==null?void 0:V.id)||""},y=()=>{r.value="",l.value=null,p.value.widget_id=""},k=async()=>{const b=o.node.type==="simple"?{step_id:o.node.id}:{emitter_id:o.node.id};if(p.value.id){const V={text:p.value.text||null,params:JSON.parse(p.value.params),recipient_id:p.value.recipient_id||null,widget_id:p.value.widget_id||null,channel_id:p.value.channel_id||null,...b};await i.updateMessage(p.value.id,V)}else{const V=await i.createMessage({...p.value,...b});p.value.id=V.id}Be.success("Сохранено!"),s.value=!1,d("graphUpdate-node",{id:o.node.id,data:p.value})},E=async()=>{p.value.id&&(await i.deleteMessage(p.value.id),s.value=!1,d("graphUpdate-node",{id:o.node.id,data:p.value})),h()},h=()=>{u.value=!1,p.value={text:"",recipient_id:"",widget_id:"",channel_id:"",attachments:[],params:""},r.value="",l.value=null,s.value=!1},I=async()=>{const V=q(o.node.data.message).value;V&&(u.value=!0,p.value={id:V.id||"",text:V.text||"",sender_id:V.sender_id||"",recipient_id:V.recipient_id||"",widget_id:V.widget_id||"",channel_id:V.channel_id||"",attachments:V.attachments||[],params:JSON.stringify(V.params||{},null,2)},r.value=V.widget_id||"",l.value=c.value.find(S=>S.id===V.widget_id)||null)};t({isSomethingChanged:s,save:k}),Ze(async()=>{await a.readWidgets(),await I()});const B=q(!1),H=q(!1),F=q(null),Y=q({name:"",description:"",js:"",css:"",body:""}),D=()=>{H.value=!1,F.value=null,Y.value={name:"",description:"",js:"",css:"",body:""},B.value=!0},G=()=>{if(!l.value)return;H.value=!0,F.value=l.value.id;const b=a.widgets.find(V=>V.id===l.value.id);b?Object.assign(Y.value,b):console.error("Виджет с указанным ID не найден"),B.value=!0},z=()=>{B.value=!1,l.value=a.widgets.find(b=>b.id===l.value.id)};return(b,V)=>{const S=ge("BaseButton"),R=ge("BaseTextarea"),C=ge("BaseSelectSearch"),L=ge("BaseInput"),j=ge("BaseCodeEditor");return _(),T("div",null,[V[14]||(V[14]=m("p",{class:"section-text"}," Настройте сообщение, которое будет отправлять агент при активации этого шага. ",-1)),u.value?K("",!0):(_(),me(S,{key:0,class:"add-message",size:"small",styleType:"secondary",onClick:ft(f,["stop"])},{default:$e(()=>V[10]||(V[10]=[Ce(" Создать сообщение ")])),_:1})),u.value?(_(),T("div",cm,[O(R,{modelValue:p.value.text,"onUpdate:modelValue":V[0]||(V[0]=X=>p.value.text=X),label:"Текст",class:"custom-textarea",onInput:V[1]||(V[1]=X=>s.value=!0)},null,8,["modelValue"]),m("div",dm,[O(C,{modelValue:r.value,"onUpdate:modelValue":[V[2]||(V[2]=X=>r.value=X),g],label:"Виджеты",labelColor:"rgb(255, 255, 255)",options:v.value,onInput:V[3]||(V[3]=X=>s.value=!0)},null,8,["modelValue","options"]),m("button",{disabled:!l.value,class:"widget-action-btn edit-btn",onClick:G},[O(P(Wo),{class:"icon"})],8,fm),m("button",{class:"widget-action-btn create-btn",onClick:D},"+")]),l.value?(_(),T("div",pm,[m("p",null,te(l.value.name),1),m("p",null,[V[11]||(V[11]=m("strong",null,"Описание:",-1)),Ce(" "+te(l.value.description||"Нет описания"),1)]),m("p",null,[V[12]||(V[12]=m("strong",null,"ID:",-1)),Ce(" "+te(l.value.id),1)]),m("button",{class:"btn-clear",onClick:y},"x")])):K("",!0),O(L,{modelValue:p.value.recipient_id,"onUpdate:modelValue":V[4]||(V[4]=X=>p.value.recipient_id=X),hint:"Оставьте пустым, если получатель - получатель из сессии",label:"Получатель",placeholder:"id получатель",class:"custom-input",onInput:V[5]||(V[5]=X=>s.value=!0)},null,8,["modelValue"]),O(L,{modelValue:p.value.channel_id,"onUpdate:modelValue":V[6]||(V[6]=X=>p.value.channel_id=X),label:"Канал",placeholder:"id канала",class:"custom-input",onInput:V[7]||(V[7]=X=>s.value=!0)},null,8,["modelValue"]),O(j,{modelValue:p.value.params,"onUpdate:modelValue":V[8]||(V[8]=X=>p.value.params=X),"default-height":100,"is-collapsed":!1,"is-resizable":!1,"auto-height":!0,class:"code-editor",label:"Параметры",language:"json","light-theme":"",small:"",onInput:V[9]||(V[9]=X=>s.value=!0)},null,8,["modelValue"]),m("div",mm,[m("button",{class:"btn-delete",onClick:E},[O(P(pt),{class:"icon"})]),O(S,{class:"btn-save",size:"small",styleType:"secondary",onClick:k},{default:$e(()=>V[13]||(V[13]=[Ce(" Сохранить ")])),_:1})])])):K("",!0),B.value?(_(),me(Oi,{key:2,currentWidgetId:F.value,formData:Y.value,isEditMode:H.value,onClose:z},null,8,["currentWidgetId","formData","isEditMode"])):K("",!0)])}}},vi=Oe(vm,[["__scopeId","data-v-734ac5b4"]]),hm={class:"dynamic-blocks"},gm={class:"content"},ym={key:0},_m={key:1,class:"response-block"},bm=["disabled","onClick"],wm=["disabled","onClick"],Sm=["onClick"],xm={class:"save-as-section"},Cm={class:"columns"},$m={class:"column"},Em={class:"column"},km=["onClick"],Nm={class:"connections-section"},Im={class:"connection-content"},Tm={class:"connection-btns"},Mm={key:0,class:"move-btns"},Vm=["onClick","disabled"],Dm=["onClick","disabled"],Bm=["onClick"],Am={class:"btns"},Om={key:0,class:"move-btns"},Pm=["onClick","disabled"],zm=["onClick","disabled"],Rm=["onClick"],Um={__name:"tab3",props:{node:{type:Object,required:!0}},emits:["graphUpdate-node"],setup(e,{expose:t,emit:n}){var X;const o=e,s=q(!1),a=q(!1),i=q(null),l=q({name:"",request_url:"",method:"GET",params:null,data:null,content:null,headers:null,url_params:null,attachments:null,json_field:null,proxies:null}),r=jo(),u=la(),c=q([]),d=Xe("nodes");Xe("edges");const p=q(!1),f=n,v=q(Array.from({length:((X=o.node.data.connection_groups)==null?void 0:X.length)??0}).fill(!1)),g=J(()=>v.value.indexOf(!0)!==-1),y=async()=>{const A={search_type:"message",priority:c.value.length,step_id:o.node.id,code:null,request_id:null,variables:null,connections:[]},U=await r.createConnectionGroup(A);c.value.push({id:U.id,selectedOption:"message",textareaValue:"",inputValue:"",saveAsRows:[{left:"",right:""}],connections:[]}),f("graphUpdate-node",{id:o.node.id,...o.node}),v.value.push(!1)},k=async A=>{const U=c.value[A];if(!U.id){console.warn("Невозможно удалить группу без ID");return}await r.deleteConnectionGroup(U.id),c.value.splice(A,1),f("graphUpdate-node",{id:o.node.id,...o.node}),v.value=v.value.splice(A,1)},E=A=>{A>0&&(v.value[A]=!0,v.value[A-1]=!0,[c.value[A-1],c.value[A]]=[c.value[A],c.value[A-1]])},h=A=>{A<c.value.length-1&&(v.value[A]=!0,v.value[A+1]=!0,[c.value[A+1],c.value[A]]=[c.value[A],c.value[A+1]])},I=A=>{var W;const U=((W=G.value[0])==null?void 0:W.value)||"";c.value[A].connections.push({type:U,rules:""}),v.value[A]=!0},B=(A,U)=>{c.value[A].connections.splice(U,1),v.value[A]=!0},H=(A,U)=>{if(U>0){v.value[A]=!0;const W=c.value[A].connections;[W[U-1],W[U]]=[W[U],W[U-1]]}},F=(A,U)=>{if(U<c.value[A].connections.length-1){v.value[A]=!0;const W=c.value[A].connections;[W[U+1],W[U]]=[W[U],W[U+1]]}},Y=A=>{v.value[A]=!0,c.value[A].saveAsRows.push({left:"",right:""})},D=[{value:"code",label:"Код"},{value:"response",label:"Request"},{value:"message",label:"Message"}],G=J(()=>d.value.filter(A=>A.id!==o.node.id).map(A=>({value:A.id,label:A.data.name||`Узел ${A.id}`}))),z=J(()=>u.requests.map(A=>({value:A.id,label:A.name||`Реквест ${A.id}`}))),b=()=>{a.value=!1,i.value=null,l.value={name:"",request_url:"",method:"GET",params:null,data:null,content:null,headers:null,url_params:null,attachments:null,json_field:null,proxies:null},s.value=!0},V=async A=>{if(!A.inputValue)return;a.value=!0,i.value=A.inputValue;const U=u.requests.find(W=>W.id===A.inputValue);U?Object.assign(l.value,U):console.error("Реквест с указанным ID не найден"),s.value=!0},S=async A=>{if(A.inputValue){p.value=!0;try{const U=u.requests.find(re=>re.id===A.inputValue),W=(U==null?void 0:U.variables)||{channel:{},user:{},bot:{},session:{}},Q=(U==null?void 0:U.dry_run)||!1,ee=await u.executeRequest(A.inputValue,W,Q);if(ee!=null&&ee.data){const re=Q?"проверка подстановки":"выполнение запроса";Be.success(`${re} выполнена успешно!`),console.log("Результат выполнения запроса:",ee.data)}else Be.error("Не удалось выполнить запрос")}catch(U){Be.error("Ошибка при выполнении запроса: "+(U.message||"Неизвестная ошибка")),console.error("Ошибка выполнения запроса:",U)}finally{p.value=!1}}},R=()=>{s.value=!1;const A=u.requests.find(U=>U.id===i.value);if(A){const U=c.value.find(W=>W.inputValue===i.value);U&&(U.inputValue=A.id)}},C=async A=>{const U=c.value[A],W=U.saveAsRows.reduce((re,ye)=>(ye.left&&ye.right&&(re[ye.left]=ye.right),re),{}),Q=U.connections.map((re,ye)=>({next_step_id:re.type,rules:re.rules||"",priority:ye,filters:null})),ee={id:U.id,search_type:U.selectedOption,priority:A,step_id:o.node.id,code:U.selectedOption==="code"?U.textareaValue:null,request_id:U.selectedOption==="response"&&U.inputValue||null,variables:JSON.stringify(W),connections:Q};await r.updateConnectionGroup(ee.id,ee),Be.success("Сохранено!"),f("graphUpdate-node",{id:o.node.id,...o.node}),v.value[A]=!1},L=()=>{var A;(((A=o.node.data.connection_groups)==null?void 0:A.length)??!1)&&(c.value=o.node.data.connection_groups.map(U=>{const W=U.variables?JSON.parse(U.variables):{};return{id:U.id,selectedOption:U.search_type,textareaValue:U.code||"",inputValue:U.request_id||"",saveAsRows:Object.entries(W).map(([Q,ee])=>({left:Q,right:ee})),connections:U.connections.map(Q=>({type:Q.next_step_id,rules:Q.rules||""}))}}))};return t({isSomethingChanged:g,save:async()=>{for(let A=0;A<c.value.length;A++)await C(A);f("graphUpdate-node",{id:o.node.id,...o.node})}}),Ze(async()=>{await u.readRequests(),L()}),(A,U)=>{const W=ge("BaseSelect"),Q=ge("BaseCodeEditor"),ee=ge("BaseSelectSearch"),re=ge("BaseInput"),ye=ge("BaseButton");return _(),T("div",hm,[(_(!0),T(Ee,null,ze(c.value,(pe,ve)=>(_(),T("div",{key:ve,class:"block"},[m("h3",null,"Группа связей № "+te(ve+1),1),m("div",gm,[O(W,{modelValue:pe.selectedOption,"onUpdate:modelValue":se=>pe.selectedOption=se,options:D,label:"Тип поиска",class:"first-select",onInput:se=>v.value[ve]=!0},null,8,["modelValue","onUpdate:modelValue","onInput"]),pe.selectedOption==="code"?(_(),T("div",ym,[O(Q,{label:"Код",labelColor:"rgb(30, 30, 30)",language:"python","is-collapsed":!1,"is-resizable":!1,"auto-height":!0,"default-height":200,modelValue:pe.textareaValue,"onUpdate:modelValue":se=>pe.textareaValue=se,onInput:se=>v.value[ve]=!0,class:"code-editor","light-theme":"",small:""},null,8,["modelValue","onUpdate:modelValue","onInput"])])):K("",!0),pe.selectedOption==="response"?(_(),T("div",_m,[O(ee,{modelValue:pe.inputValue,"onUpdate:modelValue":se=>pe.inputValue=se,options:z.value,label:"Запрос",labelColor:"rgb(30, 30, 30)",onInput:se=>v.value[ve]=!0},null,8,["modelValue","onUpdate:modelValue","options","onInput"]),m("button",{class:"request-action-btn edit-btn",disabled:!pe.inputValue,onClick:se=>V(pe)},[O(P(Wo),{class:"icon"})],8,bm),m("button",{class:"request-action-btn execute-btn",disabled:!pe.inputValue||p.value,onClick:se=>S(pe)},te(p.value?"...":"Execute"),9,wm),m("button",{class:"request-action-btn create-btn",onClick:se=>b()}," + ",8,Sm)])):K("",!0),m("div",xm,[U[0]||(U[0]=m("span",{class:"label"},"Сохранить результат",-1)),m("div",Cm,[m("div",$m,[(_(!0),T(Ee,null,ze(pe.saveAsRows,(se,Se)=>(_(),T("div",{key:Se,class:"row"},[O(re,{modelValue:se.left,"onUpdate:modelValue":ie=>se.left=ie,label:"",placeholder:"Ключ",labelColor:"rgb(30, 30, 30)",onInput:ie=>v.value[ve]=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]))),128))]),m("div",Em,[(_(!0),T(Ee,null,ze(pe.saveAsRows,(se,Se)=>(_(),T("div",{key:Se,class:"row"},[O(re,{modelValue:se.right,"onUpdate:modelValue":ie=>se.right=ie,label:"",placeholder:"Значение",labelColor:"rgb(30, 30, 30)",onInput:ie=>v.value[ve]=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]))),128))])]),m("button",{class:"add-button",onClick:se=>Y(ve)},"Добавить переменную",8,km)]),m("div",Nm,[(_(!0),T(Ee,null,ze(pe.connections,(se,Se)=>(_(),T("div",{key:Se,class:"connection"},[m("h3",null,"Связь № "+te(Se+1),1),m("div",Im,[O(W,{modelValue:se.type,"onUpdate:modelValue":ie=>se.type=ie,options:G.value,label:"Следующий шаг",class:"first-select",onInput:ie=>v.value[ve]=!0},null,8,["modelValue","onUpdate:modelValue","options","onInput"]),O(Q,{label:"Правила",labelColor:"rgb(30, 30, 30)",language:"json","is-collapsed":!1,"is-resizable":!1,"default-height":100,modelValue:se.rules,"onUpdate:modelValue":ie=>se.rules=ie,onInput:ie=>v.value[ve]=!0,class:"code-editor","light-theme":"",small:""},null,8,["modelValue","onUpdate:modelValue","onInput"])]),m("div",Tm,[pe.connections.length>1?(_(),T("div",Mm,[m("button",{onClick:ie=>H(ve,Se),disabled:Se===0},[O(P(Pn))],8,Vm),m("button",{onClick:ie=>F(ve,Se),disabled:Se===pe.connections.length-1},[O(P(On))],8,Dm)])):K("",!0),m("button",{onClick:ft(ie=>B(ve,Se),["stop"])},[O(P(pt),{class:"icon icon-trash"})],8,Bm)])]))),128)),O(ye,{styleType:"primary",size:"small",onClick:se=>I(ve)},{default:$e(()=>U[1]||(U[1]=[Ce(" Добавить связь ")])),_:2},1032,["onClick"])])]),m("div",Am,[c.value.length>1?(_(),T("div",Om,[m("button",{onClick:se=>E(ve),disabled:ve===0},[O(P(Pn))],8,Pm),m("button",{onClick:se=>h(ve),disabled:ve===c.value.length-1},[O(P(On))],8,zm)])):K("",!0),m("button",{onClick:se=>k(ve)},[O(P(pt),{class:"icon icon-trash"})],8,Rm),O(ye,{styleType:"primary",size:"small",onClick:se=>C(ve)},{default:$e(()=>U[2]||(U[2]=[Ce("Сохранить")])),_:2},1032,["onClick"])])]))),128)),O(ye,{styleType:"secondary",size:"small",onClick:y},{default:$e(()=>U[3]||(U[3]=[Ce(" Добавить группу связей ")])),_:1}),s.value?(_(),me(Ri,{key:0,isEditMode:a.value,formData:l.value,currentRequestId:i.value,onClose:R},null,8,["isEditMode","formData","currentRequestId"])):K("",!0)])}}},hi=Oe(Um,[["__scopeId","data-v-bd1a06bc"]]),Lm={key:0,class:"logs-container"},Gm={class:"logs-header"},Hm={class:"logs-count"},Fm={class:"logs-list"},Ym={class:"log-header"},qm={class:"log-timestamp"},Xm={class:"log-message"},Wm={key:1,class:"logs-empty"},Zm=Ie({__name:"tab4",props:{node:{type:Object,required:!0},botId:{type:String,required:!1}},setup(e){const t=e,n=Zn(),o=J(()=>{const a=t.botId||Object.keys(n.bots)[0];return a?n.getStepLogs(a,t.node.id):[]}),s=a=>a?new Date(a).toLocaleString("ru-RU"):"";return(a,i)=>(_(),T("div",null,[o.value.length?(_(),T("div",Lm,[m("div",Gm,[m("span",Hm,"Кол-во записей: "+te(o.value.length),1)]),m("div",Fm,[(_(!0),T(Ee,null,ze(o.value,(l,r)=>(_(),T("div",{key:r,class:He(["log-entry",`log-${l.level.toLowerCase()}`])},[m("div",Ym,[m("span",{class:He(["log-level",`level-${l.level.toLowerCase()}`])},te(l.level),3),m("span",qm,te(s(l.timestamp)),1)]),m("div",Xm,te(l.message),1)],2))),128))])])):(_(),T("div",Wm,i[0]||(i[0]=[m("p",{class:"section-text"},"В данный момент журнал пуст",-1)])))]))}}),jm=Oe(Zm,[["__scopeId","data-v-d8784464"]]),co=Ie({__name:"simpleNodePanel",props:{node:{},initActiveTab:{},botId:{}},emits:["action"],setup(e,{expose:t,emit:n}){const o=[{name:"main",label:"Основное"},{name:"representation",label:"Ответ"},{name:"connections",label:"Связи"},{name:"log",label:"Журнал"}],s=q(localStorage.getItem("simple:lastTab")||e.initActiveTab||"main"),a=d=>{s.value=d,localStorage.setItem("simple:lastTab",d)},i={main:qe("main"),representation:qe("representation"),connections:qe("connections"),log:qe("log")},l=async(d,p)=>{let f=null,v;if(d in i?v=i[d].value:v=null,v!=null&&v.isSomethingChanged&&window.confirm("Хотите сохранить изменения?"))if(v!=null&&v.trySave)try{await(v==null?void 0:v.trySave()),a(p)}catch(g){f=g,console.error("Error saving tab:",g)}else await(v==null?void 0:v.save());f||a(p)},r=n,u=d=>{r("action",{action:"update",data:d})},c=d=>{r("action",{action:"graphUpdate",data:d})};return t({save:()=>l(s.value,s.value)}),(d,p)=>{const f=ge("BasePanelTabs");return _(),me(f,{"active-tab":s.value,tabs:o,onTabChange:l},{default:$e(()=>[s.value==="main"?(_(),me(um,{key:0,ref:"main",node:d.node,onUpdateNode:u},null,8,["node"])):K("",!0),s.value==="representation"?(_(),me(vi,{key:1,ref:"representation",node:d.node,onGraphUpdateNode:c},null,8,["node"])):K("",!0),s.value==="connections"?(_(),me(hi,{key:2,ref:"connections",node:d.node,onGraphUpdateNode:c},null,8,["node"])):K("",!0),s.value==="log"?(_(),me(jm,{key:3,ref:"log",node:d.node,"bot-id":d.botId},null,8,["node","bot-id"])):K("",!0)]),_:1},8,["active-tab"])}}}),Km={class:"footer"},Jm={class:"card hidden"},Qm={__name:"nodeFooter",props:{node:{type:Object,required:!0}},setup(e){const t=e.node.data.connection_groups??[],n=t.map(d=>d.search_type),o=n.filter(d=>d==="code").length,s=n.filter(d=>d==="response").length,a=t.flatMap(d=>d.connections).length,{setDrawer:i,setProps:l}=Xe("drawer"),r=async d=>{l({node:e.node,initActiveTab:d}),await i(co)},u=async()=>{await r("connections")},c=async()=>{await r("log")};return(d,p)=>(_(),T("div",Km,[m("button",{class:"card repeat",style:{"margin-right":"auto"},onClick:c},[O(P(wl),{class:"icon"}),p[0]||(p[0]=m("span",null,"0",-1))]),K("",!0),P(o)>0?(_(),T("button",{key:1,class:"card",onClick:u},[O(P(yl),{class:"icon"}),m("span",null,te(P(o)),1)])):K("",!0),P(s)>0?(_(),T("button",{key:2,class:"card api",onClick:u},[p[1]||(p[1]=m("span",{style:{margin:"0"}},"API",-1)),m("span",null,te(P(s)),1)])):K("",!0),m("button",{class:"card",onClick:u},[O(P(vl),{class:"icon"}),m("span",null,te(P(a)),1)]),m("button",Jm,[O(P(fl),{class:"icon"})])]))}},ev=Oe(Qm,[["__scopeId","data-v-27ae2bce"]]),tv={key:0,class:"desc"},nv={__name:"simpleNode",props:{node:{type:Object,required:!0}},emits:["action"],setup(e,{emit:t}){const n=e,o=t,s=v=>{v==="delete"?window.confirm("Вы уверены, что хотите удалить этот узел?")&&o("action",{action:"delete",data:{id:n.node.id,type:n.node.type}}):v==="copy"&&o("action",{action:"copy",data:{id:n.node.id,type:n.node.type}})},a=q(!1);let i=null;const l=()=>{clearTimeout(i),a.value=!0},r=()=>{i=setTimeout(()=>{a.value=!1},300)},u=()=>{clearTimeout(i)},{setDrawer:c,setProps:d}=Xe("drawer"),p=()=>{c(co),d({node:n.node})},f=v=>v?v.length<=80?v:v.substring(0,80)+"...":"";return(v,g)=>(_(),T("div",{class:"simple-node",onClick:p,onMouseleave:r,onMouseover:l},[O(uo,{title:e.node.data.name||"Название шага"},null,8,["title"]),e.node.data.message&&e.node.data.message.text?(_(),T("span",tv,te(f(e.node.data.message.text)),1)):K("",!0),O(ev,{node:e.node},null,8,["node"]),O(P(ro),{"is-visible":a.value,position:P(oe).Top,onMouseleave:r,onMouseover:u},{default:$e(()=>[m("button",{onClick:g[0]||(g[0]=y=>s("delete"))},[O(P(pt),{class:"icon"})]),m("button",{onClick:g[1]||(g[1]=y=>s("copy"))},[O(P(zn),{class:"icon"})]),m("button",{onClick:p},[O(P(Zo),{class:"icon edit-icon"})])]),_:1},8,["is-visible","position"]),O(P(bt),{position:P(oe).Left,type:"target"},null,8,["position"]),O(P(bt),{position:P(oe).Right,type:"source"},null,8,["position"])],32))}},ov=Oe(nv,[["__scopeId","data-v-743d4314"]]),sv={class:"emitter-settings"},av={class:"cron-fields"},iv=["disabled"],lv=["disabled"],rv={class:"btns-block"},uv={__name:"main",props:{node:{type:Object,required:!0}},emits:["update-node"],setup(e,{expose:t,emit:n}){const o=q(!1),s=e,a=n,i=Xl(),l=q(s.node.data.name),r=q(s.node.data.is_active||!1),u=q(s.node.data.needs_message_processing),c=q(null),d=q(!1);Ii(()=>r.value=s.node.data.is_active);const p=()=>({name:"",year:"*",month:"*",day:"*",day_of_week:"*",hour:"*",minute:"*",second:"*"}),f=at(p()),v=q([{value:"advanced",label:"Расширенный"}]);(async()=>{const h=(await i.readCrons()).map(I=>({value:I.id.toString(),label:I.name,...I}));v.value=[{value:"advanced",label:"Расширенный"},...h],s.node.data.cron_id!==void 0&&s.node.data.cron_id!==null&&(c.value=s.node.data.cron_id.toString(),g())})();const g=()=>{if(c.value==="advanced")d.value=!0,Object.assign(f,p());else{d.value=!1;const E=v.value.find(h=>h.value===c.value);E&&Object.assign(f,{name:E.name,year:E.year,month:E.month,day:E.day,day_of_week:E.day_of_week,hour:E.hour,minute:E.minute,second:E.second})}},y=async E=>{r.value=E,await k(),Be.success(E?"Запущено!":"Остановлено!")},k=async()=>{let E=null;if(c.value==="advanced"){if(!f.name||f.name.trim()===""){Be.error("Название не может быть пустым!");return}E=(await i.createCron({...f})).id}else c.value&&(E=c.value);const h={type:"emitter",id:s.node.id,name:l.value,is_active:r.value,needs_message_processing:u.value};if(E&&(h.cron_id=E),c.value){const I=v.value.find(B=>B.value===c.value);I&&(h.cron_name=I.label)}Be.success("Сохранено!"),o.value=!1,a("update-node",h)};return t({isSomethingChanged:o,save:k}),(E,h)=>{const I=ge("BaseCopyableId"),B=ge("BaseInput"),H=ge("BaseSelectSearch"),F=ge("BaseCheckbox"),Y=ge("BaseButton");return _(),T(Ee,null,[O(I,{id:s.node.id,style:{"margin-bottom":"10px"}},null,8,["id"]),m("div",sv,[O(B,{modelValue:l.value,"onUpdate:modelValue":h[0]||(h[0]=D=>l.value=D),label:"Название эмиттера",labelColor:"rgb(30, 30, 30)",onInput:h[1]||(h[1]=D=>o.value=!0)},null,8,["modelValue"]),O(H,{modelValue:c.value,"onUpdate:modelValue":[h[2]||(h[2]=D=>c.value=D),g],options:v.value,label:"Частота запуска",onInput:h[3]||(h[3]=D=>o.value=!0)},null,8,["modelValue","options"]),m("div",null,[d.value?(_(),me(B,{key:0,modelValue:f.name,"onUpdate:modelValue":h[4]||(h[4]=D=>f.name=D),label:"Название крона",labelColor:"rgb(30, 30, 30)",class:"cron-name",onInput:h[5]||(h[5]=D=>o.value=!0)},null,8,["modelValue"])):K("",!0),m("div",av,[O(B,{modelValue:f.year,"onUpdate:modelValue":h[6]||(h[6]=D=>f.year=D),label:"Год",labelColor:"rgb(30, 30, 30)",disabled:!d.value,onInput:h[7]||(h[7]=D=>o.value=!0)},null,8,["modelValue","disabled"]),O(B,{modelValue:f.month,"onUpdate:modelValue":h[8]||(h[8]=D=>f.month=D),label:"Месяц",labelColor:"rgb(30, 30, 30)",disabled:!d.value,onInput:h[9]||(h[9]=D=>o.value=!0)},null,8,["modelValue","disabled"]),O(B,{modelValue:f.day,"onUpdate:modelValue":h[10]||(h[10]=D=>f.day=D),label:"День",labelColor:"rgb(30, 30, 30)",disabled:!d.value,onInput:h[11]||(h[11]=D=>o.value=!0)},null,8,["modelValue","disabled"]),O(B,{modelValue:f.day_of_week,"onUpdate:modelValue":h[12]||(h[12]=D=>f.day_of_week=D),label:"День недели",labelColor:"rgb(30, 30, 30)",disabled:!d.value,onInput:h[13]||(h[13]=D=>o.value=!0)},null,8,["modelValue","disabled"]),O(B,{modelValue:f.hour,"onUpdate:modelValue":h[14]||(h[14]=D=>f.hour=D),label:"Час",labelColor:"rgb(30, 30, 30)",disabled:!d.value,onInput:h[15]||(h[15]=D=>o.value=!0)},null,8,["modelValue","disabled"]),O(B,{modelValue:f.minute,"onUpdate:modelValue":h[16]||(h[16]=D=>f.minute=D),label:"Минута",labelColor:"rgb(30, 30, 30)",disabled:!d.value,onInput:h[17]||(h[17]=D=>o.value=!0)},null,8,["modelValue","disabled"]),O(B,{modelValue:f.second,"onUpdate:modelValue":h[18]||(h[18]=D=>f.second=D),label:"Секунда",labelColor:"rgb(30, 30, 30)",disabled:!d.value,onInput:h[19]||(h[19]=D=>o.value=!0)},null,8,["modelValue","disabled"]),r.value?(_(),T("button",{key:1,class:"control-btn stop",onClick:h[21]||(h[21]=D=>y(!1)),disabled:!s.node.data.cron_id||!s.node.data.message_id},[O(P(Hl),{class:"icon control-icon stop-icon"}),h[25]||(h[25]=Ce(" стоп "))],8,lv)):(_(),T("button",{key:0,class:"control-btn play",onClick:h[20]||(h[20]=D=>y(!0)),disabled:!s.node.data.cron_id||!s.node.data.message_id},[O(P(ua),{class:"icon control-icon play-icon"}),h[24]||(h[24]=Ce(" пуск "))],8,iv))])]),O(F,{modelValue:u.value,"onUpdate:modelValue":h[22]||(h[22]=D=>u.value=D),class:"section-checkbox",onInput:h[23]||(h[23]=D=>o.value=!0)},{default:$e(()=>h[26]||(h[26]=[Ce(" Проверять сообщение ")])),_:1},8,["modelValue"]),m("div",rv,[O(Y,{styleType:"secondary",size:"small",onClick:k,class:"save"},{default:$e(()=>h[27]||(h[27]=[Ce(" Сохранить ")])),_:1})])])],64)}}},cv=Oe(uv,[["__scopeId","data-v-4a3bc030"]]),dv={};function fv(e,t){return _(),T("div",null,t[0]||(t[0]=[m("p",{class:"section-text"}," Здесь будут отображаться все совершенные действия, записанные в журнал. ",-1)]))}const pv=Oe(dv,[["render",fv],["__scopeId","data-v-67c89b70"]]),us=Ie({__name:"emitterNodePanel",props:{node:{}},emits:["action"],setup(e,{expose:t,emit:n}){const o=[{name:"settings",label:"Настройки"},{name:"message",label:"Сообщение"},{name:"log",label:"Журнал"}],s={settings:qe("settings"),message:qe("message"),log:qe("log")},a=async(c,d)=>{let p=null;const f=s[c].value;if(f!=null&&f.isSomethingChanged&&window.confirm("Хотите сохранить изменения?"))if(f!=null&&f.trySave)try{await(f==null?void 0:f.trySave()),i.value=d}catch(v){p=v,console.error("Error saving tab:",v)}else await f.save();p||(i.value=d)};t({save:()=>a(i.value,"settings")});const i=q(o[0].name),l=n,r=c=>{l("action",{action:"update",data:c})},u=c=>{l("action",{action:"graphUpdate",data:c})};return(c,d)=>{const p=ge("BasePanelTabs");return _(),me(p,{tabs:o,"active-tab":i.value,onTabChange:a},{default:$e(()=>[i.value==="settings"?(_(),me(cv,{key:0,ref:"settings",node:c.node,onUpdateNode:r},null,8,["node"])):K("",!0),i.value==="message"?(_(),me(vi,{key:1,ref:"message",node:c.node,onGraphUpdateNode:u},null,8,["node"])):K("",!0),i.value==="log"?(_(),me(pv,{key:2,ref:"log"},null,512)):K("",!0)]),_:1},8,["active-tab"])}}}),mv={key:0,class:"desc"},vv=["disabled","title"],hv={__name:"emitterNode",props:{node:{type:Object,required:!0}},emits:["action"],setup(e,{emit:t}){const n=e,o=q(n.node.data.is_active),s=()=>{const k=n.node.data.cron_id,E=n.node.data.message_id;if(!k&&!E)return"Укажите частоту запуска и сообщение";if(k){if(!E)return"Укажите сообщение"}else return"Укажите частоту запуска";return""},a=t,i=k=>{k==="delete"?window.confirm("Вы уверены, что хотите удалить этот узел?")&&a("action",{action:"delete",data:{id:n.node.id,type:n.node.type}}):k==="copy"&&a("action",{action:"copy",data:{id:n.node.id,type:n.node.type}})},l=q(!1);let r=null;const u=()=>{clearTimeout(r),l.value=!0},c=()=>{r=setTimeout(()=>{l.value=!1},300)},d=()=>{clearTimeout(r)},p=()=>{var E,h;o.value=!o.value,Be.success(o.value?"Запущено!":"Остановлено!");const k={is_active:o.value,type:"emitter",id:n.node.id};a("action",{action:"update",data:k}),((h=(E=g.value)==null?void 0:E.node)==null?void 0:h.id)===n.node.id&&v({node:{...n.node,data:{...n.node.data,is_active:o.value}}})},{setDrawer:f,setProps:v,drawerProps:g}=Xe("drawer"),y=()=>{f(us),v({node:n.node})};return(k,E)=>{var h;return _(),T("div",{class:"emitter-node",onClick:y,onMouseover:u,onMouseleave:c},[O(uo,{showIcon:!1,title:n.node.data.name||"Эмиттер"},null,8,["title"]),(h=n.node.data.cron)!=null&&h.name?(_(),T("span",mv,te(n.node.data.cron_name||n.node.data.cron.name),1)):K("",!0),m("button",{class:"control-panel",disabled:!n.node.data.cron_id||!n.node.data.message_id,title:!n.node.data.cron_id||!n.node.data.message_id?s():"",onClick:p},[o.value?(_(),me(P(Ul),{key:0,class:"icon"})):(_(),me(P(ua),{key:1,class:"icon play-icon"})),Ce(" "+te(o.value?"стоп":"пуск"),1)],8,vv),O(P(ro),{"is-visible":l.value,position:P(oe).Top,onMouseover:d,onMouseleave:c},{default:$e(()=>[m("button",{onClick:E[0]||(E[0]=I=>i("delete"))},[O(P(pt),{class:"icon"})]),m("button",{onClick:E[1]||(E[1]=I=>i("copy"))},[O(P(zn),{class:"icon"})]),m("button",{onClick:y},[O(P(Zo),{class:"icon edit-icon"})])]),_:1},8,["is-visible","position"])],32)}}},gv=Oe(hv,[["__scopeId","data-v-e0f3ddc7"]]),yv={class:"header-block"},_v={key:0},ea=60,bv={__name:"noteNode",props:{node:{type:Object,required:!0}},emits:["action"],setup(e,{emit:t}){const n=e,o=t,s=q(n.node.data.text||""),a=q(!1),i=q(!1),l=q(null),r=J(()=>a.value||s.value.length<=ea?s.value:`${s.value.slice(0,ea)}...`),u=()=>a.value=!i.value&&!a.value,c=()=>{i.value=!i.value,i.value&&Fe(d)},d=()=>{const h=l.value;h&&(h.style.height="auto",h.style.height=`${h.scrollHeight}px`)},p=q(!1);let f=null;const v=()=>{clearTimeout(f),p.value=!0},g=()=>{f=setTimeout(()=>{p.value=!1},300)},y=()=>{clearTimeout(f)},k=()=>{window.confirm("Вы уверены, что хотите удалить этот узел?")&&o("action",{action:"delete",data:{id:n.node.id,type:n.node.type}})},E=()=>{o("action",{action:"update",data:{id:n.node.id,type:n.node.type,text:s.value}})};return(h,I)=>(_(),T("div",{class:"note-node",onMouseleave:g,onMouseover:v},[m("div",yv,[O(uo,{style:{"margin-right":"auto"},title:"Заметка",showIcon:!1}),m("button",{onClick:ft(c,["stop"])},[i.value?(_(),me(P(Tl),{key:1,class:"icon",onClick:E})):(_(),me(P(Wo),{key:0,class:"icon"}))]),O(P(kl),{class:He(["icon",{rotated:a.value}]),onClick:u},null,8,["class"])]),m("div",{class:He(["content-block",{"change-color":a.value}])},[i.value?An((_(),T("textarea",{key:1,ref_key:"textarea",ref:l,"onUpdate:modelValue":I[0]||(I[0]=B=>s.value=B),class:"editable-textarea",onInput:d},null,544)),[[Io,s.value]]):(_(),T("p",_v,te(r.value),1))],2),O(P(ro),{"is-visible":p.value,position:P(oe).Top,onMouseleave:g,onMouseover:y},{default:$e(()=>[m("button",{onClick:k},[O(P(pt),{class:"icon trash-icon"})])]),_:1},8,["is-visible","position"]),O(P(bt),{position:P(oe).Left,type:"source"},null,8,["position"])],32))}},wv=Oe(bv,[["__scopeId","data-v-4aa31594"]]),Sv={class:"flex"},xv={class:"section"},Cv={class:"template-details"},$v={class:"detail-item"},Ev={class:"detail-item"},kv={class:"section"},Nv={class:"mapping-info"},Iv={class:"mapping-item"},Tv={class:"mapping-json"},Mv={class:"mapping-item"},Vv={class:"mapping-json"},Dv={__name:"templateInfo",props:{node:{type:Object,required:!0}},emits:["update-node"],setup(e,{expose:t,emit:n}){const o=q(!1),s=e,a=q({name:s.node.data.name||"",id:s.node.id,type:s.node.type}),i=n,l=async()=>{i("update-node",a.value),Be.success("Сохранено!"),o.value=!1},r=u=>{try{return JSON.stringify(u,null,2)}catch{return String(u)}};return t({isSomethingChanged:o,save:l}),(u,c)=>{const d=ge("BaseCopyableId"),p=ge("BaseInput"),f=ge("BaseButton");return _(),T("div",Sv,[m("div",xv,[m("div",Cv,[m("div",$v,[c[2]||(c[2]=m("label",null,"template_instance_id:",-1)),O(d,{id:s.node.data.template_id},null,8,["id"])]),m("div",Ev,[O(p,{modelValue:a.value.name,"onUpdate:modelValue":c[0]||(c[0]=v=>a.value.name=v),label:"Название шаблона:",class:"section-input",onInput:c[1]||(c[1]=v=>o.value=!0)},null,8,["modelValue"])])])]),m("div",kv,[m("div",Nv,[m("div",Iv,[c[3]||(c[3]=m("label",null,"Inputs Mapping:",-1)),m("pre",Tv,te(r(s.node.data.inputs_mapping)),1)]),m("div",Mv,[c[4]||(c[4]=m("label",null,"Outputs Mapping:",-1)),m("pre",Vv,te(r(s.node.data.outputs_mapping)),1)])])]),O(f,{styleType:"secondary",size:"small",type:"submit",class:"button",onClick:l},{default:$e(()=>c[5]||(c[5]=[Ce(" Сохранить ")])),_:1})])}}},Bv=Oe(Dv,[["__scopeId","data-v-a28a95cd"]]),Av={class:"flex"},Ov={class:"section"},Pv={class:"section"},zv={class:"validation-info"},Rv={key:0,class:"validation-error"},Uv={key:1,class:"validation-success"},Lv={__name:"variables",props:{node:{type:Object,required:!0}},emits:["update-node"],setup(e,{expose:t,emit:n}){const o=q(!1),s=q(""),a=e,i=q(JSON.stringify(a.node.data.variables||{},null,2)),l=n;Me(i,u=>{try{JSON.parse(u),s.value=""}catch{s.value="Invalid JSON format"}});const r=async()=>{try{const u=JSON.parse(i.value);l("update-node",{...a.node,variables:u,template_instance_id:a.node.data.template_id,id:a.node.id,type:a.node.type}),Be.success("Переменные сохранены!"),o.value=!1}catch{Be.error("Invalid JSON format")}};return t({isSomethingChanged:o,save:r}),(u,c)=>{const d=ge("BaseCodeEditor"),p=ge("BaseButton");return _(),T("div",Av,[m("div",Ov,[c[2]||(c[2]=m("p",{class:"section-description"}," Отредактируйте переменные, которые будут использоваться этим экземпляром шаблона. ",-1)),O(d,{modelValue:i.value,"onUpdate:modelValue":c[0]||(c[0]=f=>i.value=f),"default-height":300,"is-collapsed":!1,"is-resizable":!0,label:"Variables (JSON)",language:"json",height:"300px",onInput:c[1]||(c[1]=f=>o.value=!0)},null,8,["modelValue"])]),m("div",Pv,[m("div",zv,[s.value?(_(),T("div",Rv,[c[3]||(c[3]=m("span",{class:"error-icon"},"⚠",-1)),Ce(" "+te(s.value),1)])):(_(),T("div",Uv,c[4]||(c[4]=[m("span",{class:"success-icon"},"✓",-1),Ce(" Valid JSON format ")])))])]),O(p,{styleType:"secondary",size:"small",type:"submit",class:"button",onClick:r},{default:$e(()=>c[5]||(c[5]=[Ce(" Сохранить ")])),_:1})])}}},Gv=Oe(Lv,[["__scopeId","data-v-b7930312"]]),Hv={class:"flex"},Fv={class:"section"},Yv={class:"first-step-section"},qv={class:"step-card first-step"},Xv={class:"step-name"},Wv={class:"step-id"},Zv={class:"all-steps-section"},jv={class:"subsection-title"},Kv={class:"steps-list"},Jv={key:0,class:"first-step-badge"},Qv={class:"step-name"},eh={class:"step-id"},th={class:"step-details"},nh={class:"step-detail"},oh={class:"step-detail"},sh={__name:"steps",props:{node:{type:Object,required:!0}},setup(e,{expose:t}){const n=e,o=J(()=>{var i;return(i=n.node.data.template_instance)!=null&&i.steps?n.node.data.template_instance.steps:n.node.data.steps||[]}),s=J(()=>{var l;const i=(l=n.node.data.template_instance)==null?void 0:l.first_step_id;return i?o.value.find(u=>u.id===i):o.value[0]}),a=i=>i.connection_groups?i.connection_groups.reduce((l,r)=>{var u;return l+(((u=r.connections)==null?void 0:u.length)||0)},0):0;return t({}),(i,l)=>{var r,u;return _(),T("div",Hv,[m("div",Fv,[l[3]||(l[3]=m("p",{class:"section-description"},"Шаги, включенные в этот шаблон, и их конфигурация",-1)),m("div",Yv,[l[0]||(l[0]=m("h4",{class:"subsection-title"},"Первый шаг",-1)),m("div",qv,[m("span",Xv,te(((r=s.value)==null?void 0:r.name)||"N/A"),1),m("span",Wv,"ID: "+te(((u=s.value)==null?void 0:u.id)||"N/A"),1)])]),m("div",Zv,[m("h4",jv,"Все шаги ("+te(o.value.length)+")",1),m("div",Kv,[(_(!0),T(Ee,null,ze(o.value,c=>{var d,p;return _(),T("div",{key:c.id,class:He(["step-card",{"is-first-step":c.id===((d=s.value)==null?void 0:d.id)}])},[c.id===((p=s.value)==null?void 0:p.id)?(_(),T("span",Jv,"First")):K("",!0),m("span",Qv,te(c.name),1),m("span",eh,"ID: "+te(c.id),1),m("div",th,[m("span",nh,[l[1]||(l[1]=m("strong",null,"Proxy:",-1)),Ce(" "+te(c.is_proxy?"Yes":"No"),1)]),m("span",oh,[l[2]||(l[2]=m("strong",null,"Connections:",-1)),Ce(" "+te(a(c)),1)])])],2)}),128))])])])])}}},ah=Oe(sh,[["__scopeId","data-v-de017913"]]),ih={class:"flex"},lh={__name:"connections",props:{node:{type:Object,required:!0}},emits:["graphUpdate-node"],setup(e){const t=e;return(n,o)=>(_(),T("div",ih,[O(hi,{node:t.node,onGraphUpdateNode:o[0]||(o[0]=s=>n.$emit("graphUpdate-node",s))},null,8,["node"])]))}},rh=Oe(lh,[["__scopeId","data-v-aa16858d"]]),uh=Ie({__name:"templateInstancePanel",props:{node:{}},emits:["action"],setup(e,{expose:t,emit:n}){const o=[{name:"templateInfo",label:"Основное"},{name:"variables",label:"Переменные"},{name:"steps",label:"Шаги"},{name:"connections",label:"Связи"}],s=q(o[0].name),a={templateInfo:qe("templateInfo"),variables:qe("variables"),steps:qe("steps"),connections:qe("connections")},i=async(c,d)=>{let p=null;const f=a[c].value;if(f!=null&&f.isSomethingChanged&&window.confirm("Хотите сохранить изменения?"))if(f!=null&&f.trySave)try{await(f==null?void 0:f.trySave()),s.value=d}catch(v){p=v,console.error("Error saving tab:",v)}else await f.save();p||(s.value=d)};t({save:()=>i(s.value,"templateInfo")});const l=n,r=c=>{l("action",{action:"update",data:c})},u=c=>{l("action",{action:"graphUpdate",data:c})};return(c,d)=>{const p=ge("BasePanelTabs");return _(),me(p,{"active-tab":s.value,tabs:o,onTabChange:i},{default:$e(()=>[s.value==="templateInfo"?(_(),me(Bv,{key:0,ref:"templateInfo",node:c.node,onUpdateNode:r},null,8,["node"])):K("",!0),s.value==="variables"?(_(),me(Gv,{key:1,ref:"variables",node:c.node,onUpdateNode:r},null,8,["node"])):K("",!0),s.value==="steps"?(_(),me(ah,{key:2,ref:"steps",node:c.node},null,8,["node"])):K("",!0),s.value==="connections"?(_(),me(rh,{key:3,ref:"connections",node:c.node,onGraphUpdateNode:u},null,8,["node"])):K("",!0)]),_:1},8,["active-tab"])}}}),ch={class:"template-info"},dh={class:"template-badge"},fh={class:"template-id"},ph={__name:"templateInstanceNode",props:{node:{type:Object,required:!0}},emits:["action"],setup(e,{emit:t}){const n=e,o=t,s=f=>{window.confirm("Вы уверены, что хотите удалить этот template instance?")&&o("action",{action:"delete",data:{id:n.node.id,type:n.node.type}})},a=q(!1);let i=null;const l=()=>{clearTimeout(i),a.value=!0},r=()=>{i=setTimeout(()=>{a.value=!1},300)},u=()=>{clearTimeout(i)},{setDrawer:c,setProps:d}=Xe("drawer"),p=()=>{c(uh),d({node:n.node})};return(f,v)=>(_(),T("div",{class:"template-instance-node",onClick:p,onMouseleave:r,onMouseover:l},[O(uo,{title:e.node.data.name||"Template Instance",showIcon:!1},null,8,["title"]),m("div",ch,[m("div",dh,[v[1]||(v[1]=m("span",{class:"template-label"},"Template",-1)),m("span",fh,te(e.node.data.template_id),1)])]),O(P(ro),{"is-visible":a.value,position:P(oe).Top,onMouseleave:r,onMouseover:u},{default:$e(()=>[m("button",{onClick:v[0]||(v[0]=g=>s("delete"))},[O(P(pt),{class:"icon"})]),m("button",{onClick:p},[O(P(Zo),{class:"icon edit-icon"})])]),_:1},8,["is-visible","position"]),O(P(bt),{position:P(oe).Left,type:"target"},null,8,["position"]),O(P(bt),{position:P(oe).Right,type:"source"},null,8,["position"])],32))}},mh=Oe(ph,[["__scopeId","data-v-92c1540a"]]),vh={class:"dynamic-blocks"},hh={class:"content"},gh={key:0},yh={key:1},_h={class:"save-as-section"},bh={class:"columns"},wh={class:"column"},Sh={class:"column"},xh=["onClick"],Ch={class:"connections-section"},$h={class:"connection-content"},Eh={class:"connection-btns"},kh={class:"move-btns"},Nh=["onClick","disabled"],Ih=["onClick","disabled"],Th=["onClick"],Mh={class:"btns"},Vh={class:"move-btns"},Dh=["onClick","disabled"],Bh=["onClick","disabled"],Ah=["onClick"],Oh={__name:"masterConnections",props:{botId:{type:String,required:!0},botInfo:{type:Object}},setup(e,{expose:t}){const n=e,o=Wn(),s=la(),a=jo(),i=q([]),l=q([]),r=Xe("nodes"),u=q(Array.from({length:(i==null?void 0:i.length)??0}).fill(!1)),c=J(()=>u.value.indexOf(!0)!==-1),d=async()=>{const D={search_type:"message",priority:i.value.length,code:null,request_id:null,variables:null,bot_id:n.botId,connections:[]},G=await a.createConnectionGroup(D);i.value.push({id:G.id,selectedOption:"message",textareaValue:"",inputValue:"",saveAsRows:[{left:"",right:""}],connections:[]})},p=async D=>{const G=i.value[D];if(!G.id){console.warn("Невозможно удалить группу без ID");return}await a.deleteConnectionGroup(G.id),i.value.splice(D,1)},f=D=>{D>0&&(u.value[D]=!0,u.value[D-1]=!0,[i.value[D-1],i.value[D]]=[i.value[D],i.value[D-1]])},v=D=>{D<i.value.length-1&&(u.value[D]=!0,u.value[D+1]=!0,[i.value[D+1],i.value[D]]=[i.value[D],i.value[D+1]])},g=D=>{var z;u.value[D]=!0;const G=((z=B.value[0])==null?void 0:z.value)||"";i.value[D].connections.push({type:G,rules:""})},y=(D,G)=>{u.value[D]=!0,i.value[D].connections.splice(G,1)},k=(D,G)=>{if(u.value[D]=!0,G>0){const z=i.value[D].connections;[z[G-1],z[G]]=[z[G],z[G-1]]}},E=(D,G)=>{if(u.value[D]=!0,G<i.value[D].connections.length-1){const z=i.value[D].connections;[z[G+1],z[G]]=[z[G],z[G+1]]}},h=D=>{u.value[D]=!0,i.value[D].saveAsRows.push({left:"",right:""})},I=[{value:"code",label:"Код"},{value:"response",label:"Request"},{value:"message",label:"Message"}],B=J(()=>r.value.map(D=>({value:D.id,label:D.data.name||`Узел ${D.id}`}))),H=async D=>{const G=i.value[D],z=G.saveAsRows.reduce((S,R)=>(R.left&&R.right&&(S[R.left]=R.right),S),{}),b=G.connections.map((S,R)=>({next_step_id:S.type,rules:S.rules||"",priority:R,filters:null})),V={id:G.id,search_type:G.selectedOption,priority:D,code:G.selectedOption==="code"?G.textareaValue:null,request_id:G.selectedOption==="response"?G.inputValue:null,variables:JSON.stringify(z),connections:b};u.value[D]=!1,await a.updateConnectionGroup(V.id,V),Be.success("Сохранено!")},F=async()=>{for(let D=0;D<i.value.length;D++)await H(D);u.value=u.value.fill(!1)},Y=async()=>{const D=await o.readBot(n.botId),G=(D==null?void 0:D.data.master_connection_groups)||[];G.length>0&&(i.value=G.map(z=>{const b=z.variables?JSON.parse(z.variables):{};return{id:z.id,selectedOption:z.search_type,textareaValue:z.code||"",inputValue:z.request_id||"",saveAsRows:Object.entries(b).map(([V,S])=>({left:V,right:S})),connections:z.connections.map(V=>({type:V.next_step_id,rules:V.rules||""}))}}))};return Ze(async()=>{Y(),await s.readRequests(),l.value=s.requests.map(D=>({value:D.id,label:D.name||`Реквест ${D.id}`}))}),t({isSomethingChanged:c,save:F}),(D,G)=>{const z=ge("BaseSelect"),b=ge("BaseCodeEditor"),V=ge("BaseInput"),S=ge("BaseButton");return _(),T("div",vh,[(_(!0),T(Ee,null,ze(i.value,(R,C)=>(_(),T("div",{key:C,class:"block"},[m("h3",null,"Группа связей № "+te(C+1),1),m("div",hh,[O(z,{modelValue:R.selectedOption,"onUpdate:modelValue":L=>R.selectedOption=L,options:I,label:"Тип поиска",class:"first-select",onInput:L=>u.value[C]=!0},null,8,["modelValue","onUpdate:modelValue","onInput"]),R.selectedOption==="code"?(_(),T("div",gh,[O(b,{label:"Код",labelColor:"rgb(30, 30, 30)",language:"python","is-collapsed":!1,"is-resizable":!1,"default-height":200,modelValue:R.textareaValue,"onUpdate:modelValue":L=>R.textareaValue=L,onInput:L=>u.value[C]=!0,class:"code-editor","light-theme":"",small:""},null,8,["modelValue","onUpdate:modelValue","onInput"])])):K("",!0),R.selectedOption==="response"?(_(),T("div",yh,[O(z,{modelValue:R.inputValue,"onUpdate:modelValue":[L=>R.inputValue=L,L=>c.value[C]=!0],options:l.value,label:"Запрос",labelColor:"rgb(30, 30, 30)"},null,8,["modelValue","onUpdate:modelValue","options"])])):K("",!0),m("div",_h,[G[0]||(G[0]=m("span",{class:"label"},"Сохранить как",-1)),m("div",bh,[m("div",wh,[(_(!0),T(Ee,null,ze(R.saveAsRows,(L,j)=>(_(),T("div",{key:j,class:"row"},[O(V,{modelValue:L.left,"onUpdate:modelValue":X=>L.left=X,label:"",placeholder:"Ключ",labelColor:"rgb(30, 30, 30)",onInput:X=>u.value[C]=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]))),128))]),m("div",Sh,[(_(!0),T(Ee,null,ze(R.saveAsRows,(L,j)=>(_(),T("div",{key:j,class:"row"},[O(V,{modelValue:L.right,"onUpdate:modelValue":X=>L.right=X,label:"",placeholder:"Значение",labelColor:"rgb(30, 30, 30)",onInput:X=>u.value[C]=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]))),128))])]),m("button",{onClick:L=>h(C)},"Добавить строку",8,xh)]),m("div",Ch,[(_(!0),T(Ee,null,ze(R.connections,(L,j)=>(_(),T("div",{key:j,class:"connection"},[m("h3",null,"Связь № "+te(j+1),1),m("div",$h,[O(z,{modelValue:L.type,"onUpdate:modelValue":X=>L.type=X,options:B.value,label:"Следующий шаг",class:"first-select",onInput:X=>u.value[C]=!0},null,8,["modelValue","onUpdate:modelValue","options","onInput"]),O(b,{label:"Правила",labelColor:"rgb(30, 30, 30)",language:"json","is-collapsed":!1,"is-resizable":!1,"default-height":100,modelValue:L.rules,"onUpdate:modelValue":X=>L.rules=X,onInput:X=>u.value[C]=!0,class:"code-editor","light-theme":"",small:""},null,8,["modelValue","onUpdate:modelValue","onInput"])]),m("div",Eh,[m("div",kh,[m("button",{onClick:X=>k(C,j),disabled:j===0},[O(P(Pn))],8,Nh),m("button",{onClick:X=>E(C,j),disabled:j===R.connections.length-1},[O(P(On))],8,Ih)]),m("button",{onClick:X=>y(C,j)},[O(P(pt),{class:"icon icon-trash"})],8,Th)])]))),128)),O(S,{styleType:"primary",size:"small",onClick:L=>g(C)},{default:$e(()=>G[1]||(G[1]=[Ce(" Добавить связь ")])),_:2},1032,["onClick"])])]),m("div",Mh,[m("div",Vh,[m("button",{onClick:L=>f(C),disabled:C===0},[O(P(Pn))],8,Dh),m("button",{onClick:L=>v(C),disabled:C===i.value.length-1},[O(P(On))],8,Bh)]),m("button",{onClick:L=>p(C)},[O(P(pt),{class:"icon icon-trash"})],8,Ah),O(S,{styleType:"primary",size:"small",onClick:L=>H(C)},{default:$e(()=>G[2]||(G[2]=[Ce("Сохранить")])),_:2},1032,["onClick"])])]))),128)),O(S,{styleType:"secondary",size:"small",onClick:d},{default:$e(()=>G[3]||(G[3]=[Ce(" Добавить группу связей ")])),_:1})])}}},Ph=Oe(Oh,[["__scopeId","data-v-44116de2"]]),zh={class:"bot-settings"},Rh={key:0,class:"error"},Uh={__name:"mainSettings",props:{botId:{type:String,required:!0},botInfo:{type:Object,default:()=>({})}},emits:["update:botInfo"],setup(e,{expose:t,emit:n}){var d,p,f,v;const o=e,s=n,a=q(!1),i=Wn(),l=q(""),r=q({name:((d=o.botInfo)==null?void 0:d.name)||"",variables:JSON.stringify(((p=o.botInfo)==null?void 0:p.variables.data)||{},null,2),first_step_id:((f=o.botInfo)==null?void 0:f.first_step_id)||null,config:JSON.stringify(((v=o.botInfo)==null?void 0:v.config)||{},null,2)}),u=J(()=>{var g;return((g=o.botInfo.steps)==null?void 0:g.map(y=>({value:y.id,label:y.name})))||[]}),c=async()=>{try{if(!r.value.name.trim())throw l.value="Название агента не может быть пустым.",new Error("Название агента не может быть пустым");let g={};try{g=JSON.parse(r.value.variables)}catch{throw l.value='Неверный формат JSON в поле "Переменные".',new Error('Неверный формат JSON в поле "Переменные".')}let y={};try{y=JSON.parse(r.value.config)}catch{throw l.value='Неверный формат JSON в поле "Конфиг".',new Error('Неверный формат JSON в поле "Конфиг".')}await i.updateBot(o.botId,{name:r.value.name,variables:{data:g},first_step_id:r.value.first_step_id,config:y}),Be.success("Сохранено!"),a.value=!1,s("update:botInfo",{...o.botInfo,name:r.value.name,variables:{data:g},first_step_id:r.value.first_step_id,config:y}),l.value=""}catch(g){throw Be.error("Ошибка!"),l.value=`Ошибка при сохранении данных агента. ${g.message}`,console.error("Ошибка при сохранении данных агента:",g),g}};return t({isSomethingChanged:a,trySave:c}),(g,y)=>{const k=ge("BaseInput"),E=ge("BaseCodeEditor"),h=ge("BaseSelectSearch"),I=ge("BaseButton");return _(),T("div",zh,[m("form",{class:"form",onSubmit:ft(c,["prevent"])},[O(k,{modelValue:r.value.name,"onUpdate:modelValue":y[0]||(y[0]=B=>r.value.name=B),label:"Название",required:"",onInput:y[1]||(y[1]=B=>a.value=!0)},null,8,["modelValue"]),O(E,{modelValue:r.value.variables,"onUpdate:modelValue":y[2]||(y[2]=B=>r.value.variables=B),"default-height":100,"is-collapsed":!1,"is-resizable":!1,class:"code-editor",label:"Переменные",language:"json","light-theme":"",small:"",onInput:y[3]||(y[3]=B=>a.value=!0)},null,8,["modelValue"]),O(E,{modelValue:r.value.config,"onUpdate:modelValue":y[4]||(y[4]=B=>r.value.config=B),"default-height":100,"is-collapsed":!1,"is-resizable":!1,class:"code-editor",label:"Конфиг",language:"json","light-theme":"",small:"",onInput:y[5]||(y[5]=B=>a.value=!0)},null,8,["modelValue"]),O(h,{modelValue:r.value.first_step_id,"onUpdate:modelValue":[y[6]||(y[6]=B=>r.value.first_step_id=B),y[7]||(y[7]=B=>a.value=!0)],options:u.value,label:"Первый шаг",labelColor:"#fff",placeholder:"Выберите первый шаг"},null,8,["modelValue","options"]),O(I,{size:"small",styleType:"secondary",type:"submit"},{default:$e(()=>y[8]||(y[8]=[Ce("Сохранить")])),_:1}),l.value?(_(),T("div",Rh,te(l.value),1)):K("",!0)],32)])}}},Lh=Oe(Uh,[["__scopeId","data-v-80a481b9"]]),Gh={class:"credentials-container"},Hh={key:0,class:"create-form"},Fh={class:"form-row"},Yh={class:"form-row"},qh={class:"form-row"},Xh={class:"form-row"},Wh={class:"scopes-container"},Zh={class:"form-row"},jh={class:"form-row create-button"},Kh={key:1,class:"credentials-list"},Jh={class:"credential-info"},Qh={key:0,class:"scopes-display"},eg=["title"],tg={key:1,class:"default-badge"},ng={class:"credential-actions"},og={key:2,class:"no-credentials"},sg=Ie({__name:"mainCredentials",props:{botId:{}},setup(e){const t=e,n=Zl(),o=q(!1),s=at({name:"",provider:"",strategy:"",scopes:[""],is_default:!1,payload:"{}"}),a=Gi(Hi,s),i=[{value:"google",label:"google"},{value:"amocrm",label:"amocrm"},{value:"yandex_cloud",label:"yandex_cloud"},{value:"yandex_id",label:"yandex_id"}],l=[{value:"service_account",label:"service_account"},{value:"oauth",label:"oauth"},{value:"api_key",label:"api_key"}],r=J(()=>n.credentials||[]),u=async()=>{const g=await n.readCredentials(t.botId);console.log("response",g)},c=()=>{s.scopes.push("")},d=g=>{s.scopes.length>1&&s.scopes.splice(g,1)},p=async()=>{try{let g={};try{g=JSON.parse(s.payload)}catch(k){console.error("Invalid JSON in payload:",k);return}const y={...s,bot_id:t.botId,payload:g,scopes:(s.scopes||[]).filter(k=>k&&k.trim()!=="")};await n.createCredential(t.botId,y),Object.assign(s,{name:"",provider:"",strategy:"",scopes:[""],is_default:!1,payload:"{}"}),a.value.$reset(),o.value=!1}catch(g){console.error("Error creating credential:",g)}},f=async g=>{await n.makeDefaultCredential(t.botId,g)},v=async g=>{confirm("Are you sure you want to delete this credential?")&&await n.deleteCredential(t.botId,g)};return Ze(()=>{u()}),(g,y)=>{const k=ge("BaseButton"),E=ge("BaseInput"),h=ge("BaseSelect"),I=ge("BaseCodeEditor");return _(),T("div",Gh,[y[14]||(y[14]=m("p",{class:"credentials-info"},"Credentials (учетные данные) - это безопасные токены и ключи для подключения к внешним сервисам. Данные хранятся в зашифрованном виде и безопасны для ввода.",-1)),O(k,{onClick:y[0]||(y[0]=B=>o.value=!o.value),size:"small",styleType:"secondary",class:"add-button"},{default:$e(()=>[Ce(te(o.value?"Отменить":"Добавить"),1)]),_:1}),o.value?(_(),T("div",Hh,[m("div",Fh,[O(E,{modelValue:s.name,"onUpdate:modelValue":y[1]||(y[1]=B=>s.name=B),label:"Название *",labelColor:"#FFFFFF",class:"dark"},null,8,["modelValue"])]),m("div",Yh,[O(h,{modelValue:s.provider,"onUpdate:modelValue":y[2]||(y[2]=B=>s.provider=B),label:"Провайдер *",labelColor:"#FFFFFF",options:i,class:"dark"},null,8,["modelValue"])]),m("div",qh,[O(h,{modelValue:s.strategy,"onUpdate:modelValue":y[3]||(y[3]=B=>s.strategy=B),label:"Стратегия *",labelColor:"#FFFFFF",options:l,class:"dark"},null,8,["modelValue"])]),m("div",Xh,[y[7]||(y[7]=m("label",{class:"scopes-label"},"Scopes (области доступа) *",-1)),m("div",Wh,[(_(!0),T(Ee,null,ze(s.scopes,(B,H)=>(_(),T("div",{key:H,class:"scope-item"},[O(E,{modelValue:s.scopes[H],"onUpdate:modelValue":F=>s.scopes[H]=F,placeholder:`Scope ${H+1}`,class:"dark"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),O(k,{onClick:ft(F=>d(H),["stop"]),size:"small",styleType:"danger"},{default:$e(()=>y[5]||(y[5]=[Ce(" × ")])),_:2},1032,["onClick"])]))),128)),O(k,{onClick:ft(c,["stop"]),size:"small",styleType:"secondary"},{default:$e(()=>y[6]||(y[6]=[Ce(" + Добавить ")])),_:1})])]),m("div",Zh,[O(I,{modelValue:s.payload,"onUpdate:modelValue":y[4]||(y[4]=B=>s.payload=B),label:"Payload (JSON) *",language:"json",isCollapsed:!1,isResizable:!1,defaultHeight:150},null,8,["modelValue"])]),m("div",jh,[O(k,{onClick:p,size:"small",styleType:"secondary",disabled:P(a).$invalid},{default:$e(()=>y[8]||(y[8]=[Ce(" Создать ")])),_:1},8,["disabled"])])])):K("",!0),r.value.length>0?(_(),T("div",Kh,[(_(!0),T(Ee,null,ze(r.value,B=>(_(),T("div",{key:B.id,class:He(["credential-item",{"is-default":B.is_default}])},[m("div",Jh,[m("h3",null,te(B.name),1),m("p",null,[y[9]||(y[9]=m("strong",null,"Provider:",-1)),Ce(" "+te(B.provider),1)]),m("p",null,[y[10]||(y[10]=m("strong",null,"Strategy:",-1)),Ce(" "+te(B.strategy),1)]),B.scopes&&B.scopes.length>0?(_(),T("p",Qh,[y[11]||(y[11]=m("strong",null,"Scopes: ",-1)),m("span",{class:"scopes-text",title:B.scopes.join(", ")},te(B.scopes.join(", ")),9,eg)])):K("",!0),B.is_default?(_(),T("span",tg,"Default")):K("",!0)]),m("div",ng,[B.is_default?K("",!0):(_(),me(k,{key:0,onClick:H=>f(B.id),size:"small",styleType:"secondary"},{default:$e(()=>y[12]||(y[12]=[Ce(" Сделать default ")])),_:2},1032,["onClick"])),O(k,{onClick:H=>v(B.id),size:"small",styleType:"danger"},{default:$e(()=>y[13]||(y[13]=[Ce(" x ")])),_:2},1032,["onClick"])])],2))),128))])):(_(),T("div",og," Учетные данные не найдены "))])}}}),ag=Oe(sg,[["__scopeId","data-v-ef787ef6"]]),ig={class:"logs-list"},lg={key:1,class:"logs-empty"},rg=Ie({__name:"mainLogs",props:{botId:{}},setup(e){const t=e,n=Zn(),o=q(null),s=J(()=>{var i;return((i=n.getBot(t.botId))==null?void 0:i.logs)??[]}),a=()=>{o.value&&(o.value.scrollTop=o.value.scrollHeight)};return Me(s,()=>{Fe(()=>{a()})},{deep:!0}),Ze(()=>{Fe(()=>{a()})}),(i,l)=>s.value.length?(_(),T("div",{key:0,ref_key:"logsContainer",ref:o,class:"logs-container"},[m("div",ig,[(_(!0),T(Ee,null,ze(s.value,(r,u)=>(_(),T("div",{key:u,class:"log-entry"},te(r),1))),128))])],512)):(_(),T("div",lg,"В данный момент журнал пуст"))}}),ug=Oe(rg,[["__scopeId","data-v-fa1cb0b8"]]),cg=Ie({__name:"masterPanel",props:{botId:{},botInfo:{}},emits:["action"],setup(e,{expose:t,emit:n}){const o=[{name:"main",label:"Основное"},{name:"masterConnections",label:"Мастер-связи"},{name:"credentials",label:"Креды"},{name:"logs",label:"Журнал"}],s=n,a={main:qe("main"),masterConnections:qe("masterConnections"),credentials:qe("credentials"),logs:qe("logs")},i=async(r,u)=>{let c=null;const d=a[r].value;if(d!=null&&d.isSomethingChanged&&window.confirm("Хотите сохранить изменения?"))if(d!=null&&d.trySave)try{await(d==null?void 0:d.trySave()),l.value=u}catch(p){c=p,console.error("Error saving tab:",p)}else await d.save();c||(l.value=u)};t({save:()=>i(l.value,"main")});const l=q(o[0].name);return(r,u)=>{const c=ge("BasePanelTabs");return _(),me(c,{tabs:o,"active-tab":l.value,onTabChange:i},{default:$e(()=>[l.value==="main"?(_(),me(Lh,{key:0,ref:"main",botId:r.botId,botInfo:r.botInfo,"onUpdate:botInfo":u[0]||(u[0]=d=>s("action",{action:"masterUpdate",data:d}))},null,8,["botId","botInfo"])):K("",!0),l.value==="masterConnections"?(_(),me(Ph,{key:1,ref:"masterConnections",botId:r.botId,botInfo:r.botInfo},null,8,["botId","botInfo"])):K("",!0),l.value==="credentials"?(_(),me(ag,{key:2,ref:"credentials",botId:r.botId},null,8,["botId"])):K("",!0),l.value==="logs"?(_(),me(ug,{key:3,ref:"logs",botId:r.botId},null,8,["botId"])):K("",!0)]),_:1},8,["active-tab"])}}}),dg={class:"mcp-assistant"},fg={class:"panel"},pg={class:"panel-header"},mg=["disabled"],vg=["disabled"],hg={key:0,class:"error-text"},gg={class:"actions"},yg=["disabled"],_g={key:1},bg={key:2},wg=["disabled"],Sg={key:1},xg={key:2},Cg=["disabled"],$g={key:0,class:"panel"},Eg={class:"panel-header"},kg={key:0,class:"meta"},Ng={key:0,class:"plan-loading"},Ig={key:1,class:"error-card"},Tg={key:2},Mg={key:0,class:"plan-steps"},Vg={class:"badge"},Dg={class:"plan-text"},Bg={key:0,class:"plan-list"},Ag={key:1,class:"plan-notes"},Og={key:1,class:"empty-hint"},Pg={key:2,class:"missing-block"},zg={class:"chip-list"},Rg={key:3,class:"suggestion"},Ug={class:"suggestion-header"},Lg={class:"suggestion-actions"},Gg={readonly:"",rows:"3"},Hg={key:1,class:"panel"},Fg={class:"panel-header"},Yg={class:"meta"},qg={key:0,class:"result-block"},Xg={class:"result-header"},Wg={key:1,class:"tool-history"},Zg=["open"],jg={class:"tool-block"},Kg={class:"tool-block"},Jg={key:2,class:"error-card"},Qg=Ie({__name:"autonomousAssistant",props:{botId:{}},setup(e){const t=e,n=jl(),o=q(""),s=q("{}"),a=q(""),i=J(()=>n.plan),l=J(()=>n.planLoading),r=J(()=>n.planError),u=J(()=>{var b;return((b=i.value)==null?void 0:b.steps)??[]}),c=J(()=>{var b;return((b=i.value)==null?void 0:b.missing_data)??[]}),d=J(()=>{var b;return((b=i.value)==null?void 0:b.prompt_suggestion)??""}),p=q(null),f=J(()=>p.value?n.getSession(p.value):void 0),v=J(()=>p.value?n.isSessionActive(p.value):!1),g=J(()=>p.value?n.getToolHistory(p.value):[]),y=J(()=>{var b;return((b=f.value)==null?void 0:b.outputText)??""}),k=J(()=>{var b;return((b=f.value)==null?void 0:b.status)??"idle"}),E=J(()=>{switch(k.value){case"generating":return"в работе";case"completed":return"готово";case"error":return"ошибка";default:return"ожидает"}});function h(){a.value="";const b=s.value.trim();if(!b)return{};try{return JSON.parse(b)}catch(V){throw a.value="Некорректный JSON",V}}async function I(){try{const b=h();await n.generatePlan(o.value,t.botId,b),Be.success("План обновлён")}catch(b){a.value?Be.error("Исправьте JSON контекста"):Be.error((b==null?void 0:b.message)||"Не удалось построить план")}}async function B(){try{const b=h();p.value||(p.value=n.createSession(t.botId??"",o.value,b)),await n.generateBot(p.value,o.value,t.botId,b),Be.success("Генерация завершена")}catch(b){a.value?Be.error("Исправьте JSON контекста"):Be.error((b==null?void 0:b.message)||"Генерация завершилась с ошибкой")}}function H(){d.value&&(o.value=d.value,Be.success("Промпт обновлён из плана"))}async function F(){if(d.value)try{await navigator.clipboard.writeText(d.value),Be.success("Промпт скопирован")}catch{Be.error("Не удалось скопировать текст")}}async function Y(){if(y.value)try{await navigator.clipboard.writeText(y.value),Be.success("Ответ скопирован")}catch{Be.error("Не удалось скопировать текст")}}function D(){o.value="",s.value="{}",a.value="",n.clearPlan(),p.value&&(n.removeSession(p.value),p.value=null)}function G(b){try{return new Date(b).toLocaleString()}catch{return b}}function z(b){return JSON.stringify(b,null,2)}return(b,V)=>{var S,R;return _(),T("div",dg,[m("section",fg,[m("div",pg,[V[2]||(V[2]=m("h3",null,"Автоматическая генерация сценария",-1)),m("span",{class:He(["status-pill",k.value])},te(E.value),3)]),V[3]||(V[3]=m("label",{class:"field-label",for:"prompt-input"},"Описание задачи",-1)),An(m("textarea",{id:"prompt-input","onUpdate:modelValue":V[0]||(V[0]=C=>o.value=C),disabled:v.value,rows:"4",placeholder:"Опиши, какие шаги нужно построить"},null,8,mg),[[Io,o.value]]),V[4]||(V[4]=m("label",{class:"field-label",for:"context-input"},"Контекст (JSON, необязательно)",-1)),An(m("textarea",{id:"context-input","onUpdate:modelValue":V[1]||(V[1]=C=>s.value=C),disabled:v.value,rows:"3",placeholder:'{"session.telegram_chat_id": "123", "bot.news_api_key": "..."}'},null,8,vg),[[Io,s.value]]),a.value?(_(),T("p",hg,te(a.value),1)):K("",!0),m("div",gg,[m("button",{type:"button",class:"primary",disabled:v.value||!o.value.trim(),onClick:I},[l.value?(_(),me(P(mo),{key:0,class:"inline-spinner"})):K("",!0),l.value?(_(),T("span",_g,"Формируем план…")):(_(),T("span",bg,"Сформировать план"))],8,yg),m("button",{type:"button",class:"secondary",disabled:v.value||!o.value.trim(),onClick:B},[v.value?(_(),me(P(mo),{key:0,class:"inline-spinner"})):K("",!0),v.value?(_(),T("span",Sg,"Запуск…")):(_(),T("span",xg,"Запустить генерацию"))],8,wg),m("button",{type:"button",class:"ghost",disabled:v.value,onClick:D}," Сбросить ",8,Cg)])]),l.value||i.value||r.value?(_(),T("section",$g,[m("div",Eg,[V[5]||(V[5]=m("h4",null,"Предварительный план",-1)),i.value?(_(),T("span",kg,"Шагов: "+te(u.value.length),1)):K("",!0)]),l.value?(_(),T("div",Ng,[O(P(mo),{class:"inline-spinner"}),V[6]||(V[6]=m("span",null,"Готовим последовательность действий…",-1))])):r.value?(_(),T("div",Ig,te(r.value),1)):i.value?(_(),T("div",Tg,[u.value.length?(_(),T("div",Mg,[(_(!0),T(Ee,null,ze(u.value,(C,L)=>{var j;return _(),T("article",{key:L,class:"plan-step"},[m("header",null,[m("span",Vg,"Шаг "+te(L+1),1),m("h5",null,te(C.name),1)]),m("p",Dg,te(C.action),1),(j=C.required_data)!=null&&j.length?(_(),T("ul",Bg,[(_(!0),T(Ee,null,ze(C.required_data,X=>(_(),T("li",{key:X},te(X),1))),128))])):K("",!0),C.notes?(_(),T("p",Ag,te(C.notes),1)):K("",!0)])}),128))])):(_(),T("p",Og,"План пуст — уточните запрос или контекст.")),c.value.length?(_(),T("div",Pg,[V[7]||(V[7]=m("h5",null,"Желательно уточнить:",-1)),m("div",zg,[(_(!0),T(Ee,null,ze(c.value,C=>(_(),T("span",{key:C,class:"chip"},te(C),1))),128))])])):K("",!0),d.value?(_(),T("div",Rg,[m("div",Ug,[V[8]||(V[8]=m("h5",null,"Предложенный промпт",-1)),m("div",Lg,[m("button",{class:"ghost",onClick:H},"Вставить"),m("button",{class:"ghost",onClick:F},[O(P(zn))])])]),m("textarea",Gg,te(d.value),1)])):K("",!0)])):K("",!0)])):K("",!0),f.value?(_(),T("section",Hg,[m("div",Fg,[V[9]||(V[9]=m("h4",null,"Результат генерации",-1)),m("span",Yg,te((S=f.value)!=null&&S.completedAt?G(f.value.completedAt):"в процессе"),1)]),y.value?(_(),T("div",qg,[m("div",Xg,[V[11]||(V[11]=m("span",null,"Ответ ассистента",-1)),m("button",{class:"ghost",onClick:Y},[O(P(zn)),V[10]||(V[10]=Ce("Скопировать"))])]),m("pre",null,te(y.value),1)])):K("",!0),g.value.length?(_(),T("div",Wg,[V[14]||(V[14]=m("h5",null,"Вызовы инструментов",-1)),(_(!0),T(Ee,null,ze(g.value,(C,L)=>(_(),T("details",{key:L,open:L===g.value.length-1},[m("summary",null,[m("span",null,te(C.tool),1),m("span",{class:He(["tool-status",C.success?"success":"failed"])},te(C.success?"успех":"ошибка")+" · "+te(G(C.timestamp)),3)]),m("div",jg,[V[12]||(V[12]=m("strong",null,"Аргументы",-1)),m("pre",null,te(z(C.arguments)),1)]),m("div",Kg,[V[13]||(V[13]=m("strong",null,"Результат",-1)),m("pre",null,te(z(C.result)),1)])],8,Zg))),128))])):K("",!0),(R=f.value)!=null&&R.error?(_(),T("div",Jg,te(f.value.error),1)):K("",!0)])):K("",!0)])}}}),ey=Oe(Qg,[["__scopeId","data-v-978cc16e"]]),ty={class:"mcp-drawer"},ny=Ie({__name:"mcpPrompt",props:{botId:{}},setup(e){return(t,n)=>(_(),T("div",ty,[O(ey,{"bot-id":t.botId},null,8,["bot-id"])]))}}),oy=Oe(ny,[["__scopeId","data-v-b8d4b376"]]),sy={class:"aside"},ay={class:"btns-block"},iy={class:"import-export-block"},ly={class:"bot-name-block"},ry={class:"overflow"},uy=["onClick"],cy={class:"import-modal-body"},dy={__name:"asidePanel",props:{nodes:{type:Array,required:!0},botId:{type:String,required:!0},botInfo:{type:Object}},setup(e,{expose:t}){ia(F=>({"9a3439da":s.value}));const n=e,o=qe("resize-bar"),s=J(()=>{var F;return(F=o.value)==null?void 0:F.width});t({width:s});const{setDrawer:a,setProps:i}=Xe("drawer"),l=Wn(),r=q(!1),u=q(),c=F=>{a({simple:co,emitter:us}[F.type]),i({node:F,botId:n.botId})},d=()=>{a(cg),i({botId:n.botId,botInfo:n.botInfo})},p=()=>{a(oy),i({botId:n.botId})},f=Ti(),v=J(()=>n.nodes.filter(F=>{var Y;return(Y=F.data)==null?void 0:Y.name})),g=()=>{f.push("/bots")},y=()=>{navigator.clipboard.writeText(n.botId||"")},k=async()=>{var F,Y;try{await l.exportBot(n.botId)&&Be.success("Bot exported successfully")}catch(D){const G=((Y=(F=D==null?void 0:D.response)==null?void 0:F.data)==null?void 0:Y.detail)||(D==null?void 0:D.message)||"Ошибка при экспорте бота";Be.error(G)}},E=()=>{r.value=!0},h=()=>{var F;r.value=!1,(F=u.value)==null||F.clearFile()},I=async F=>{try{await u.value.importBot(n.botId),h();const Y=Xe("refreshBotData");Y&&await Y()}catch(Y){console.error("Import error:",Y)}},B=F=>{Be.success("Структура бота успешно обновлена!");const Y=Xe("refreshBotData");Y&&Y()},H=F=>{console.error("Import error:",F)};return(F,Y)=>{var G;const D=ge("BaseResizeBar");return _(),T("div",sy,[O(D,{ref:"resize-bar","init-value":300,max:500,min:200,position:"right"},null,512),m("div",ay,[m("button",{onClick:g},Y[1]||(Y[1]=[m("i",{class:"fa-solid fa-arrow-left"},null,-1),Ce(" Назад ")])),m("button",{onClick:p},Y[2]||(Y[2]=[m("i",{class:"fa-solid fa-robot"},null,-1),Ce(" MCP ")])),m("button",{onClick:d},[O(P(Dl),{class:"settings-icon"})])]),m("div",iy,[m("button",{onClick:k,class:"export-btn",title:"Экспорт бота"},[O(P(Ui),{class:"icon"}),Y[3]||(Y[3]=Ce(" Экспорт "))]),m("button",{onClick:E,class:"import-btn",title:"Импорт структуры"},Y[4]||(Y[4]=[m("i",{class:"fa-solid fa-upload"},null,-1),Ce(" Импорт ")]))]),m("div",ly,[m("h3",{style:{cursor:"pointer"},onClick:d},te(((G=n.botInfo)==null?void 0:G.name)||""),1),m("i",{class:"fa-solid fa-copy copy-icon",onClick:y})]),m("div",ry,[m("ul",null,[(_(!0),T(Ee,null,ze(v.value,z=>(_(),T("li",{key:z.id,class:"step-item",onClick:b=>c(z)},te(z.data.name),9,uy))),128))])]),r.value?(_(),T("div",{key:0,class:"import-modal-overlay",onClick:h},[m("div",{class:"import-modal-content",onClick:Y[0]||(Y[0]=ft(()=>{},["stop"]))},[m("div",{class:"import-modal-header"},[Y[6]||(Y[6]=m("h3",null,"Импорт структуры бота",-1)),m("button",{onClick:h,class:"close-btn"},Y[5]||(Y[5]=[m("i",{class:"fa-solid fa-times"},null,-1)]))]),m("div",cy,[O(Li,{ref_key:"importDropzone",ref:u,onFileSelected:I,onImportSuccess:B,onImportError:H},null,512)])])])):K("",!0)])}}},fy=Oe(dy,[["__scopeId","data-v-dcb3f586"]]),py={class:"custom-table-cell expanded-value"},my={key:1},vy={class:"custom-table-cell simple-value"},gi={__name:"RowViewer",props:{k:{type:[String,Number],required:!0},val:{type:[Object,Array,String,Number,Boolean,null],required:!0},depth:{type:Number,required:!0}},setup(e){const t=q(!1),n=()=>{t.value=!t.value},o=a=>a!==null&&typeof a=="object",s=a=>typeof a=="number"?`[${a}]`:a;return(a,i)=>o(e.val)?(_(),T(Ee,{key:0},[m("tr",null,[m("td",{style:ot({paddingLeft:`${e.depth*60}px`}),class:"custom-table-cell expanded-key"},[m("button",{onClick:n,class:"toggle-button"},te(t.value?"−":"+"),1),Ce(" "+te(e.k),1)],4),m("td",py,te(Array.isArray(e.val)?"[Array]":"{Object}"),1)]),t.value?(_(!0),T(Ee,{key:0},ze(e.val,(l,r)=>(_(),me(gi,{key:`${e.depth}-${e.k}-${r}`,k:s(r),val:l,depth:e.depth+1},null,8,["k","val","depth"]))),128)):K("",!0)],64)):(_(),T("tr",my,[m("td",{style:ot({paddingLeft:`${e.depth*60}px`}),class:"custom-table-cell simple-key"},te(e.k),5),m("td",vy,te(e.val),1)]))}},hy={class:"panel-title"},gy={class:"toggle-button"},yy={key:0,class:"panel-content"},_y={class:"custom-table"},by=Ie({__name:"variableViewer",props:{botId:{}},setup(e){const t=e,n=Zn(),o=q(!1),s=J(()=>n.getBot(t.botId)??{}),a=J(()=>s.value.variables??{}),i=J(()=>Object.keys(a.value).length);return(l,r)=>(_(),T("div",{class:He(["bot-panel",o.value?"expanded":"collapsed"]),style:ot({width:o.value?"450px":"291px",height:o.value?"100vh":"auto"})},[m("div",{class:"panel-header",onClick:r[0]||(r[0]=u=>o.value=!o.value)},[m("h2",hy,[r[1]||(r[1]=Ce(" Переменные ")),m("span",null,"("+te(i.value)+")",1)]),m("button",gy,[o.value?(_(),me(P(Fi),{key:0})):(_(),me(P(ra),{key:1}))])]),o.value?(_(),T("div",yy,[m("table",_y,[m("tbody",null,[(_(!0),T(Ee,null,ze(a.value,(u,c)=>(_(),me(gi,{key:c,k:c,val:u,depth:0},null,8,["k","val"]))),128))])])])):K("",!0)],6))}}),wy=Oe(by,[["__scopeId","data-v-4090494d"]]),We=[];for(let e=0;e<256;++e)We.push((e+256).toString(16).slice(1));function Sy(e,t=0){return(We[e[t+0]]+We[e[t+1]]+We[e[t+2]]+We[e[t+3]]+"-"+We[e[t+4]]+We[e[t+5]]+"-"+We[e[t+6]]+We[e[t+7]]+"-"+We[e[t+8]]+We[e[t+9]]+"-"+We[e[t+10]]+We[e[t+11]]+We[e[t+12]]+We[e[t+13]]+We[e[t+14]]+We[e[t+15]]).toLowerCase()}let No;const xy=new Uint8Array(16);function Cy(){if(!No){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");No=crypto.getRandomValues.bind(crypto)}return No(xy)}const $y=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ta={randomUUID:$y};function Ey(e,t,n){var s;if(ta.randomUUID&&!e)return ta.randomUUID();e=e||{};const o=e.random??((s=e.rng)==null?void 0:s.call(e))??Cy();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,Sy(o)}const ky={class:"buttons-panel"},Ny={class:"text-btn"},Iy={class:"templates-dropdown"},Ty={key:0,class:"dropdown-content"},My=["onClick"],Vy={__name:"buttonsPanel",props:{templateGroupsInfo:{type:Array,default:()=>[]}},emits:["add-node","select-template-group"],setup(e,{emit:t}){const n=t,o=e,s=q(!1),a=J(()=>o.templateGroupsInfo.filter(d=>d.templates&&d.templates.length>0)),i=()=>{s.value=!s.value},l=d=>{n("select-template-group",d),s.value=!1},r=()=>{n("select-template-group",{id:"other",name:"Другие",templates:[]}),s.value=!1},u=d=>{const p=c(d);n("add-node",{type:d,name:p})},c=d=>{const p=Ey(),f=Date.now().toString().slice(-4);switch(d){case"simple":return`Новый шаг ${p}`;case"emitter":return`Эмиттер ${f}`;case"note":return`Заметка ${p}`;default:return"Новый блок"}};return(d,p)=>(_(),T("div",ky,[m("button",{onClick:p[0]||(p[0]=f=>u("simple"))},[m("div",Ny,[O(P(ol),{class:"icon"}),p[3]||(p[3]=m("span",null,"Блок",-1))])]),m("div",Iy,[m("button",{onClick:i,class:He(["dropdown-toggle",{active:s.value}])},[m("i",{class:He(["fas fa-chevron-up chevron-icon",{rotated:s.value}])},null,2)],2),s.value?(_(),T("div",Ty,[(_(!0),T(Ee,null,ze(a.value,f=>(_(),T("button",{key:f.id,onClick:v=>l(f),class:"group-item"},te(f.name),9,My))),128)),m("button",{onClick:r,class:"group-item"},"Другие")])):K("",!0)]),m("button",{onClick:p[1]||(p[1]=f=>u("emitter"))},[O(P(il),{class:"icon"})]),m("button",{onClick:p[2]||(p[2]=f=>u("note"))},[O(P(ul),{class:"icon"})])]))}},Dy=Oe(Vy,[["__scopeId","data-v-d6ba1d9d"]]),By={class:"chat-tabs-header"},Ay={class:"header-actions"},Oy={class:"chat-content"},Py={key:1,class:"no-channel-selected"},zy={__name:"ChatTabs",props:{channels:{type:Array,required:!0,default:()=>[]}},emits:["close"],setup(e,{emit:t}){const n=e,o=t,s=q(null),a=q(!1);n.channels.length>0&&!s.value&&(s.value=n.channels[0].id);const i=J(()=>n.channels.map(p=>({name:p.id,label:r(p.name)}))),l=J(()=>n.channels.find(p=>p.id===s.value)),r=p=>p.length>15?p.substring(0,12)+"...":p,u=(p,f)=>{s.value=f},c=()=>{a.value=!a.value},d=()=>{o("close")};return(p,f)=>(_(),T("div",{class:He(["chat-tabs-container",{expanded:a.value}])},[m("div",By,[O(Mi,{tabs:i.value,"active-tab":s.value,onTabChange:u},null,8,["tabs","active-tab"]),m("div",Ay,[m("button",{onClick:c,class:"expand-button"},[m("i",{class:He(a.value?"fas fa-compress":"fas fa-expand")},null,2)]),m("button",{onClick:d,class:"close-button"},f[0]||(f[0]=[m("i",{class:"fas fa-times"},null,-1)]))])]),m("div",Oy,[l.value?(_(),me(zi,{key:0,channel:l.value,"show-actions":!1},null,8,["channel"])):(_(),T("div",Py,f[1]||(f[1]=[m("p",null,"Выберите канал для общения",-1)])))])],2))}},Ry=Oe(zy,[["__scopeId","data-v-1c6277a3"]]),Uy={class:"templates-modal-content"},Ly={class:"group-header"},Gy={class:"header-actions"},Hy={class:"search-container"},Fy={class:"modal-content"},Yy={key:0,class:"loading"},qy={key:1,class:"empty-state"},Xy={key:2,class:"templates-list"},Wy=["onClick","onDragstart"],Zy={class:"template-main"},jy={class:"template-name"},Ky={class:"template-steps-count"},Jy={__name:"TemplatesModal",props:{group:{type:Object,required:!0},botId:{type:String,required:!0},show:{type:Boolean,required:!0},nodes:{type:Array,default:()=>[]}},emits:["close","action"],setup(e,{emit:t}){const n=e,o=Yi(),s=q(!1),a=q(!1),i=q(null),l=q([]),r=q(!1);q(!1);const u=q(null),c=q(""),d=J(()=>{if(!c.value)return l.value;const H=c.value.toLowerCase();return l.value.filter(F=>F.name.toLowerCase().includes(H))}),p=J(()=>{var H;return(H=n.group)==null?void 0:H.name}),f=J(()=>n.nodes.filter(H=>H.type==="simple").map(H=>({id:H.id,name:H.data.name}))),v=H=>{H.id==="other"?g():l.value=H.templates||[]},g=async()=>{s.value=!0,await o.readTemplates(),l.value=o.templates,s.value=!1},y=(H,F)=>{H.dataTransfer.setData("application/json",JSON.stringify({type:"template",template:F})),H.dataTransfer.effectAllowed="copy"};function k(H){u.value=H,r.value=!0}const E=()=>{r.value=!1,u.value=null},h=()=>{i.value=null,a.value=!0},I=()=>{a.value=!1,i.value=null},B=async H=>{i.value?await o.updateTemplate(i.value.id,H):await o.createTemplate(H),I(),v(n.group)};return Ze(()=>{v(n.group)}),(H,F)=>{var G;const Y=ge("BaseInput"),D=ge("BaseLoader");return _(),T(Ee,null,[m("div",Uy,[m("div",Ly,[m("h3",null,te(p.value),1),m("div",Gy,[((G=e.group)==null?void 0:G.id)=="other"?(_(),T("button",{key:0,class:"create-btn",onClick:h},F[1]||(F[1]=[m("i",{class:"fas fa-plus"},null,-1),Ce(" Создать ")]))):K("",!0)])]),m("div",Hy,[O(Y,{modelValue:c.value,"onUpdate:modelValue":F[0]||(F[0]=z=>c.value=z),class:"dark",placeholder:"Поиск"},null,8,["modelValue"])]),m("div",Fy,[s.value?(_(),T("div",Yy,[O(D)])):l.value.length===0?(_(),T("div",qy,"Нет шаблонов в этой группе")):(_(),T("ul",Xy,[(_(!0),T(Ee,null,ze(d.value,z=>{var b;return _(),T("li",{key:z.id,class:"template-item",draggable:"true",onClick:V=>k(z),onDragstart:V=>y(V,z)},[m("div",Zy,[m("span",jy,te(z.name),1),m("div",Ky,"Шагов: "+te(((b=z.steps)==null?void 0:b.length)??0),1)])],40,Wy)}),128))]))])]),a.value?(_(),me(qi,{key:0,botId:e.botId,steps:f.value,initial:i.value,onClose:I,onSave:B},null,8,["botId","steps","initial"])):K("",!0),r.value&&u.value?(_(),me(Xi,{key:1,template:u.value,onClose:E},null,8,["template"])):K("",!0)],64)}}},Qy=Oe(Jy,[["__scopeId","data-v-2c7902c7"]]),e_={class:"flex-div"},t_={class:"buttons"},n_=Ie({__name:"controlPanel",props:{asideWidth:{}},emits:["action"],setup(e,{emit:t}){ia(f=>({"541755b5":f.asideWidth}));const{setDrawer:n,drawerRef:o,drawerProps:s}=Xe("drawer"),a=q(!1),i=q(!1),l=t,r=J(()=>{var v,g;const f=(g=(v=o.value)==null?void 0:v.$options)==null?void 0:g.__name;return f==="McpPrompt"||f==="AutonomousAssistant"}),u=async()=>{var f,v;!((f=s.value)!=null&&f.group)&&((v=o.value)!=null&&v.save)&&typeof o.value.save=="function"&&await o.value.save(),n(null)},c=()=>{i.value&&!r.value&&u()},d=()=>{var f;if((f=s.value)!=null&&f.node){const v=s.value.node;window.confirm("Вы уверены, что хотите удалить этот узел?")&&(l("action",{action:"delete",data:{id:v.id,type:v.type}}),u())}};Ze(()=>{setTimeout(()=>{i.value=!0},100)});const p=()=>{var f,v,g,y,k,E,h,I,B,H,F;return(f=s.value)!=null&&f.group?"Шаблоны":((g=(v=s.value)==null?void 0:v.node)==null?void 0:g.type)==="simple"?"Редактирование шага":((k=(y=s.value)==null?void 0:y.node)==null?void 0:k.type)==="emitter"?"Редактирование эмиттера":((h=(E=s.value)==null?void 0:E.node)==null?void 0:h.type)==="template-instance"?"Редактирование шаблона":(I=s.value)!=null&&I.botId&&((H=(B=o.value)==null?void 0:B.$options)==null?void 0:H.__name)==="McpPrompt"?"MCP Builder":(F=s.value)!=null&&F.botId?"Редактирование бота":"Редактирование"};return(f,v)=>{var y,k,E,h;const g=Vi("click-outside");return An((_(),T("div",{class:He([a.value?"full-screen":"","settings-drawer"])},[m("div",e_,[m("h3",null,te(p()),1),m("div",t_,[((k=(y=P(s))==null?void 0:y.node)==null?void 0:k.type)==="emitter"||((h=(E=P(s))==null?void 0:E.node)==null?void 0:h.type)==="simple"?(_(),T("button",{key:0,onClick:d},[O(P(pt),{class:"icon"})])):K("",!0),m("button",{onClick:v[0]||(v[0]=I=>a.value=!a.value)},[O(P(ra))]),m("button",{onClick:u},[O(P(ji))])])]),nt(f.$slots,"default",{},void 0,!0)],2)),[[g,c]])}}}),o_=Oe(n_,[["__scopeId","data-v-74c3a2b5"]]),s_=Ie({__name:"customEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{}},setup(e){const t=e;function n({sourceX:a,sourceY:i,targetX:l,targetY:r,curvature:u=.5}){let c=Math.abs(l-a)*u;c<100&&(c=100*u);let d=r-i;a>l&&Math.abs(d)<100&&a-l>250?d=100*u*(d<0?1:-1):d=0;const p={x:a+c,y:i+d},f={x:l-c,y:r+d},v=`M${a},${i} C${p.x},${p.y} ${f.x},${f.y} ${l},${r}`,g=(a+l)/2,y=(i+r)/2;return[v,g,y]}const o=J(()=>n({...t,sourceX:t.sourceX,targetX:t.targetX,curvature:.7})),s=J(()=>o.value[0]);return(a,i)=>(_(),me(P(gn),Ft({path:s.value},t),null,16,["path"]))}}),a_={class:"mapping-builder"},i_={class:"mapping-table"},l_=["title"],r_={key:0},u_={colspan:"6",class:"nested"},c_=Object.assign({name:"MappingBuilder"},{__name:"MappingBuilder",props:{modelValue:{type:Array,default:()=>[]},parentPath:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,o=t,s=q(n.modelValue.map(i=>({...i,id:i.id||Wi(),value:i.value??""})));Me(s,i=>{o("update:modelValue",i)},{deep:!0});function a(i){return n.parentPath?`${n.parentPath}.${i.name}`:i.name}return(i,l)=>{const r=ge("BaseCheckbox"),u=ge("BaseInput");return _(),T("div",a_,[m("table",i_,[l[0]||(l[0]=m("thead",null,[m("tr",null,[m("th",null,"name"),m("th",null,"type"),m("th",null,"required"),m("th",null,"description"),m("th",null,"default"),m("th",null,"path")])],-1)),m("tbody",null,[(_(!0),T(Ee,null,ze(s.value,(c,d)=>(_(),T(Ee,{key:c.id},[m("tr",null,[m("td",null,te(c.name),1),m("td",null,te(c.type),1),m("td",null,[O(r,{modelValue:c.required,"onUpdate:modelValue":p=>c.required=p,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),m("td",{class:"description-cell",title:c.description},te(c.description),9,l_),m("td",null,[c.type!=="object"?(_(),me(u,{key:0,modelValue:c.default,"onUpdate:modelValue":p=>c.default=p,class:"dark"},null,8,["modelValue","onUpdate:modelValue"])):K("",!0)]),m("td",null,[c.type!=="object"?(_(),me(u,{key:0,modelValue:c.value,"onUpdate:modelValue":p=>c.value=p,class:"dark"},null,8,["modelValue","onUpdate:modelValue"])):K("",!0)])]),c.type==="object"?(_(),T("tr",r_,[m("td",u_,[O(Yo,{modelValue:c.properties,"onUpdate:modelValue":p=>c.properties=p,parentPath:a(c)},null,8,["modelValue","onUpdate:modelValue","parentPath"])])])):K("",!0)],64))),128))])])])}}}),Yo=Oe(c_,[["__scopeId","data-v-bc427cfb"]]),d_={class:"modal"},f_={class:"modal-head"},p_={class:"modal-title"},m_={class:"form-group id-group"},v_={class:"form-group"},h_={class:"form-group"},g_={class:"form-group"},y_={key:0,class:"error"},__={__name:"templateInstanceModal",props:{template:{type:Object,required:!0},botId:{type:String,required:!0}},emits:["close","save"],setup(e,{emit:t}){const n=e,o=t,s=q({variablesJson:"{}"}),a=q(""),i=q(d(n.template.inputs)),l=q(d(n.template.outputs));Ze(()=>{n.template&&(s.value.variablesJson=JSON.stringify(n.template.variables||{},null,2))}),Me(()=>n.template,p=>{p&&(s.value.variablesJson=JSON.stringify(p.variables||{},null,2),i.value=d(p.inputs),l.value=d(p.outputs))},{immediate:!0});function r(){o("close")}function u(p,f=""){const v={};for(const g of p){const y=g.value&&g.value.trim()!==""?g.value:null;g.type==="object"?v[g.name]=u(g.properties,y):v[g.name]={path:y,default:g.default,value:g.value}}return v}function c(){a.value="";let p;try{p=JSON.parse(s.value.variablesJson||"{}")}catch{a.value="Variables должны быть валидным JSON";return}o("save",{template_id:n.template.id,inputs_mapping:u(i.value),outputs_mapping:u(l.value),variables:p,bot_id:n.botId})}function d(p){return!p||!p.properties?[]:Object.entries(p.properties).map(([f,v])=>{const g={id:f+"-"+Math.random().toString(36).slice(2,8),name:f,type:v.type,required:Array.isArray(p.required)?p.required.includes(f):!1,default:v.default??"",description:v.description??"",properties:[]};return v.type==="object"&&(g.properties=d(v)),g})}return(p,f)=>{var y;const v=ge("BaseCopyableId"),g=ge("BaseCodeEditor");return _(),T("div",{class:"modal-overlay",onClick:ft(r,["self"])},[m("div",d_,[m("div",f_,[m("div",p_,"Создать инстанс шаблона: "+te((y=e.template)==null?void 0:y.name),1),m("button",{class:"modal-close",onClick:r},"×")]),m("div",m_,[f[3]||(f[3]=m("label",null,"ID шаблона:",-1)),O(v,{id:e.template.id},null,8,["id"])]),m("form",{onSubmit:ft(c,["prevent"])},[m("div",v_,[O(g,{"default-height":100,"is-collapsed":!1,"is-resizable":!1,modelValue:s.value.variablesJson,"onUpdate:modelValue":f[0]||(f[0]=k=>s.value.variablesJson=k),label:"Variables (JSON)",language:"json",height:"120px"},null,8,["modelValue"])]),m("div",h_,[f[4]||(f[4]=m("label",null,"Inputs Mapping",-1)),O(Yo,{modelValue:i.value,"onUpdate:modelValue":f[1]||(f[1]=k=>i.value=k),"section-title":"Inputs Mapping"},null,8,["modelValue"])]),m("div",g_,[f[5]||(f[5]=m("label",null,"Outputs Mapping",-1)),O(Yo,{modelValue:l.value,"onUpdate:modelValue":f[2]||(f[2]=k=>l.value=k),"section-title":"Outputs Mapping"},null,8,["modelValue"])]),m("div",{class:"modal-actions"},[m("button",{type:"button",class:"btn secondary",onClick:r},"Отмена"),f[6]||(f[6]=m("button",{type:"submit",class:"btn primary"},"Создать",-1))]),a.value?(_(),T("div",y_,te(a.value),1)):K("",!0)],32)])])}}},b_=Oe(__,[["__scopeId","data-v-e44054be"]]),w_={style:{display:"flex",width:"100vw",height:"100vh"}},S_={style:{flex:"1",display:"flex","flex-direction":"column"}},A_={__name:"homePage",setup(e){const t=qe("aside"),{updateNodeData:n,removeNodes:o,removeEdges:s,onNodeDragStop:a,addNodes:i,addEdges:l,updateNode:r,updateNodeInternals:u,setCenter:c,viewport:d,screenToFlowCoordinate:p}=Re(),f=at({}),v=q([]),g=q([]),y=Bi(),k=Wn(),E=Fl(),h=jo(),I=Yl(),B=ql(),H=Zn(),F=Wl(),Y=Qt(),D=Zi(),G=y.params.id;k.botId=G;const z=Di(null),b=q(null),V=qe("drawer"),S=q(!1),{initCameraTracking:R,setupViewportTracking:C,saveCameraPosition:L}=jp(G),j=q(null),X=async ne=>{var M,we,ue;V.value&&typeof V.value.save=="function"&&((M=V.value)==null||M.save()),z.value=null,await Fe(),z.value=ne,["simpleNodePanel","emitterNodePanel","templateInstancePanel"].includes(ne==null?void 0:ne.__name)&&((ue=(we=b.value)==null?void 0:we.node)!=null&&ue.id)&&Fe(()=>{A(b.value.node.id)})},A=ne=>{const M=v.value.find(we=>we.id===ne);if(M){const we=M.position,ue=d.value.zoom,Pe=(z.value!==null?225:125)/ue;c(we.x+Pe,we.y+50,{duration:500,zoom:ue})}},U=ne=>b.value=ne;ct("drawer",{drawerComponent:z,drawerProps:b,drawerRef:V,setDrawer:X,setProps:U});const W=at({}),Q=Y.accessToken,ee=q(!1),re=q(null),ye=q({x:0,y:0}),pe=ne=>ne.map(M=>M.template_instance?{id:M.id,position:{x:M.pos_x,y:M.pos_y},data:{name:M.name,description:M.description||"",is_proxy:M.is_proxy,connection_groups:M.connection_groups,message:M.message,template_id:M.template_instance.id,template_name:M.template_instance.name,variables:M.template_instance.variables,inputs_mapping:M.template_instance.inputs_mapping,outputs_mapping:M.template_instance.outputs_mapping,template_instance:M.template_instance},type:"template-instance"}:{id:M.id,position:{x:M.pos_x,y:M.pos_y},data:{name:M.name,description:M.description||"",is_proxy:M.is_proxy,connection_groups:M.connection_groups,message:M.message},type:"simple"}),ve=ne=>ne.map(M=>({id:M.id,position:{x:M.pos_x,y:M.pos_y},data:{text:M.text||""},type:"note"})),se=ne=>ne.map(M=>({id:M.id,position:{x:M.pos_x,y:M.pos_y},data:{name:M.name,is_active:M.is_active,message_id:M.message_id,cron_id:M.cron_id,cron:M.cron,message:M.message,needs_message_processing:M.needs_message_processing},type:"emitter"})),Se=ne=>ne.flatMap(M=>M.connection_groups.flatMap(we=>we.connections.map(ue=>({id:`e${M.id}-${ue.next_step_id}`,source:M.id,target:ue.next_step_id,type:"custom",markerEnd:{type:Gt.ArrowClosed,color:"rgb(207, 255, 125)"}})))),ie=ne=>ne.filter(M=>M.step_id).map(M=>({id:`e${M.step_id}-${M.id}`,source:M.step_id,target:M.id,type:"custom",markerEnd:{type:Gt.ArrowClosed,color:"rgb(207, 255, 125)"}})),fe=async()=>{const ne=await k.readBot(G),M=ne==null?void 0:ne.data;if(console.log(M),!M)return console.error("Не удалось получить данные агента"),null;const we=pe(M.steps),ue=ve(M.notes),he=se(M.emitters);return v.value=[...we,...ue,...he],v.value.forEach(Qe=>N(Qe.id)),await Fe(),g.value=[...Se(M.steps),...ie(M.notes)],console.log("Узлы:",v.value),console.log("Связи:",g.value),M},_e=()=>{const ne=(window.innerWidth||800)/2,M=(window.innerHeight||600)/2,we=p({x:ne,y:M});return{x:we.x,y:we.y}},x=async({type:ne,name:M})=>{let we=null;if(ne==="simple"){const he=await E.createStep({name:M,is_proxy:!1,bot_id:G,description:"",pos_x:_e().x,pos_y:_e().y});i({id:he.id,position:{x:he.pos_x,y:he.pos_y},data:{name:M,description:"",is_proxy:!1,connection_groups:he.connection_groups,message:he.message},type:"simple"}),we=he.id}else if(ne==="emitter"){const he=await B.createEmitter({cron_id:"9e835989-f459-41aa-bb93-159083b0637f",pos_x:_e().x,pos_y:_e().y,name:M,is_active:!1,bot_id:G,needs_message_processing:!1});i({id:he.id,position:{x:he.pos_x,y:he.pos_y},data:{name:he.name,is_active:he.is_active,needs_message_processing:he.needs_message_processing},type:"emitter"}),we=he.id}else if(ne==="note"){const he=await I.createNote({text:"",bot_id:G,step_id:null,pos_x:_e().x,pos_y:_e().y});i({id:he.id,position:{x:he.pos_x,y:he.pos_y},data:{text:he.text},type:"note"}),we=he.id}else throw new Error(`Неизвестный тип узла: ${ne}`);N(we),await fe(),await Fe();const ue=v.value.find(he=>he.id===we);ue&&(ne==="simple"?(X(co),U({node:ue})):ne==="emitter"&&(X(us),U({node:ue})))},w=async ne=>{W[ne]=!1,await Fe(),W[ne]=!0,await Fe(),u([ne])},N=ne=>{W[ne]=!0},$=async({action:ne,data:M})=>{var we,ue,he,Qe;if(ne==="masterUpdate")xe.value=M,U({botInfo:xe,botId:G});else if(ne==="update"){if(M.type==="simple"){const Pe=Object.keys(M).reduce((tt,je)=>(M[je]!==void 0&&(tt[je]=M[je]),tt),{});n(M.id,Pe),await E.updateStep(M.id,Pe)}else if(M.type==="template-instance")if(M.variables!==void 0){const Pe=v.value.find(je=>je.id===M.id),tt={name:M.name||((we=Pe==null?void 0:Pe.data)==null?void 0:we.name)||"",description:M.description||((ue=Pe==null?void 0:Pe.data)==null?void 0:ue.description)||"",variables:M.variables};await F.updateTemplateInstance(M.template_instance_id,tt)}else{const Pe=Object.keys(M).reduce((tt,je)=>(M[je]!==void 0&&(tt[je]=M[je]),tt),{});n(M.id,Pe),await E.updateStep(M.id,Pe)}else if(M.type==="note"){const Pe={text:M.text};await I.updateNote(M.id,Pe)}else if(M.type==="emitter"){const Pe=Object.keys(M).reduce((tt,je)=>(M[je]!==void 0&&(tt[je]=M[je]),tt),{});n(M.id,Pe),await B.updateEmitter(M.id,Pe)}await fe(),await w(M.id)}else if(ne==="graphUpdate"){if(M.type!=="simple"){if(M.type!=="template-instance"){if(M.type==="note"){const Pe={text:M.text};await I.updateNote(M.id,Pe)}else if(M.type==="emitter"){const Pe={name:M.name,cron_id:M.cron_id,is_active:M.is_active,needs_message_processing:M.needs_message_processing,cron:{name:M.cron_name}};n(M.id,Pe),await B.updateEmitter(M.id,Pe)}}}await fe(),await w(M.id)}else if(ne==="delete"){o([M.id]),W[M.id]=void 0,((Qe=(he=b.value)==null?void 0:he.node)==null?void 0:Qe.id)===M.id&&X(null),M.type==="simple"?await E.deleteStep(M.id):M.type==="template-instance"?await E.deleteStep(M.id):M.type==="note"?await I.deleteNote(M.id):M.type==="emitter"&&await B.deleteEmitter(M.id);const Pe=g.value.filter(st=>st.source===M.id||st.target===M.id),tt=Pe.map(st=>st.id);s(tt),await fe();const je=new Set(Pe.flatMap(st=>[st.source,st.target]).filter(st=>st!==M.id));for(const st of je)await w(st)}else ne==="copy"&&N(await Z(M.id))};a(async ne=>{const{id:M,position:we,type:ue}=ne.node;ue==="simple"?await E.updateStep(M,{pos_x:we.x,pos_y:we.y}):ue==="template-instance"?await E.updateStep(M,{pos_x:we.x,pos_y:we.y}):ue==="note"?await I.updateNote(M,{pos_x:we.x,pos_y:we.y}):ue==="emitter"&&await B.updateEmitter(M,{pos_x:we.x,pos_y:we.y})});const Z=async ne=>{const M=v.value.find(ue=>ue.id===ne);if(!M){console.error("Узел не найден");return}let we=null;if(M.type==="simple"){const ue=await E.createStep({name:M.data.name+" copy",is_proxy:M.data.is_proxy,bot_id:G,description:M.data.description,pos_x:M.position.x+50,pos_y:M.position.y+50});i({id:ue.id,position:{x:ue.pos_x,y:ue.pos_y},data:{name:ue.name,description:ue.description,is_proxy:ue.is_proxy,message:ue.message},type:M.type}),we=ue.id}else if(M.type==="emitter"){const ue=await B.createEmitter({name:M.data.name+" copy",is_active:!1,bot_id:G,pos_x:M.position.x+50,pos_y:M.position.y+50,cron_id:M.data.cron_id,message_id:M.data.message_id,needs_message_processing:M.data.needs_message_processing});i({id:ue.id,position:{x:ue.pos_x,y:ue.pos_y},data:{name:ue.name,is_active:ue.is_active,cron_id:ue.cron_id,message_id:ue.message_id},type:M.type}),we=ue.id}return we},le=async ne=>{const M=v.value.find(Qe=>Qe.id===ne.source),we=v.value.find(Qe=>Qe.id===ne.target);if(!M||!we){console.error("Исходный или целевой узел не найден");return}let ue=M,he=we;if(M.type==="note"&&([ue,he]=[we,M]),l([{id:`e${ue.id}-${he.id}`,source:ue.id,target:he.id,markerEnd:{type:Gt.ArrowClosed,color:"rgb(207, 255, 125)"}}]),he.type==="simple"){const Qe={search_type:"message",priority:0,step_id:ue.id,code:null,request_id:null,variables:null,connections:[{next_step_id:he.id,rules:null,priority:0,filters:null}]};await h.createConnectionGroup(Qe),await fe(),w(ue.id)}else he.type==="note"&&await I.updateNote(he.id,{step_id:ue.id})},ce=q(null),de=async ne=>{ce.value=ne,U({group:ce.value,botId:G,show:!0,nodes:v.value}),await X(Qy)},be=()=>{X(null),ce.value=null};ct("nodes",v),ct("edges",g),ct("refreshBotData",async()=>{const ne=await fe();xe.value=ne,ne&&ne.variables&&(De.value=ne.variables.data)});const xe=q(null),De=q(null),Je=q(null);Ze(async()=>{const ne=await fe();xe.value=ne;const M=await D.readTemplateGroups();Je.value=M.data,ne&&ne.variables&&(De.value=ne.variables.data),await Fe(),R(),j.value=C(),H.connect(G,Q,De.value)}),Xo(()=>{L(),j.value&&j.value(),H.disconnect(G)});function Tt(ne){try{const M=JSON.parse(ne.dataTransfer.getData("application/json"));if(M.type==="template"){const we=ne.currentTarget.getBoundingClientRect(),ue={x:ne.clientX-we.left,y:ne.clientY-we.top};ye.value=ue,re.value=M.template,ee.value=!0,be()}}catch(M){console.error("Ошибка при обработке drop:",M)}}function fo(){ee.value=!1,re.value=null}async function po(ne){try{const M=await F.createTemplateInstance({...ne,pos_x:ye.value.x,pos_y:ye.value.y});if(M&&M.steps){const we=M.steps.map(ue=>({id:ue.id,position:{x:ue.pos_x,y:ue.pos_y},data:{name:ue.name,description:ue.description||"",is_proxy:ue.is_proxy,connection_groups:ue.connection_groups,message:ue.message,template_id:ne.template_id,template_name:re.value.name,variables:ne.variables,inputs_mapping:ne.inputs_mapping,outputs_mapping:ne.outputs_mapping},type:"template-instance"}));i(we),we.forEach(ue=>N(ue.id))}ee.value=!1,await fe()}catch(M){console.error("Ошибка при создании инстанса шаблона:",M)}}const cs=J(()=>{var ne,M;return((M=(ne=xe.value)==null?void 0:ne.channels)==null?void 0:M.length)>0}),yi=()=>{S.value=!S.value},_i=()=>{S.value=!1};return(ne,M)=>{var we,ue;return _(),T("div",w_,[O(fy,{ref_key:"aside",ref:t,botId:P(G),botInfo:xe.value,nodes:v.value},null,8,["botId","botInfo","nodes"]),O(Dy,{templateGroupsInfo:Je.value,onAddNode:x,onSelectTemplateGroup:de},null,8,["templateGroupsInfo"]),De.value?(_(),me(wy,{key:0,botId:P(G)},null,8,["botId"])):K("",!0),m("div",S_,[O(P(Zp),{edges:g.value,nodes:v.value,class:"transition-flow",onConnect:le,onDrop:Tt,onDragover:M[0]||(M[0]=ft(()=>{},["prevent"]))},{"node-simple":$e(he=>[W[he.id]?(_(),me(ov,{key:0,node:he,onAction:$},null,8,["node"])):K("",!0)]),"node-emitter":$e(he=>[W[he.id]?(_(),me(gv,{key:0,node:he,onAction:$},null,8,["node"])):K("",!0)]),"node-note":$e(he=>[O(wv,{node:he,onAction:$},null,8,["node"])]),"node-template-instance":$e(he=>[W[he.id]?(_(),me(mh,{key:0,node:he,onAction:$},null,8,["node"])):K("",!0)]),"edge-custom":$e(he=>[O(s_,Ft({ref:Qe=>f[he.id]=Qe},he),null,16)]),default:$e(()=>[O(P(om),{gap:"40",patternColor:"rgba(255, 255, 255, 0.03)",variant:"lines"})]),_:1},8,["edges","nodes"])]),cs.value?(_(),T("button",{key:1,onClick:yi,class:He(["chat-toggle-button",{active:S.value}])},M[1]||(M[1]=[m("i",{class:"fas fa-comment"},null,-1)]),2)):K("",!0),z.value?(_(),me(o_,{key:2,"aside-width":(we=P(t))==null?void 0:we.width,onAction:$},{default:$e(()=>[(_(),me(sa(z.value),Ft({ref:"drawer"},b.value,{onAction:$}),null,16))]),_:1},8,["aside-width"])):K("",!0),ee.value&&re.value?(_(),me(b_,{key:3,template:re.value,botId:P(G),onClose:fo,onSave:po},null,8,["template","botId"])):K("",!0),S.value&&cs.value?(_(),me(Ry,{key:4,channels:((ue=xe.value)==null?void 0:ue.channels)||[],onClose:_i},null,8,["channels"])):K("",!0)])}}};export{A_ as default};
